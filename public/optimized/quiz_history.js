define(["jquery","jquery.instructure_misc_plugins","jquery.templateData","vendor/jquery.scrollTo","compiled/behaviors/quiz_selectmenu"],function(a){var b=a("#submission_details").getTemplateData({textValues:["version_number","user_id"]}),c={snapshot:{user_id:parseInt(b.user_id,10)||null,version_number:b.version_number,last_question_touched:null,question_updates:{},fudge_points:0},getSnapshot:function(){return c.snapshot},jumpToQuestion:function(b){var c=a("#question_"+b).offset().top-10;a("html,body").scrollTo({top:c,left:0})},externallySet:!1,setSnapshot:function(b,d){if(b){if(d&&c.externallySet)return;c.externallySet=!0,c.snapshot=b;for(var e in b.question_updates){var f=b.question_updates[e],g=a("#question_"+e);g.addClass("modified_but_not_saved"),g.find(".user_points :text").val(f.points).end().find(".question_neutral_comment .question_comment_text textarea").val(f.comments)}window.parent&&window.parent.INST&&window.parent.INST.lastQuestionTouched?c.jumpToQuestion(window.parent.INST.lastQuestionTouched):c.snapshot.last_question_touched&&c.jumpToQuestion(c.snapshot.last_question_touched)}else d&&window.parent&&window.parent.INST&&window.parent.INST.lastQuestionTouched&&c.jumpToQuestion(window.parent.INST.lastQuestionTouched);(c.externallySet||d)&&a("#feel_free_to_toggle_message").show(),window.parent&&window.parent.INST&&window.parent.INST.refreshQuizSubmissionSnapshot&&a.isFunction(window.parent.INST.refreshQuizSubmissionSnapshot)&&window.parent.INST.refreshQuizSubmissionSnapshot(c.snapshot)}};a(document).ready(function(){a(":text").focus(function(){a(this).select()}),a(document).fragmentChange(function(a,b){if(b.indexOf("#question")==0){var d=b.substring(10);c.jumpToQuestion(d)}});if(window.parent&&window.parent.INST&&window.parent.INST.getQuizSubmissionSnapshot&&a.isFunction(window.parent.INST.getQuizSubmissionSnapshot)){a("#feel_free_to_toggle_message").show();var b=window.parent.INST.getQuizSubmissionSnapshot(c.snapshot.user_id,c.snapshot.version_number);b?c.setSnapshot(b):c.setSnapshot(null,!0)}a(".question_holder .user_points :text,.question_holder .question_neutral_comment .question_comment_text textarea").change(function(){var b=a(this).parents(".display_question"),d=parseInt(b.attr("id").substring(9),10)||null;if(d){var e={};b.addClass("modified_but_not_saved"),e.points=parseFloat(b.find(".user_points :text").val(),10),e.comments=b.find(".question_neutral_comment .question_comment_text textarea").val()||"",c.snapshot.question_updates[d]=e,c.snapshot.last_question_touched=d,c.setSnapshot()}a(document).triggerHandler("score_changed")}),a("#fudge_points_entry").change(function(){var b=parseFloat(a(this).val(),10);if(b||b===0)c.snapshot.fudge_points=b,c.setSnapshot();a(document).triggerHandler("score_changed")}),a(document).bind("score_changed",function(){var b=a("#after_fudge_points_total"),c=0;a(".display_question .user_points:visible").each(function(){var b=parseFloat(a(this).find(":text:first").val(),10)||0;b=Math.round(b*100)/100,c+=b});var d=parseFloat(a("#fudge_points_entry").val(),10)||0;d=Math.round(d*100)/100,c+=d,b.text(c||"0")})}),ENV.SCORE_UPDATED&&a(document).ready(function(){window.parent&&window.parent.INST&&window.parent.INST.refreshGrades&&a.isFunction(window.parent.INST.refreshGrades)&&window.parent.INST.refreshGrades(),window.parent&&window.parent.INST&&window.parent.INST.clearQuizSubmissionSnapshot&&a.isFunction(window.parent.INST.clearQuizSubmissionSnapshot)&&window.parent.INST.clearQuizSubmissionSnapshot(c.snapshot)})})