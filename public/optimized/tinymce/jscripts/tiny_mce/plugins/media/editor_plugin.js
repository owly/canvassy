(function(){function h(a){return typeof a=="string"?a.replace(/[^0-9%]/g,""):a}function i(a){var b,c,d;if(a&&!a.splice){c=[];for(d=0;!0;d++){if(!a[d])break;c[d]=a[d]}return c}return a}var a=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),b=tinymce.makeMap(a.join(",")),c=tinymce.html.Node,d,e,f=tinymce.util.JSON,g;d=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"],["EmbeddedAudio"],["Audio"]],tinymce.create("tinymce.plugins.MediaPlugin",{init:function(b,c){function m(a){return a&&a.nodeName==="IMG"&&b.dom.hasClass(a,"mceItemMedia")}var g=this,h={},i,j,k,l;g.editor=b,g.url=c,e="";for(i=0;i<d.length;i++){l=d[i][0],k={name:l,clsids:tinymce.explode(d[i][1]||""),mimes:tinymce.explode(d[i][2]||""),codebase:d[i][3]};for(j=0;j<k.clsids.length;j++)h["clsid:"+k.clsids[j]]=k;for(j=0;j<k.mimes.length;j++)h[k.mimes[j]]=k;h["mceItem"+l]=k,h[l.toLowerCase()]=k,e+=(e?"|":"")+l}tinymce.each(b.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar;audio=mp3,ogg").split(";"),function(a){var b,c,d;a=a.split(/=/),c=tinymce.explode(a[1].toLowerCase());for(b=0;b<c.length;b++)d=h[a[0].toLowerCase()],d&&(h[c[b]]=d)}),e=new RegExp("write("+e+")\\(([^)]+)\\)"),g.lookup=h,b.onPreInit.add(function(){b.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]"),b.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(a){var b=a.length;while(b--)g.objectToImg(a[b])}),b.serializer.addNodeFilter("img",function(a,b,c){var d=a.length,e;while(d--)e=a[d],(e.attr("class")||"").indexOf("mceItemMedia")!==-1&&g.imgToObject(e,c)})}),b.onInit.add(function(){b.theme&&b.theme.onResolveName&&b.theme.onResolveName.add(function(a,c){c.name==="img"&&b.dom.hasClass(c.node,"mceItemMedia")&&(c.name="media")}),b&&b.plugins.contextmenu&&b.plugins.contextmenu.onContextMenu.add(function(a,b,c){c.nodeName==="IMG"&&c.className.indexOf("mceItemMedia")!==-1&&b.add({title:"media.edit",icon:"media",cmd:"mceMedia"})})}),b.addCommand("mceMedia",function(){var d,e;e=b.selection.getNode(),m(e)&&(d=b.dom.getAttrib(e,"data-mce-json"),d&&(d=f.parse(d),tinymce.each(a,function(a){var c=b.dom.getAttrib(e,a);c&&(d[a]=c)}),d.type=g.getType(e.className).name.toLowerCase())),d||(d={type:"flash",video:{sources:[]},params:{}}),b.windowManager.open({file:c+"/media.htm",width:430+parseInt(b.getLang("media.delta_width",0)),height:500+parseInt(b.getLang("media.delta_height",0)),inline:1},{plugin_url:c,data:d})}),b.addButton("media",{title:"media.desc",cmd:"mceMedia"}),b.onNodeChange.add(function(a,b,c){b.setActive("media",m(c))})},convertUrl:function(a,b){var c=this,d=c.editor,e=d.settings,f=e.url_converter,g=e.url_converter_scope||c;return a?b?d.documentBaseURI.toAbsolute(a):f.call(g,a,"src","object"):a},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(a,b){var c=this,d=c.editor,e=d.documentBaseURI,g,j,k,l;a.params.src=c.convertUrl(a.params.src,b),j=a.video.attrs,j&&(j.src=c.convertUrl(j.src,b)),j&&(j.poster=c.convertUrl(j.poster,b)),g=i(a.video.sources);if(g)for(l=0;l<g.length;l++)g[l].src=c.convertUrl(g[l].src,b);return k=c.editor.dom.create("img",{id:a.id,style:a.style,align:a.align,hspace:a.hspace,vspace:a.vspace,src:c.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+c.getType(a.type).name,"data-mce-json":f.serialize(a,"'")}),k.width=a.width=h(a.width||(a.type=="audio"?"300":"320")),k.height=a.height=h(a.height||(a.type=="audio"?"32":"240")),k},dataToHtml:function(a,b){return this.editor.serializer.serialize(this.dataToImg(a,b),{forced_root_block:"",force_absolute:b})},htmlToData:function(b){var c,d,e;return e={type:"flash",video:{sources:[]},params:{}},c=this.editor.parser.parse(b),d=c.getAll("img")[0],d&&(e=f.parse(d.attr("data-mce-json")),e.type=this.getType(d.attr("class")).name.toLowerCase(),tinymce.each(a,function(a){var b=d.attr(a);b&&(e[a]=b)})),e},getType:function(a){var b,c,d;c=tinymce.explode(a," ");for(b=0;b<c.length;b++){d=this.lookup[c[b]];if(d)return d}},imgToObject:function(b,d){function C(a,b){var c,d,f,h,i;i=g.getParam("flash_video_player_url",e.convertUrl(e.url+"/moxieplayer.swf")),i&&(c=g.documentBaseURI,p.params.src=i,g.getParam("flash_video_player_absvideourl",!0)&&(a=c.toAbsolute(a||"",!0),b=c.toAbsolute(b||"",!0)),f="",d=g.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),tinymce.each(d,function(c,d){c=c.replace(/\$url/,a||""),c=c.replace(/\$poster/,b||""),c.length>0&&(f+=(f?"&":"")+d+"="+escape(c))}),f.length&&(p.params.flashvars=f),h=g.getParam("flash_video_player_params",{allowfullscreen:!0,allowscriptaccess:!0}),tinymce.each(h,function(a,b){p.params[b]=""+a}))}var e=this,g=e.editor,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;p=b.attr("data-mce-json");if(!p)return;p=f.parse(p),u=this.getType(b.attr("class")),A=b.attr("data-mce-style"),A||(A=b.attr("style"),A&&(A=g.dom.serializeStyle(g.dom.parseStyle(A,"img")))),p.width=b.attr("width")||p.width,p.height=b.attr("height")||p.height;if(u.name==="Iframe"){y=new c("iframe",1),tinymce.each(a,function(a){var c=b.attr(a);a=="class"&&c&&(c=c.replace(/mceItem.+ ?/g,"")),c&&c.length>0&&y.attr(a,c)});for(n in p.params)y.attr(n,p.params[n]);y.attr({style:A,src:p.params.src}),b.replace(y);return}if(this.editor.settings.media_use_script){y=(new c("script",1)).attr("type","text/javascript"),o=new c("#text",3),o.value="write"+u.name+"("+f.serialize(tinymce.extend(p.params,{width:b.attr("width"),height:b.attr("height")}))+");",y.append(o),b.replace(y);return}if(u.name==="Video"&&p.video.sources[0]){j=(new c("video",1)).attr(tinymce.extend({id:b.attr("id"),width:h(b.attr("width")),height:h(b.attr("height")),style:A},p.video.attrs)),p.video.attrs&&(z=p.video.attrs.poster),r=p.video.sources=i(p.video.sources);for(v=0;v<r.length;v++)/\.mp4$/.test(r[v].src)&&(x=r[v].src);r[0].type||(j.attr("src",r[0].src),r.splice(0,1));for(v=0;v<r.length;v++)q=(new c("source",1)).attr(r[v]),q.shortEnded=!0,j.append(q);x?(C(x,z),u=e.getType("flash")):p.params.src=""}if(u.name==="Audio"&&p.video.sources[0]){B=(new c("audio",1)).attr(tinymce.extend({id:b.attr("id"),width:h(b.attr("width")),height:h(b.attr("height")),style:A},p.video.attrs)),p.video.attrs&&(z=p.video.attrs.poster),r=p.video.sources=i(p.video.sources),r[0].type||(B.attr("src",r[0].src),r.splice(0,1));for(v=0;v<r.length;v++)q=(new c("source",1)).attr(r[v]),q.shortEnded=!0,B.append(q);p.params.src=""}if(u.name==="EmbeddedAudio"){l=new c("embed",1),l.shortEnded=!0,l.attr({id:b.attr("id"),width:h(b.attr("width")),height:h(b.attr("height")),style:A,type:b.attr("type")});for(n in p.params)l.attr(n,p.params[n]);tinymce.each(a,function(a){p[a]&&a!="type"&&l.attr(a,p[a])}),p.params.src=""}if(p.params.src){/\.flv$/i.test(p.params.src)&&C(p.params.src,""),d&&d.force_absolute&&(p.params.src=g.documentBaseURI.toAbsolute(p.params.src)),k=(new c("object",1)).attr({id:b.attr("id"),width:h(b.attr("width")),height:h(b.attr("height")),style:A}),tinymce.each(a,function(a){var b=p[a];a=="class"&&b&&(b=b.replace(/mceItem.+ ?/g,"")),b&&a!="type"&&k.attr(a,b)});for(n in p.params)t=new c("param",1),t.shortEnded=!0,o=p.params[n],n==="src"&&u.name==="WindowsMedia"&&(n="url"),t.attr({name:n,value:o}),k.append(t);if(this.editor.getParam("media_strict",!0))k.attr({data:p.params.src,type:u.mimes[0]});else{k.attr({classid:"clsid:"+u.clsids[0],codebase:u.codebase}),l=new c("embed",1),l.shortEnded=!0,l.attr({id:b.attr("id"),width:h(b.attr("width")),height:h(b.attr("height")),style:A,type:u.mimes[0]});for(n in p.params)l.attr(n,p.params[n]);tinymce.each(a,function(a){p[a]&&a!="type"&&l.attr(a,p[a])}),k.append(l)}p.object_html&&(o=new c("#text",3),o.raw=!0,o.value=p.object_html,k.append(o)),j&&j.append(k)}j&&p.video_html&&(o=new c("#text",3),o.raw=!0,o.value=p.video_html,j.append(o)),B&&p.video_html&&(o=new c("#text",3),o.raw=!0,o.value=p.video_html,B.append(o));var D=j||B||k||l;D?b.replace(D):b.remove()},objectToImg:function(d){function I(a){return(new tinymce.html.Serializer({inner:!0,validate:!1})).serialize(a)}function J(a,b){return z[(a.attr(b)||"").toLowerCase()]}function K(a){var b=a.replace(/^.*\.([^.]+)$/,"$1");return z[b.toLowerCase()||""]}var g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=this.lookup,A,B,C=this.editor.settings.url_converter,D=this.editor.settings.url_converter_scope,E,F,G,H;if(!d.parent)return;if(d.name==="script"){d.firstChild&&(A=e.exec(d.firstChild.value));if(!A)return;y=A[1],x={video:{},params:f.parse(A[2])},o=x.params.width,p=x.params.height}x=x||{video:{},params:{}},l=new c("img",1),l.attr({src:this.editor.theme.url+"/img/trans.gif"}),m=d.name;if(m==="video"||m=="audio"){j=d,g=d.getAll("object")[0],i=d.getAll("embed")[0],o=j.attr("width"),p=j.attr("height"),n=j.attr("id"),x.video={attrs:{},sources:[]},B=x.video.attrs;for(m in j.attributes.map)B[m]=j.attributes.map[m];v=d.attr("src"),v&&x.video.sources.push({src:C.call(D,v,"src",d.name)}),w=j.getAll("source");for(r=0;r<w.length;r++)v=w[r].remove(),x.video.sources.push({src:C.call(D,v.attr("src"),"src","source"),type:v.attr("type"),media:v.attr("media")});B.poster&&(B.poster=C.call(D,B.poster,"poster",d.name))}d.name==="object"&&(g=d,i=d.getAll("embed")[0]),d.name==="embed"&&(i=d),d.name==="iframe"&&(k=d,y="Iframe");if(g){o=o||g.attr("width"),p=p||g.attr("height"),q=q||g.attr("style"),n=n||g.attr("id"),E=E||g.attr("hspace"),F=F||g.attr("vspace"),G=G||g.attr("align"),H=H||g.attr("bgcolor"),x.name=g.attr("name"),u=g.getAll("param");for(r=0;r<u.length;r++)t=u[r],m=t.remove().attr("name"),b[m]||(x.params[m]=t.attr("value"));x.params.src=x.params.src||g.attr("data")}if(i){o=o||i.attr("width"),p=p||i.attr("height"),q=q||i.attr("style"),n=n||i.attr("id"),E=E||i.attr("hspace"),F=F||i.attr("vspace"),G=G||i.attr("align"),H=H||i.attr("bgcolor");for(m in i.attributes.map)!b[m]&&!x.params[m]&&(x.params[m]=i.attributes.map[m])}if(k){o=h(k.attr("width")),p=h(k.attr("height")),q=q||k.attr("style"),n=k.attr("id"),E=k.attr("hspace"),F=k.attr("vspace"),G=k.attr("align"),H=k.attr("bgcolor"),tinymce.each(a,function(a){l.attr(a,k.attr(a))});for(m in k.attributes.map)!b[m]&&!x.params[m]&&(x.params[m]=k.attributes.map[m])}x.params.movie&&(x.params.src=x.params.src||x.params.movie,delete x.params.movie),x.params.src&&(x.params.src=C.call(D,x.params.src,"src","object")),j&&(d.name==="video"?y=z.video.name:d.name==="audio"&&(y=z.audio.name)),g&&!y&&(y=(J(g,"clsid")||J(g,"classid")||J(g,"type")||{}).name),i&&!y&&(y=(J(i,"type")||K(x.params.src)||{}).name),i&&y=="EmbeddedAudio"&&(x.params.type=i.attr("type")),d.replace(l),i&&i.remove(),g&&(s=I(g.remove()),s&&(x.object_html=s)),j&&(s=I(j.remove()),s&&(x.video_html=s)),x.hspace=E,x.vspace=F,x.align=G,x.bgcolor=H,l.attr({id:n,"class":"mceItemMedia mceItem"+(y||"Flash"),style:q,width:o||(d.name=="audio"?"300":"320"),height:p||(d.name=="audio"?"32":"240"),hspace:E,vspace:F,align:G,bgcolor:H,"data-mce-json":f.serialize(x,"'")})}}),tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})()