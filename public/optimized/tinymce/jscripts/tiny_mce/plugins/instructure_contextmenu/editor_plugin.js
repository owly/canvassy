define(["compiled/editor/stocktiny"],function(a){var b=a.dom.Event,c=a.each,d=a.DOM;a.create("tinymce.plugins.ContextMenu",{init:function(c,d){function g(){f=!f,c.getBody().setAttribute("spellcheck",f),cm=c.controlManager,cm.setActive("instructure_table_mode",!f)}function h(){e._menu&&(e._menu.removeAll(),e._menu.destroy(),b.remove(c.getDoc(),"click",h))}var e=this;e.editor=c,e.onContextMenu=new a.util.Dispatcher(this),c.onContextMenu.add(function(a,c){var d=!1,g=c.target;while(g.nodeName!="TABLE"&&g.nodeName!="BODY"&&g.parentNode)g=g.parentNode;if(g.nodeName=="TABLE"){var i=a.selection.getRng(!0);if(!i||i.startOffset==i.endOffset&&i.startContainer==i.endContainer)d=!0}!c.ctrlKey&&(d||!f)&&(e._getMenu(a).showMenu(c.clientX,c.clientY),b.add(a.getDoc(),"click",h),b.cancel(c))});var f=!1;c.addCommand("toggleSpellCheck",g),c.onInit.add(function(a,b,c){g()}),c.addButton("instructure_table_mode",{title:"Turn on Advanced Mode (right-click table editing, disables spell-check)",cmd:"toggleSpellCheck",image:d+"/img/button.png"}),c.onMouseDown.add(h),c.onKeyDown.add(h)},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:a.majorVersion+"."+a.minorVersion}},_getMenu:function(a){var b=this,c=b._menu,e=a.selection,f=e.isCollapsed(),g=e.getNode()||a.getBody(),h,i,j;c&&(c.removeAll(),c.destroy()),i=d.getPos(a.getContentAreaContainer()),j=d.getPos(a.getContainer()),c=a.controlManager.createDropMenu("contextmenu",{offset_x:i.x+a.getParam("contextmenu_offset_x",0),offset_y:i.y+a.getParam("contextmenu_offset_y",0),constrain:1}),b._menu=c,c.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(f),c.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(f),c.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"});if(g.nodeName=="A"&&!a.dom.getAttrib(g,"name")||!f)c.addSeparator(),c.add({title:"advanced.link_desc",icon:"link",cmd:"instructureLinks",ui:!0}),c.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});return c.addSeparator(),c.add({title:"advanced.image_desc",icon:"image",cmd:"instructureEmbed",ui:!0}),c.addSeparator(),h=c.addMenu({title:"contextmenu.align"}),h.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"}),h.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"}),h.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"}),h.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"}),b.onContextMenu.dispatch(b,c,g,f),c}}),a.PluginManager.add("instructure_contextmenu",a.plugins.ContextMenu)})