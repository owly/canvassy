(function(){define(["i18n!conversations","underscore","compiled/util/shortcut","compiled/conversations/MessageForm","compiled/conversations/MessageProgressTracker","compiled/fn/preventDefault"],function(a,b,c,d,e,f){var g;return g=function(){function a(a,b){this.app=a,this.formOptions=b,this.$node=$("#create_message_form"),this.initializeActions(),this.tracker=new e(this.app),this.tracker.batchPoller()}return c(a,"form","refresh","toggle","resetForParticipant"),c(a,"app","resize"),a.prototype.height=function(){var a,b;return((a=(b=this.form)!=null?b.height():void 0)!=null?a:0)+this.tracker.height()},a.prototype.reset=function(a){var c;return this.options=a,(c=this.form)!=null&&c.destroy(),this.form=new d(this,this.app.canAddNotesFor,b.defaults(this.options,this.formOptions)),this.$node.append(this.form.$form),this.app.addedMessageForm(this.form.$form),this.form.initialize()},a.prototype.initializeActions=function(){var a=this;return this.$node.click(function(){return a.app.toggleMessageActions(!1)}),this.$node.on("click",".action_add_attachment",f(function(){return a.form.addAttachment()})),this.$node.on("click",".attachment a.remove_link",f(function(b){return a.form.removeAttachment($(b.currentTarget))})),this.$node.on("click",".action_media_comment",f(function(){return a.form.addMediaComment()})),this.$node.on("click",".media_comment a.remove_link",f(function(){return a.form.removeMediaComment})),this.$node.on("click",".action_add_recipients",f(function(b){return a.app.addRecipients($(b.currentTarget))}))},a.prototype.addingMessage=function(a,b){var c=this;return this.reset(this.options),this.tracker.track(a,b),$.when(b).then(function(a){return a.length==null&&(a=[a]),c.app.updatedConversation(a)})},a}()})}).call(this)