(function(){define(["i18n!conversations","underscore","jst/conversations/MessageProgressBarText","compiled/str/TextHelper","jquery.ajaxJSON"],function(a,b,c,d){var e,f;return f=d.truncateText,e=function(){function d(a,c){var d;this.tracker=a,this.data=c,this.$node=$('<li class="progress-bar" />'),d=b.uniqueId("progress_"),this.$message=$("<span />",{id:d}),this.$bar=$("<div />",{tabIndex:-1,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":this.data.completion,"aria-describedby":d}),this.$completion=$("<b />").appendTo(this.$bar),this.$node.append(this.$message,this.$bar),this.update(this.data)}return d.prototype.update=function(b){var d,e;return this.data=b,this.data.status=this.data.error?"error":this.data.completion!=null?this.data.completion===1?"complete":"determinate":"indeterminate",this.data.num_people=a.t("people_count","person",{count:this.data.recipient_count}),this.data.message_preview=f(this.data.message.body,{max:20}),this.$node.attr("class","progress-bar progress-bar-"+this.data.status),this.$message.html(c(this.data)),this.$message.attr({title:this.data.message_preview}),this.$bar.showIf(this.data.status!=="error"),d=parseInt(100*((e=this.data.completion)!=null?e:0))+"%",this.$bar.attr("aria-valuenow",this.data.completion),this.$completion.css({width:d})},d.prototype.error=function(a){return this.update(b.extend(this.data,{error:a,completion:1})),this.destroy()},d.prototype.complete=function(){return this.update(b.extend(this.data,{completion:1})),this.destroy()},d.prototype.destroy=function(){var a=this;return setTimeout(function(){return a.$node.fadeTo("fast",0).animate({width:0},"fast",function(){return a.$node.remove()})},5e3)},d}()})}).call(this)