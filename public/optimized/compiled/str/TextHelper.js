(function(){define(["i18n!lib.text_helper","str/htmlEscape"],function(a,b){var c,d,e;return c="LINK-PLACEHOLDER",d=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)[^\s()<>]+[^\s`!()\[\]{};:'".,<>?«»“”‘’])|(LINK-PLACEHOLDER)/gi,e={quoteClump:function(b){return"<div class='quoted_text_holder'>        <a href='#' class='show_quoted_text_link'>"+a.t("quoted_text_toggle","show quoted text")+"</a>        <div class='quoted_text' style='display: none;'>          "+b.join("\n")+"        </div>      </div>"},formatMessage:function(a){var f,g,h,i,j,k,l;h=[],i=[],a=a.replace(d,function(a,d){var e;return i.push(a===c?c:(e=a,e.slice(0,4)==="www"?e="http://"+e:void 0,e=encodeURI(e).replace(/'/g,"%27"),h.push(e),"<a href='"+b(e)+"'>"+b(a)+"</a>")),c}),a=b(a),a=a.replace(new RegExp(c,"g"),function(a,b){return i.shift()}),a=a.replace(/\n/g,"<br />\n"),j=[],k=[],l=a.split("\n");for(f in l)g=l[f],g.match(/^(&gt;|>)/)?k.push(g):(k.length&&j.push(e.quoteClump(k)),k=[],j.push(g));return k.length&&j.push(e.quoteClump(k)),a=j.join("\n")},delimit:function(a){var b,c,d,e,f;if(isNaN(a))return String(a);f=a<0?"-":"",b=Math.abs(a);if(b===Infinity)return String(a);c=Math.floor(b),e=b===c?"":String(b).replace(/^\d+\./,".");while(c>=1e3)d=String(c).replace(/\d+(\d\d\d)$/,",$1"),c=Math.floor(c/1e3),e=d+e;return f+String(c)+e},truncateText:function(b,c){var d,e,f,g,h,i;c==null&&(c={}),e=(i=c.max)!=null?i:30,d=a.t("ellipsis","..."),h=a.t("word_separator"," "),b=(b!=null?b:"").replace(/\s+/g,h).trim();if(!b||b.length<=e)return b;g=0;for(;;){f=b.indexOf(h,g+1);if(f<0||f>e-d.length)break;g=f}return g||(g=e-d.length),b.substring(0,g)+d}}})}).call(this)