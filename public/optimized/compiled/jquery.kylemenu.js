(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["jquery","jquery.ui.menu.inputmenu","jqueryui/button","jqueryui/popup"],function(b){var c;return c=function(){function c(d,e){this.keepButtonActive=a(this.keepButtonActive,this),this.onClose=a(this.onClose,this),this.select=a(this.select,this),this.onOpen=a(this.onOpen,this);var f,g,h,i=this;this.$trigger=b(d).data("kyleMenu",this),this.opts=b.extend(!0,{},c.defaults,e),this.opts.noButton||(this.opts.buttonOpts.addDropArrow&&this.$trigger.append('<i class="icon-mini-arrow-down"></i>'),this.$trigger.button(this.opts.buttonOpts),this.$trigger.bind("mouseleave.button",this.keepButtonActive)),this.$menu=this.$trigger.next().menu(this.opts.menuOpts).popup(this.opts.popupOpts).addClass("ui-kyle-menu use-css-transitions-for-show-hide"),this.opts.appendMenuTo&&(f=this.$menu.data("popup"),h=f.open,g=this,f.open=function(){return g.$menu.appendTo(g.opts.appendMenuTo),h.apply(this,arguments)},this.$placeholder=b('<span style="display:none;">').insertAfter(this.$menu),this.$menu.bind("click",function(){var a;return(a=i.$placeholder).trigger.apply(a,arguments)})),this.opts.notifyMenuActiveOnParent&&(this.$notifyParent=this.$trigger.closest(this.opts.notifyMenuActiveOnParent)),this.$menu.on({menuselect:this.select,popupopen:this.onOpen,popupclose:this.onClose})}return c.prototype.onOpen=function(a){this.adjustCarat(a),this.$menu.addClass("ui-state-open");if(this.opts.notifyMenuActiveOnParent)return this.$notifyParent.addClass("menu_active")},c.prototype.open=function(){return this.$menu.popup("open")},c.prototype.select=function(a,c){var d,e;return((e=a.originalEvent)!=null?e.type:void 0)!=="click"&&(d=b(c.item).find("a"))&&(a.preventDefault(),d.trigger("click")),this.$menu.popup("close").removeClass("ui-state-open")},c.prototype.onClose=function(){this.opts.appendMenuTo&&this.$menu.insertBefore(this.$placeholder),this.$trigger.removeClass("ui-state-active"),this.$menu.removeClass("ui-state-open");if(this.opts.notifyMenuActiveOnParent)return this.$notifyParent.removeClass("menu_active")},c.prototype.keepButtonActive=function(){if(this.$menu.is(".ui-state-open")&&this.$trigger.is(".btn, .ui-button"))return this.$trigger.addClass("ui-state-active")},c.prototype.adjustCarat=function(a){var c,d,e,f,g,h,i;return(i=this.$carat)!=null&&i.remove(),this.$trigger.is(".btn, .ui-button")&&this.$trigger.addClass("ui-state-active"),h=this.$trigger.outerWidth(),g=this.$trigger.offset().left,f=a.pageX||g+h/2,e=g-this.$menu.offset().left,c=f-this.$trigger.offset().left,d=Math.min(Math.max(6,c),h-6)+e,this.$carat=b('<span class="ui-menu-carat"><span /></span>').css("left",d).prependTo(this.$menu),this.$menu.css("-webkit-transform-origin-x",d+"px")},c.defaults={popupOpts:{position:{my:"center top",at:"center bottom",offset:"0 10px",within:"#main",collision:"fit"}},buttonOpts:{addDropArrow:!0}},c}(),b.fn.kyleMenu=function(a){return this.each(function(){if(!b(this).data().kyleMenu)return new c(this,a)})},c})}).call(this)