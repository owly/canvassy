(function(){define(["underscore","i18n!editor","jquery","Backbone","compiled/fn/preventDefault","tinymce.editor_box"],function(a,b,c,d,e){var f;return f=function(){function a(a,b){this.editingElement(a),this.options=c.extend({},this.options,b),this.textArea=this.createTextArea(),this.options.switchViews&&(this.switchViews=this.createSwitchViews()),this.done=this.createDone(),this.content=this.getContent(),this.editing=!1}return a.prototype.options={doneText:b.t("done_as_in_finished","Done"),switchViews:!1},a.prototype.toggle=function(){return this.editing?this.display():this.edit()},a.prototype.edit=function(){var a;return this.textArea.val(this.getContent()),this.textArea.insertBefore(this.el),this.el.detach(),this.options.switchViews&&this.switchViews.insertBefore(this.textArea),this.done.insertAfter(this.textArea),this.options.editorBoxLabel&&(a={tinyOptions:{aria_label:this.options.editorBoxLabel}}),this.textArea.editorBox(a),this.editing=!0,this.trigger("edit")},a.prototype.display=function(a){if(a!=null?!a.cancel:!void 0)this.content=this.textArea._justGetCode(),this.textArea.val(this.content),this.el.html(this.content);return this.el.insertBefore(this.textArea),this.textArea._removeEditor(),this.textArea.detach(),this.options.switchViews&&this.switchViews.detach(),this.done.detach(),this.textArea.attr("id",""),this.editing=!1,this.trigger("display")},a.prototype.editingElement=function(a){return this.el=a},a.prototype.getContent=function(){return c.trim(this.el.html())},a.prototype.createTextArea=function(){return c("<textarea/>").css({width:"100%",minHeight:"110px"}).addClass("editor-toggle")},a.prototype.createDone=function(){var a=this;return c("<a/>").html(this.options.doneText).attr("href","#").addClass("btn edit-html-done edit_html_done").attr("title",b.t("done.title","Click to finish editing the rich text area")).click(e(function(){return a.display()}))},a.prototype.createSwitchViews=function(){var a=this;return c("<a/>",{style:"float: right",href:"#"}).text(b.t("switch_views","Switch Views")).click(e(function(){return a.textArea.editorBox("toggle")}))},a}(),a.extend(f.prototype,d.Events),f})}).call(this)