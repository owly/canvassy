(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!discussion_topics","Backbone","jquery","underscore","compiled/collections/ParticipantCollection","compiled/collections/DiscussionEntriesCollection","compiled/models/Assignment"],function(b,d,e,f,g,h,i){var j,k;return j=function(j){function l(){return this.present=a(this.present,this),k=l.__super__.constructor.apply(this,arguments),k}return c(l,j),l.prototype.resourceName="discussion_topics",l.prototype.defaults={discussion_type:"side_comment",podcast_enabled:!1,podcast_has_student_posts:!1,require_initial_post:!1,is_announcement:!1,subscribed:!1},l.prototype.dateAttributes=["last_reply_at","posted_at","delayed_post_at"],l.prototype.initialize=function(){var a,b=this;return this.participants=new g,this.entries=new h,this.entries.url=function(){return""+f.result(b,"url")+"/entries"},this.entries.participants=this.participants,this.set("set_assignment",this.get("assignment")!=null),a=new i(this.get("assignment")||{}),a.alreadyScoped=!0,this.set("assignment",a)},l.prototype.present=function(){return d.Model.prototype.toJSON.call(this)},l.prototype.topicSubscribe=function(){return this.set("subscribed",!0),e.ajaxJSON(ENV.DISCUSSION.SUBSCRIBE_URL,"PUT")},l.prototype.topicUnsubscribe=function(){return this.set("subscribed",!1),e.ajaxJSON(ENV.DISCUSSION.UNSUBSCRIBE_URL,"DELETE")},l.prototype.toJSON=function(){var a,b;return b=l.__super__.toJSON.apply(this,arguments),b.set_assignment||delete b.assignment,a=b.assignment?typeof b.assignment.toJSON=="function"?b.assignment.toJSON():b.assignment:null,f.extend(b,{summary:this.summary(),unread_count_tooltip:this.unreadTooltip(),reply_count_tooltip:this.replyTooltip(),assignment:a})},l.prototype.unreadTooltip=function(){return b.t("unread_count_tooltip",{zero:"No unread replies",one:"1 unread reply",other:"%{count} unread replies"},{count:this.get("unread_count")})},l.prototype.replyTooltip=function(){return b.t("reply_count_tooltip",{zero:"No replies",one:"1 reply",other:"%{count} replies"},{count:this.get("discussion_subentry_count")})},l.prototype.fetchEntries=function(){var a,b=this;return a=f.result(this,"url"),e.get(""+a+"/view",function(a){var c,d,e,f;return f=a.unread_entries,d=a.forced_entries,e=a.participants,c=a.view,b.unreadEntries=f,b.forcedEntries=d,b.participants.reset(e),b.entries.reset(c)})},l.prototype.summary=function(){return e("<div/>").html(this.get("message")).text()||""},l.prototype.updateOneAttribute=function(a,b,c){var d;return c==null&&(c={}),d={},d[a]=b,c=f.defaults(c,{data:JSON.stringify(d),contentType:"application/json"}),this.save({},c)},l.prototype.positionAfter=function(a){var b,c;return this.updateOneAttribute("position_after",a),b=this.collection,c=b.indexOf(b.get(a)),b.remove(this,{silent:!0}),b.models.splice(c,0,this),b.reset(b.models)},l}(d.Model)})}).call(this)