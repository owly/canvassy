(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=[].slice;define(["jquery","underscore","Backbone","jquery.ajaxJSON"],function(b,e,f){var g,h,i;return h=f.Model,g=function(f){function g(){return this.saveFrd=a(this.saveFrd,this),i=g.__super__.constructor.apply(this,arguments),i}return c(g,f),g.prototype.initialize=function(a,b){return this.preflightUrl=b.preflightUrl,g.__super__.initialize.apply(this,arguments)},g.prototype.save=function(a,c){var d,e,f,g=this;return a==null&&(a={}),c==null&&(c={}),this.set(a),d=b.Deferred(),e=this.get("file"),f=(e.value||e.name).split(/[\/\\]/).pop(),b.ajaxJSON(this.preflightUrl,"POST",{name:f,on_duplicate:"rename"},function(a){return g.saveFrd(a,d,e,c)},function(a){return d.reject(a),typeof c.error=="function"?c.error(a):void 0}),d},g.prototype.saveFrd=function(a,b,c,d){var e=this;return this.uploadParams=a.upload_params,this.set(this.uploadParams),c.name=a.file_param,this.url=function(){return a.upload_url},h.prototype.save.call(this,null,{multipart:!0,success:function(a){return b.resolve(a),typeof d.success=="function"?d.success(a):void 0},error:function(a){return b.reject(a),typeof d.error=="function"?d.error(a):void 0}})},g.prototype.toJSON=function(){var a;return e.pick.apply(e,[this.attributes,"file"].concat(d.call(e.keys((a=this.uploadParams)!=null?a:{}))))},g.prototype.present=function(){return e.clone(this.attributes)},g}(h)})}).call(this)