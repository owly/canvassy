(function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define(["Backbone","underscore"],function(a,c){var d,e;return d=function(d){function f(){return e=f.__super__.constructor.apply(this,arguments),e}return b(f,d),f.prototype.defaults={name:""},f.prototype.initialize=function(){return this.setUpFilesAndFoldersIfNeeded(),f.__super__.initialize.apply(this,arguments)},f.prototype.parse=function(a){return this.setUpFilesAndFoldersIfNeeded(),this.folders.url=a.folders_url,this.files.url=a.files_url,f.__super__.parse.apply(this,arguments)},f.prototype.setUpFilesAndFoldersIfNeeded=function(){this.folders||(this.folders=new a.Collection,this.folders.model=f);if(!this.files)return this.files=new a.Collection},f.prototype.expand=function(a){var b,c,d=this;a==null&&(a=!1),this.isExpanded=!0,this.trigger("expanded");if(!this.expandDfd&&!a){this.isExpanding=!0,this.trigger("beginexpanding"),this.expandDfd=$.Deferred().done(function(){return d.isExpanding=!1,d.trigger("endexpanding")}),c=this.folders.url===this.folders.constructor.prototype.url||this.files.url===this.files.constructor.prototype.url;if(c||a)b=this.fetch();return $.when(b).done(function(){var a,b;return d.get("folders_count")!==0&&(b=d.folders.fetch()),d.get("files_count")!==0&&(a=d.files.fetch()),$.when(b,a).done(d.expandDfd.resolve)})}},f.prototype.collapse=function(){return this.isExpanded=!1,this.trigger("collapsed")},f.prototype.toggle=function(){return this.isExpanded?this.collapse():this.expand()},f.prototype.contents=function(){return c(this.files.models.concat(this.folders.models)).sortBy(function(a){return(a.get("name")||a.get("display_name")||"").toLowerCase()})},f.prototype.previewUrlForFile=function(a){var b;return(b=this.get("context_type"))==="Course"||b==="Group"?"/"+(this.get("context_type").toLowerCase()+"s")+"/"+this.get("context_id")+"/files/"+a.get("id")+"/preview":a.get("url")},f}(a.Model)})}).call(this)