(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["underscore","compiled/views/CollectionView","jst/DiscussionTopics/discussionList","compiled/views/DiscussionTopics/DiscussionView","jqueryui/draggable","jqueryui/sortable"],function(b,d,e,f){var g,h;return g=function(d){function g(){return this._onDrop=a(this._onDrop,this),this._updateSort=a(this._updateSort,this),this._onFetchedLast=a(this._onFetchedLast,this),this._toggleNoContentMessage=a(this._toggleNoContentMessage,this),this.renderItem=a(this.renderItem,this),h=g.__super__.constructor.apply(this,arguments),h}return c(g,d),g.prototype.template=e,g.prototype.itemView=f,g.prototype.defaults={showSpinner:!0,showMessage:!1,sortable:!1},g.optionProperty("showSpinner"),g.optionProperty("showMessage"),g.optionProperty("title"),g.optionProperty("listId"),g.optionProperty("sortable"),g.optionProperty("draggable"),g.optionProperty("destination"),g.prototype.spinnerOptions={color:"#333",length:5,radius:6,width:2},g.prototype.sortOptions={tolerance:"pointer"},g.prototype.dragOptions={helper:"clone",opacity:.75,revert:"invalid",revertDuration:0,zIndex:100},g.prototype.dropOptions={activeClass:"droppable",hoverClass:"droppable-hover",tolerance:"pointer"},g.prototype.events={"click .al-trigger":"onAdminClick"},g.prototype.render=function(){return g.__super__.render.apply(this,arguments),this._cacheElements(),this._toggleNoContentMessage(),this.options.sortable&&this._initSort(),this.$el.data("view")||this.$el.data("view",this),this.options.showSpinner?this._startLoader():this._stopLoader(),this},g.prototype.renderItem=function(a){g.__super__.renderItem.apply(this,arguments);if(this.options.draggable)return this._initDrag(a.view)},g.prototype.isEmpty=function(){return this.collection.isEmpty()||this.collection.all(function(a){return a.get("hidden")})},g.prototype.toJSON=function(){return this.options},g.prototype.attachCollection=function(){return this.collection.on("change:hidden",this._toggleNoContentMessage),this.collection.on("fetched:last",this._onFetchedLast),g.__super__.attachCollection.apply(this,arguments)},g.prototype.onAdminClick=function(a){return a.preventDefault()},g.prototype._startLoader=function(){var a;return a=new Spinner(this.spinnerOptions),a.spin(this.$loader.show()[0])},g.prototype._stopLoader=function(){return this.$loader.empty().hide()},g.prototype._cacheElements=function(){return this.$loader=this.$el.find(".loader"),this.$noContent=this.$el.find(".no-content")},g.prototype._toggleNoContentMessage=function(){if(this.options.showMessage)return this.$noContent.toggle(this.isEmpty())},g.prototype._onFetchedLast=function(){return this.options.showSpinner=!1,this.options.showMessage=!0,this._stopLoader(),this._toggleNoContentMessage()},g.prototype._initSort=function(){if(!ENV.permissions.moderate)return;return this.$list.sortable(b.extend({},this.sortOptions)),this.$list.on("sortupdate",this._updateSort),$(this.options.destination).droppable(b.extend({},this.dropOptions)).on("drop",this._onDrop)},g.prototype._updateSort=function(a,b){var c,d=this;c=this.collection.get(b.item.data("id"));if(c!=null?!c.get("pinned"):!void 0)return;return c.updateOneAttribute("position_at",b.item.index()+1),this._updatePositions(),c.set("preventClick",!0),setTimeout(function(){return c.set("preventClick",!1)},0)},g.prototype._updatePositions=function(){return this.collection.each(function(a,b){return a.set("position",b+1)})},g.prototype._initDrag=function(a){if(!this.options.destination)throw new Error("must have destination");if(!ENV.permissions.moderate)return;return a.$el.draggable(b.extend({},this.dragOptions)),$(this.options.destination).droppable(b.extend({},this.dropOptions)).on("drop",this._onDrop)},g.prototype._onDrop=function(a,b){var c,d,e,f,g,h;e=this.collection.get(b.draggable.data("id"));if(!e)return;return h=[$(a.currentTarget).data("view"),this],f=h[0],c=h[1],g=!!f.options.pinned,d=!!f.options.locked,e.save({pinned:g,locked:d})},g}(d)})}).call(this)