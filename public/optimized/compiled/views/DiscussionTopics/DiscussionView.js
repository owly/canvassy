(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!discussions","underscore","Backbone","jst/DiscussionTopics/discussion"],function(b,d,e,f){var g,h,i;return h=e.View,g=function(e){function g(){return this.hide=a(this.hide,this),this.togglePinned=a(this.togglePinned,this),this.onDelete=a(this.onDelete,this),this.togglePinned=a(this.togglePinned,this),this.toggleLocked=a(this.toggleLocked,this),i=g.__super__.constructor.apply(this,arguments),i}return c(g,e),g.prototype.template=f,g.prototype.tagName="li",g.prototype.className="discussion",g.prototype.messages={confirm:b.t("confirm_delete_discussion_topic","Are you sure you want to delete this discussion topic?"),"delete":b.t("delete","Delete"),lock:b.t("lock","Lock"),unlock:b.t("unlock","Unlock"),pin:b.t("pin","Pin"),unpin:b.t("unpin","Unpin")},g.prototype.events={"click .icon-lock":"toggleLocked","click .icon-pin":"togglePinned","click .icon-trash":"onDelete",click:"onClick"},g.prototype.defaults={pinnable:!1},g.optionProperty("lockable"),g.optionProperty("pinnable"),g.prototype.initialize=function(a){return this.attachModel(),g.__super__.initialize.apply(this,arguments)},g.prototype.render=function(){return g.__super__.render.apply(this,arguments),this.$el.attr("data-id",this.model.get("id")),this},g.prototype.toggleLocked=function(a){var b,c,d;return a.preventDefault(),b=this.model.get("locked")?"lock":"unlock",c=!this.model.get("locked"),d=c?!1:this.model.get("pinned"),this.model.save({locked:c,pinned:d}),$(a.target).text(this.messages[b])},g.prototype.togglePinned=function(a){var b,c,d;return a.preventDefault(),b=this.model.get("pinned")?"pin":"unpin",d=!this.model.get("pinned"),c=d?!1:this.model.get("locked"),this.model.save({locked:c,pinned:d}),$(a.target).text(this.messages[b])},g.prototype.onDelete=function(a){a.preventDefault();if(confirm(this.messages.confirm))return this["delete"]()},g.prototype["delete"]=function(){return this.model.destroy(),this.$el.remove()},g.prototype.togglePinned=function(a){var b;return a.preventDefault(),b=this.model.get("pinned")?"pin":"unpin",this.model.updateOneAttribute("pinned",!this.model.get("pinned")),$(a.target).text(this.messages[b])},g.prototype.onClick=function(a){if(this.model.get("preventClick"))return;if(d.contains(["A","I"],a.target.nodeName))return;return window.location=this.model.get("html_url")},g.prototype.hide=function(){return this.$el.toggle(!this.model.get("hidden"))},g.prototype.toJSON=function(){var a;return a=d.extend(this.model.toJSON(),this.options),this.model.get("locked")&&!d.intersection(ENV.current_user_roles,["teacher","ta","admin"]).length&&(a.permissions["delete"]=!1),a},g.prototype.attachModel=function(){return this.model.on("change:hidden",this.hide)},g}(h)})}).call(this)