(function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define(["Backbone","underscore","compiled/fn/preventDefault","jst/CommentsView","jst/_avatar"],function(a,c,d,e){var f,g;return f=function(a){function f(){return g=f.__super__.constructor.apply(this,arguments),g}return b(f,a),f.prototype.template=e,f.prototype.events={"submit form":"addNewComment","click [data-delete-comment]":"deleteComment"},f.prototype.initialize=function(){return this.render(),this.model.entries.on("all",this.render)},f.prototype.toJSON=function(){return{entries:this.model.entries.map(function(a){var b,d;return c.extend(a.toJSON(),{author:a.author(),editor:a.editor(),canDelete:((b=a.author())!=null?b.id:void 0)===((d=ENV.current_user)!=null?d.id:void 0)})}),currentUser:ENV.current_user}},f.prototype.deleteComment=d(function(a){var b,c;return c=a.target,b=this.$(c).data("deleteComment"),this.model.entries.get(b).destroy()}),f.prototype.addNewComment=d(function(){var a,b;if(!(b=this.$('[name="message"]').val()))return;return a=this.model.entries.create({message:b.replace(/\n/g,"<br />")}),a.set("user_id",ENV.current_user_id)}),f}(a.View)})}).call(this)