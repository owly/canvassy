(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["underscore","compiled/views/PaginatedView","compiled/collections/UserCollection","compiled/collections/GroupCollection","jst/collaborations/collaborator"],function(b,d,e,f,g){var h,i,j,k,l,m;return i=b.each,j=b.extend,k=b.flatten,l=b.reject,h=function(b){function d(){return this.renderCollaborator=a(this.renderCollaborator,this),this.render=a(this.render,this),m=d.__super__.constructor.apply(this,arguments),m}return c(d,b),d.prototype.filteredMembers=[],d.prototype.events={"click a":"selectCollaborator"},d.prototype.initialize=function(){return this.collection=this.createCollection(this.options.type),this.paginationScrollContainer=this.$el.parents(".list-wrapper"),this.attachEvents(),d.__super__.initialize.call(this,{fetchOptions:this.options.fetchOptions})},d.prototype.createCollection=function(a){return a==null&&(a="user"),a==="user"?new e({comparator:function(a){return a.get("sortable_name")}}):new f},d.prototype.attachEvents=function(){var a=this;return this.collection.on("add remove reset",this.render).on("remove",function(b){return a.trigger("collection:remove",b)})},d.prototype.render=function(){var a;return this.updateFilter([]),a=this.collection.map(this.renderCollaborator),this.$el.html(a.join("")),this.currentIndex!=null&&this.hasFocus&&this.updateFocus(),this.hasFocus=!1,d.__super__.render.apply(this,arguments)},d.prototype.renderCollaborator=function(a){var b;return a.get("id")===this.options.currentUser?"":(b=j(a.toJSON(),{name:a.get("sortable_name")||a.get("name"),type:a.modelType}),g(b))},d.prototype.updateFocus=function(){var a;return a=$(this.$el.find("li").get(this.currentIndex)).find("a"),a.length===0&&(a=$(this.$el.find("li").get(this.currentIndex-1)).find("a")),a.length===0&&(a=this.$el.parents(".collaborator-picker").find(".members-list")),a.focus()},d.prototype.selectCollaborator=function(a){var b;return a.preventDefault(),b=$(a.currentTarget).data("id"),this.currentIndex=$(a.currentTarget).parent().index(),this.hasFocus=!0,this.collection.remove(b)},d.prototype.updateFilter=function(a){var b=this;return setTimeout(function(){return b.filteredMembers=k([b.filteredMembers,a]),i(b.filteredMembers,function(a){return b.collection.remove(a,{silent:!0})})},0)},d.prototype.removeFromFilter=function(a){return this.filteredMembers=l(this.filteredMembers,function(b){return b.get("id")===a.get("id")})},d}(d)})}).call(this)