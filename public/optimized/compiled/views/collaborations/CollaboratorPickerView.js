(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!collaborations","Backbone","compiled/views/collaborations/ListView","compiled/views/collaborations/MemberListView","jst/collaborations/CollaboratorPicker"],function(b,d,e,f,g){var h,i,j;return i=d.View,h=function(b){function d(){return this.updateListFilters=a(this.updateListFilters,this),this.deselectCollaborator=a(this.deselectCollaborator,this),j=d.__super__.constructor.apply(this,arguments),j}return c(d,b),d.prototype.template=g,d.prototype.events={"change .filters input":"filterList"},d.prototype.fetchOptions={data:{per_page:50}},d.prototype.initialize=function(){return this.cacheElements(),this.createLists(),this.attachEvents(),this.includeGroups=!window.location.pathname.match(/groups/)},d.prototype.cacheElements=function(){return this.$template=$(this.template({id:this.options.id||"new"})),this.$userList=this.$template.find(".available-users"),this.$groupList=this.$template.find(".available-groups"),this.$memberList=this.$template.find(".members-list-wrapper"),this.$listFilter=this.$template.find(".filters")},d.prototype.attachEvents=function(){return this.groupList.on("collection:remove",this.memberList.collection.add.bind(this.memberList.collection)),this.userList.on("collection:remove",this.memberList.collection.add.bind(this.memberList.collection)),this.memberList.on("collection:remove",this.deselectCollaborator),this.memberList.on("collection:reset",this.updateListFilters)},d.prototype.createLists=function(){return this.userList=new e({currentUser:ENV.current_user_id,el:this.$userList,fetchOptions:this.fetchOptions,type:"user"}),this.groupList=new e({el:this.$groupList,fetchOptions:this.fetchOptions,type:"group"}),this.memberList=new f({currentUser:ENV.current_user_id,el:this.$memberList})},d.prototype.fetchCollaborators=function(){this.userList.collection.fetch(this.fetchOptions),this.includeGroups&&this.groupList.collection.fetch(this.fetchOptions);if(this.options.edit)return this.memberList.collection.url="/api/v1/collaborations/"+this.options.id+"/members",this.memberList.currentXHR=this.memberList.collection.fetch(this.fetchOptions)},d.prototype.render=function(){return this.$el.append(this.$template),this.fetchCollaborators(),this.includeGroups?this.$listFilter.buttonset():this.$listFilter.hide(),this},d.prototype.filterList=function(a){var b;return b=$(a.currentTarget).val(),this.$el.find(".available-lists ul").hide(),this.$el.find("."+b).show()},d.prototype.deselectCollaborator=function(a){var b;return b=a.modelType==="user"?this.userList:this.groupList,b.removeFromFilter(a),b.collection.add(a)},d.prototype.updateListFilters=function(a,b){var c;return c=a==="user"?this.userList:this.groupList,c.updateFilter(b)},d}(i)})}).call(this)