(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!outcomes","jquery","underscore","compiled/views/outcomes/OutcomeContentBase","jst/outcomes/outcome","jst/outcomes/outcomeForm","jst/outcomes/_criterion","jqueryui/dialog"],function(b,d,e,f,g,h,i){var j;return j=function(j){function k(b){this.setQuizMastery=b.setQuizMastery,this.useForScoring=b.useForScoring,this.showRatingDialog=a(this.showRatingDialog,this),this.insertRating=a(this.insertRating,this),this.deleteRating=a(this.deleteRating,this),this.editRating=a(this.editRating,this),this.submit=a(this.submit,this),k.__super__.constructor.apply(this,arguments)}return c(k,j),k.prototype.events=e.extend({"click .outcome_information_link":"showRatingDialog","click .edit_rating":"editRating","click .delete_rating_link":"deleteRating","click .save_rating_link":"saveRating","click .insert_rating":"insertRating"},f.prototype.events),k.prototype.validations=e.extend({mastery_points:function(a){if(e.isEmpty(a.mastery_points)||parseFloat(a.mastery_points)<0)return b.t("mastery_error","Must be greater than or equal to 0")}},f.prototype.validations),k.prototype.submit=function(a){var b;return b=e.max(e.map(e.pluck(this.getFormData().ratings,"points"),function(a){return parseFloat(a)})),this.model.set({points_possible:b},{silent:!0}),k.__super__.submit.call(this,a)},k.prototype.editRating=function(a){return a.preventDefault(),d(a.currentTarget).parent().hide()},k.prototype.deleteRating=function(a){var b,c;a.preventDefault();if(this.$(".rating").length>1)return b=d(a.currentTarget),c=b.closest(".rating").prev().find(".insert_rating"),c.length===0&&(c=b.closest(".rating").next().find(".edit_rating")),b.closest("td").remove(),c.focus(),this.updateRatings()},k.prototype.saveRating=function(a){var b,c;return a.preventDefault(),b=d(a.currentTarget).parents(".edit:first"),c=b.prev(),c.find("h5").text(b.find("input.outcome_rating_description").val()),c.find(".points").text(b.find("input.outcome_rating_points").val()||0),b.attr("aria-expanded",!1).hide(),c.show(),c.find(".edit_rating").focus(),this.updateRatings()},k.prototype.insertRating=function(a){var b;return a.preventDefault(),b=d(i({description:"",points:"",_index:99})),d(a.currentTarget).closest(".rating").after(b),b.find(".show").hide().next().show(200),b.find(".edit input:first").focus(),this.updateRatings()},k.prototype.updateRatings=function(){var a,b,c,f,g,h,i,j,k,l,m,n;h=0,m=this.$(".rating");for(i=0,k=m.length;i<k;i++){f=m[i],g=d(f).find(".outcome_rating_points").val()||0,h=e.max([h,parseFloat(g)]),b=i,n=d(f).find("input");for(j=0,l=n.length;j<l;j++)a=n[j],d(a).attr("name",a.name.replace(/\[[0-9]+\]/,"["+b+"]"))}return c=this.$(".points_possible"),c.html(c.html().replace(/[0-9/.]+/,h))},k.prototype.showRatingDialog=function(a){return a.preventDefault(),d("#outcome_criterion_dialog").dialog({autoOpen:!1,title:b.t("outcome_criterion","Learning Outcome Criterion"),width:400,close:function(){return d(a.target).focus()}}).dialog("open")},k.prototype.render=function(){var a;a=this.model.toJSON();switch(this.state){case"edit":this.$el.html(h(a)),this.readyForm();break;case"add":this.$el.html(h(e.extend(a,{points_possible:5,mastery_points:3,ratings:[{description:b.t("criteria.exceeds_expectations","Exceeds Expectations"),points:5},{description:b.t("criteria.meets_expectations","Meets Expectations"),points:3},{description:b.t("criteria.does_not_meet_expectations","Does Not Meet Expectations"),points:0}]}))),this.readyForm();break;case"loading":this.$el.empty();break;default:a.points_possible||(a.points_possible=0),a.mastery_points||(a.mastery_points=0),this.$el.html(g(e.extend(a,{readOnly:this.readOnly(),"native":this.model.outcomeLink.outcome.context_id===this.model.outcomeLink.context_id&&this.model.outcomeLink.outcome.context_type===this.model.outcomeLink.context_type,setQuizMastery:this.setQuizMastery,useForScoring:this.useForScoring,isLargeRoster:ENV.IS_LARGE_ROSTER})))}return this.$("input:first").focus(),this},k}(f)})}).call(this)