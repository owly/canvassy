(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!outcomes","jquery","underscore","compiled/models/OutcomeGroup","compiled/views/DialogBaseView","compiled/views/outcomes/SidebarView","compiled/views/outcomes/ContentView","jst/outcomes/browser","jst/outcomes/findInstructions","compiled/jquery.rails_flash_notifications","jquery.disableWhileLoading"],function(b,d,e,f,g,h,i,j,k){var l,m;return l=function(g){function l(){return this.showOrHideImport=a(this.showOrHideImport,this),this["import"]=a(this["import"],this),m=l.__super__.constructor.apply(this,arguments),m}return c(l,g),l.prototype.dialogOptions=function(){return{id:"import_dialog",title:this.title,width:1e3,resizable:!0,close:function(){return d(".find_outcome").focus()},buttons:[{text:b.t("#buttons.cancel","Cancel"),click:this.cancel},{text:b.t("#buttons.import","Import"),"class":"btn-primary",click:this["import"]}]}},l.prototype.initialize=function(a){return this.selectedGroup=a.selectedGroup,this.title=a.title,this.shouldImport=a.shouldImport===!1?!1:!0,this.disableGroupImport=a.disableGroupImport,l.__super__.initialize.call(this),this.render(),this.dialog.parent().find(".ui-dialog-buttonpane").css("margin-top",0),this.sidebar=new h({el:this.$el.find(".outcomes-sidebar .wrapper"),directoryView:a.directoryView,rootOutcomeGroup:a.rootOutcomeGroup,readOnly:!0}),this.content=new i({el:this.$el.find(".outcomes-content"),instructionsTemplate:k,readOnly:!0,setQuizMastery:a.setQuizMastery,useForScoring:a.useForScoring}),this.sidebar.on("select",this.content.show),this.sidebar.on("select",this.showOrHideImport),this.showOrHideImport()},l.prototype["import"]=function(a){var c,g,h,i=this;a.preventDefault(),g=this.sidebar.selectedModel(),this.content.setQuizMastery&&(g.quizMasteryLevel=parseFloat(this.$el.find("#outcome_mastery_at").val())||0),this.content.useForScoring&&(g.useForScoring=this.$el.find("#outcome_use_for_scoring").prop("checked"));if(g.get("dontImport"))return alert(b.t("dont_import","This group cannot be imported."));if(confirm(this.confirmText(g))){if(!this.shouldImport){this.trigger("import",g),this.close();return}return g instanceof f?(h=this.selectedGroup.get("import_url"),c=d.ajaxJSON(h,"POST",{source_outcome_group_id:g.get("id")})):(h=this.selectedGroup.get("outcomes_url"),c=d.ajaxJSON(h,"POST",{outcome_id:g.get("id")})),this.$el.disableWhileLoading(c),d.when(c).done(function(a,c,h){var j;return j=g.clone(),j instanceof f?j.set(a):(j.outcomeLink=e.extend({},g.outcomeLink),j.outcomeGroup=a.outcome_group,j.outcomeLink.url=a.url,j.set({context_id:a.context_id,context_type:a.context_type})),i.trigger("import",j),i.close(),d.flashMessage(b.t("flash.importSuccess","Import successful"))}).fail(function(){return d.flashError(b.t("flash.importError","An error occurred while importing. Please try again later."))})}},l.prototype.render=function(){return this.$el.html(j({skipToolbar:!0})),this},l.prototype.showOrHideImport=function(){var a,b;return b=this.sidebar.selectedModel(),a=!0,!b||b.get("dontImport")?a=!1:b&&b instanceof f&&this.disableGroupImport&&(a=!1),d(".ui-dialog-buttonpane .btn-primary").toggle(a)},l.prototype.confirmText=function(a){var c;return c=this.selectedGroup.get("title")||b.t("top_level","%{context} Top Level",{context:this.selectedGroup.get("context_type")}),a instanceof f?b.t("confirm.import_group",'Import group "%{group}" to group "%{target}"?',{group:a.get("title"),target:c}):b.t("confirm.import_outcome",'Import outcome "%{outcome}" to group "%{target}"?',{outcome:a.get("title"),target:c})},l}(g)})}).call(this)