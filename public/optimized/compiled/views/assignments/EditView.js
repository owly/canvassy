(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["INST","i18n!assignment","compiled/views/ValidatedFormView","underscore","jquery","wikiSidebar","jst/assignments/EditView","compiled/models/TurnitinSettings","compiled/views/assignments/TurnitinSettingsDialog","compiled/fn/preventDefault","compiled/views/calendar/MissingDateDialogView","compiled/views/assignments/AssignmentGroupSelector","compiled/views/assignments/GroupCategorySelector","compiled/tinymce","tinymce.editor_box","jqueryui/dialog","jquery.toJSON","compiled/jquery.rails_flash_notifications","compiled/jquery/toggleAccessibly"],function(b,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r;return q=function(p){function M(){return this._validateAdvancedOptions=a(this._validateAdvancedOptions,this),this._validateAllowedExtensions=a(this._validateAllowedExtensions,this),this._validateSubmissionTypes=a(this._validateSubmissionTypes,this),this._validateTitle=a(this._validateTitle,this),this.validateBeforeSave=a(this.validateBeforeSave,this),this._filterAllowedExtensions=a(this._filterAllowedExtensions,this),this._inferSubmissionTypes=a(this._inferSubmissionTypes,this),this.submit=a(this.submit,this),this.getFormData=a(this.getFormData,this),this._initializeWikiSidebar=a(this._initializeWikiSidebar,this),this._attachDatepickerToDateFields=a(this._attachDatepickerToDateFields,this),this._attachEditorToDescription=a(this._attachEditorToDescription,this),this.toJSON=a(this.toJSON,this),this.afterRender=a(this.afterRender,this),this.handleSubmissionTypeChange=a(this.handleSubmissionTypeChange,this),this.handleGradingTypeChange=a(this.handleGradingTypeChange,this),this.handleRestrictFileUploadsChange=a(this.handleRestrictFileUploadsChange,this),this.toggleAdvancedTurnitinSettings=a(this.toggleAdvancedTurnitinSettings,this),this.toggleRestrictFileUploads=a(this.toggleRestrictFileUploads,this),this.showExternalToolsDialog=a(this.showExternalToolsDialog,this),this.showTurnitinDialog=a(this.showTurnitinDialog,this),this.toggleAdvancedOptions=a(this.toggleAdvancedOptions,this),this.showingAdvancedOptions=a(this.showingAdvancedOptions,this),this.handleCancel=a(this.handleCancel,this),r=M.__super__.constructor.apply(this,arguments),r}var q,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;return c(M,p),M.prototype.template=i,M.prototype.dontRenableAfterSaveSuccess=!0,v="#assignment_group_selector",z="#assignment_due_date_controls",y='[name="due_at"]',x='[name="description"]',K='[name="submission_type"]',H="#assignment_online_submission_types",G='[name="name"]',u='[name="online_submission_types[online_upload]"]',J="#restrict_file_extensions_container",t="#allowed_extensions_container",q="#advanced_assignment_options",L='[name="turnitin_enabled"]',s="#advanced_turnitin_settings_link",w="#assignment_toggle_advanced_options",E="#grading_type_selector",D="#graded_assignment_fields",C="#assignment_external_tool_settings",F="#group_category_selector",I="#assignment_peer_reviews_fields",B="#assignment_external_tool_tag_attributes_url",A="#assignment_external_tool_tag_attributes_new_tab",M.prototype.els=f.extend({},M.prototype.els,function(){var a;return a={},a[""+v]="$assignmentGroupSelector",a[""+z]="$dueDateArea",a[""+y]="$dueAt",a[""+x]="$description",a[""+K]="$submissionType",a[""+H]="$onlineSubmissionTypes",a[""+G]="$name",a[""+u]="$allowFileUploads",a[""+J]="$restrictFileUploads",a[""+t]="$allowedExtensions",a[""+q]="$advancedAssignmentOptions",a[""+L]="$turnitinEnabled",a[""+s]="$advancedTurnitinSettings",a[""+w]="$assignmentToggleAdvancedOptions",a[""+E]="$gradingTypeSelector",a[""+D]="$gradedAssignmentFields",a[""+C]="$externalToolSettings",a[""+F]="$groupCategorySelector",a[""+I]="$peerReviewsFields",a[""+B]="$externalToolsUrl",a[""+A]="$externalToolsNewTab",a}()),M.prototype.events=f.extend({},M.prototype.events,function(){var a;return a={},a["click .cancel_button"]="handleCancel",a["click "+w]="toggleAdvancedOptions",a["change "+K]="handleSubmissionTypeChange",a["change "+J]="handleRestrictFileUploadsChange",a["click "+s]="showTurnitinDialog",a["change "+L]="toggleAdvancedTurnitinSettings",a["change "+u]="toggleRestrictFileUploads",a["click "+B]="showExternalToolsDialog",a}()),M.child("assignmentGroupSelector",""+v),M.child("gradingTypeSelector",""+E),M.child("groupCategorySelector",""+F),M.child("peerReviewsSelector",""+I),M.prototype.initialize=function(a){return M.__super__.initialize.apply(this,arguments),this.assignment=this.model,this.dueDateOverrideView=a.views["js-assignment-overrides"],this.model.on("sync",function(){return window.location=this.get("html_url")}),this.gradingTypeSelector.on("change:gradingType",this.handleGradingTypeChange)},M.prototype.handleCancel=function(a){a.preventDefault();if(ENV.CANCEL_TO!=null)return window.location=ENV.CANCEL_TO},M.prototype.showingAdvancedOptions=function(){var a;return a=this.$advancedAssignmentOptions.attr("aria-expanded"),a==="true"||a===!0},M.prototype.toggleAdvancedOptions=function(a){var b,c;return a.preventDefault(),g(a.currentTarget).focus(),b=this.showingAdvancedOptions(),this.$advancedAssignmentOptions.attr("aria-expanded",!b),this.$advancedAssignmentOptions.toggle(!b),b?(this.$dueDateArea.show(),c=d.t("show_advanced_options","Show Advanced Options")+" ▼"):(this.$dueDateArea.hide(),c=d.t("hide_advanced_options","Hide Advanced Options")+" ▲"),this.$assignmentToggleAdvancedOptions.text(c)},M.prototype.showTurnitinDialog=function(a){var b,c=this;return a.preventDefault(),b=new k({model:this.assignment.get("turnitin_settings")}),b.render().on("settings:change",function(a){return c.assignment.set("turnitin_settings",new j(a)),b.off(),b.remove()})},M.prototype.showExternalToolsDialog=function(){var a=this;return b.selectContentDialog({dialog_title:d.t("select_external_tool_dialog_title","Configure External Tool"),select_button_text:d.t("buttons.select_url","Select"),no_name_input:!0,submit:function(b){return a.$externalToolsUrl.val(b["item[url]"]),a.$externalToolsNewTab.prop("checked",b["item[new_tab]"]==="1")}})},M.prototype.toggleRestrictFileUploads=function(){return this.$restrictFileUploads.toggleAccessibly(this.$allowFileUploads.prop("checked"))},M.prototype.toggleAdvancedTurnitinSettings=function(a){return a.preventDefault(),this.$advancedTurnitinSettings.toggleAccessibly(this.$turnitinEnabled.prop("checked"))},M.prototype.handleRestrictFileUploadsChange=function(){return this.$allowedExtensions.toggleAccessibly(this.$restrictFileUploads.find("input").prop("checked"))},M.prototype.handleGradingTypeChange=function(a){return this.$gradedAssignmentFields.toggleAccessibly(a!=="not_graded"),this.handleSubmissionTypeChange(null)},M.prototype.handleSubmissionTypeChange=function(a){var b;return b=this.$submissionType.val(),this.$onlineSubmissionTypes.toggleAccessibly(b==="online"),this.$externalToolSettings.toggleAccessibly(b==="external_tool"),this.$groupCategorySelector.toggleAccessibly(b!=="external_tool"),this.$peerReviewsFields.toggleAccessibly(b!=="external_tool")},M.prototype.afterRender=function(){return this._attachDatepickerToDateFields(),this._attachEditorToDescription(),g(this._initializeWikiSidebar),this},M.prototype.toJSON=function(){return f.extend(this.assignment.toView(),{kalturaEnabled:(typeof ENV!="undefined"&&ENV!==null?ENV.KALTURA_ENABLED:void 0)||!1,isLargeRoster:(typeof ENV!="undefined"&&ENV!==null?ENV.IS_LARGE_ROSTER:void 0)||!1})},M.prototype._attachEditorToDescription=function(){var a=this;return this.$description.editorBox(),g(".rte_switch_views_link").click(l(function(){return a.$description.editorBox("toggle")}))},M.prototype._attachDatepickerToDateFields=function(){if(this.assignment.isSimple())return this.$dueAt.datetime_field()},M.prototype._initializeWikiSidebar=function(){return h.inited||(h.init(),g.scrollSidebar()),h.attachToEditor(this.$description).show()},M.prototype.getFormData=function(){var a,b;a=M.__super__.getFormData.apply(this,arguments),a=this._inferSubmissionTypes(a),a=this._filterAllowedExtensions(a);if(typeof ENV!="undefined"&&ENV!==null?!ENV.IS_LARGE_ROSTER:!void 0)a=this.groupCategorySelector.filterFormData(a);return this.showingAdvancedOptions()&&(this.dueDateOverrideView.updateOverrides(),b=this.dueDateOverrideView.getDefaultDueDate(),a.lock_at=(b!=null?b.get("lock_at"):void 0)||null,a.unlock_at=(b!=null?b.get("unlock_at"):void 0)||null,a.due_at=(b!=null?b.get("due_at"):void 0)||null,a.assignment_overrides=this.dueDateOverrideView.getOverrides()),a},M.prototype.submit=function(a){var b,c,d=this;return a.preventDefault(),a.stopPropagation(),this.dueDateOverrideView.updateOverrides(),this.dueDateOverrideView.containsSectionsWithoutOverrides()?(c=this.dueDateOverrideView.sectionsWithoutOverrides(),b=new m({validationFn:function(){return c},labelFn:function(a){return a.get("name")},success:function(){return d.model.setNullDates(),e.prototype.submit.call(d)}}),b.cancel=function(a){return b.$dialog.dialog("close").remove()},b.render()):M.__super__.submit.apply(this,arguments)},M.prototype._inferSubmissionTypes=function(a){var b;return a.grading_type==="not_graded"?a.submission_types=["not_graded"]:a.submission_type==="online"?(b=f.select(f.keys(a.online_submission_types),function(b){return a.online_submission_types[b]}),a.submission_types=b):a.submission_types=[a.submission_type],delete a.online_submission_type,delete a.online_submission_types,a},M.prototype._filterAllowedExtensions=function(a){var b;return b=a.restrict_file_extensions,delete a.restrict_file_extensions,b?a.allowed_extensions=f.select(a.allowed_extensions.split(","),function(a){return g.trim(a.toString()).length>0}):a.allowed_extensions=null,a},M.prototype.fieldSelectors=f.extend({assignmentToggleAdvancedOptions:"#assignment_toggle_advanced_options"},n.prototype.fieldSelectors,o.prototype.fieldSelectors),M.prototype.showErrors=function(a){return delete a.assignmentOverrides,M.__super__.showErrors.call(this,a)},M.prototype.validateBeforeSave=function(a,b){var c;b=this._validateTitle(a,b),b=this._validateSubmissionTypes(a,b),b=this._validateAllowedExtensions(a,b),b=this.assignmentGroupSelector.validateBeforeSave(a,b);if(typeof ENV!="undefined"&&ENV!==null?!ENV.IS_LARGE_ROSTER:!void 0)b=this.groupCategorySelector.validateBeforeSave(a,b);return b=this._validateAdvancedOptions(a,b),c={assignment_overrides:this.dueDateOverrideView.getAllDates(a)},b=this.dueDateOverrideView.validateBeforeSave(c,b),b},M.prototype._validateTitle=function(a,b){if(!a.name||g.trim(a.name.toString()).length===0)b.name=[{message:d.t("name_is_required","Name is required!")}];return b},M.prototype._validateSubmissionTypes=function(a,b){return a.submission_type==="online"&&a.submission_types.length===0&&(b["online_submission_types[online_text_entry]"]=[{message:d.t("at_least_one_submission_type","Please choose at least one submission type")}]),b},M.prototype._validateAllowedExtensions=function(a,b){return a.allowed_extensions&&a.allowed_extensions.length===0&&(b.allowed_extensions=[{message:d.t("at_least_one_file_type","Please specify at least one allowed file type")}]),b},M.prototype._validateAdvancedOptions=function(a,b){var c,e;return c=this.$advancedAssignmentOptions.attr("aria-expanded"),e=c==="true"||c===!0,f.keys(b).length>0&&!e&&(b.assignmentToggleAdvancedOptions=[{message:d.t("advanced_options_errors","There were errors on one or more advanced options")}]),b},M}(e)})}).call(this)