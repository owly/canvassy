(function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define(["underscore","jquery","Backbone","jst/PaginatedView"],function(a,c,d,e){var f,g;return f=function(d){function f(){return g=f.__super__.constructor.apply(this,arguments),g}return b(f,d),f.prototype.paginationLoaderTemplate=e,f.prototype.paginationScrollContainer=window,f.prototype.distanceTillFetchNextPage=100,f.prototype.initialize=function(a){var b;return b=f.__super__.initialize.call(this,a),this.fetchOptions=a.fetchOptions,this.startPaginationListener(),this.bindPaginationEvents(),b},f.prototype.render=function(){var a;return a=f.__super__.render.apply(this,arguments),this.collection.fetchingNextPage&&this.showPaginationLoader(),a},f.prototype.showPaginationLoader=function(){var a;return(a=this.$paginationLoader)==null&&(this.$paginationLoader=c(this.paginationLoaderTemplate())),this.placePaginationLoader()},f.prototype.placePaginationLoader=function(){var a;return(a=this.$paginationLoader)!=null?a.insertAfter(this.el):void 0},f.prototype.hidePaginationLoader=function(){var a;return(a=this.$paginationLoader)!=null?a.remove():void 0},f.prototype.distanceToBottom=function(){var a,b;return a=c(this.paginationScrollContainer),b=a[0]===window?c(document).height():a[0].scrollHeight,b-a.scrollTop()-a.height()},f.prototype.startPaginationListener=function(){return c(this.paginationScrollContainer).on("scroll.pagination"+this.cid+", resize.pagination"+this.cid,c.proxy(this.fetchNextPageIfNeeded,this)),this.fetchNextPageIfNeeded()},f.prototype.stopPaginationListener=function(){return c(this.paginationScrollContainer).off(".pagination"+this.cid)},f.prototype.fetchNextPageIfNeeded=function(){var b=this;if(this.collection.fetchingNextPage)return;if(!this.collection.urls||!this.collection.urls.next){this.collection.length&&this.stopPaginationListener();return}return setTimeout(function(){if(c(b.paginationScrollContainer).is(":visible")&&b.distanceToBottom()<b.distanceTillFetchNextPage)return b.collection.fetch(a.extend({page:"next"},b.fetchOptions))},0)},f.prototype.bindPaginationEvents=function(){return this.collection.on("beforeFetch:next",this.showPaginationLoader,this),this.collection.on("fetch:next",this.hidePaginationLoader,this),this.collection.on("all",this.fetchNextPageIfNeeded,this)},f}(d.View)})}).call(this)