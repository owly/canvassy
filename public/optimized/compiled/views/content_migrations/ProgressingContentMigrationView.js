(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["jquery","Backbone","jst/content_migrations/ProgressingContentMigration","jst/content_migrations/ProgressingIssues","compiled/views/PaginatedCollectionView","compiled/views/content_migrations/ContentMigrationIssueView","compiled/views/content_migrations/ProgressBarView","compiled/views/content_migrations/ProgressStatusView","compiled/views/content_migrations/SelectContentView"],function(b,d,e,f,g,h,i,j,k){var l,m;return l=function(d){function l(){return this.showSelectContentDialog=a(this.showSelectContentDialog,this),this.render=a(this.render,this),m=l.__super__.constructor.apply(this,arguments),m}return c(l,d),l.prototype.template=e,l.prototype.tagName="li",l.prototype.className="clearfix migrationProgressItem",l.prototype.events={"click .showIssues":"toggleIssues","click .selectContentBtn":"showSelectContentDialog"},l.prototype.els={".migrationIssues":"$migrationIssues",".changable":"$changable",".progressStatus":"$progressStatus",".selectContentDialog":"$selectContentDialog","[data-bind=migration_issues_count]":"$issuesCount"},l.prototype.initialize=function(){var a=this;return l.__super__.initialize.apply(this,arguments),this.issuesLoaded=!1,this.progress=this.model.progressModel,this.issues=this.model.issuesCollection,this.model.on("continue",function(){var b;return(b=a.progress)!=null&&b.poll(),a.render()})},l.prototype.toJSON=function(){var a;a=l.__super__.toJSON.apply(this,arguments),a.display_name=this.displayName(),a.created_at=this.createdAt(),a.issuesCount=this.model.get("migration_issues_count");switch(this.model.get("workflow_state")){case"waiting_for_select":a.waiting_for_select=!0;break;case"completed":case"failed":this.model.get("migration_issues_count")>0&&(a.migration_issues=!0);break;case"failed":a.message=this.model.get("message")||this.progress.get("message");break;case"running":a.loading=!0}return a},l.prototype.displayName=function(){return this.model.get("migration_type_title")||"Content Migration"},l.prototype.createdAt=function(){return this.model.get("created_at")||b.dateToISO8601UTC(new Date)},l.prototype.render=function(){var a,b;return l.__super__.render.apply(this,arguments),a=new g({collection:this.issues,itemView:h,template:f}),this.$migrationIssues.html(a.render().el),b=new j({model:this.model,el:this.$progressStatus}),b.render(),this},l.prototype.afterRender=function(){var a=this;return this.model.get("workflow_state")==="running"&&(this.progress.get("workflow_state")==="running"&&this.renderProgressBar(),this.progress.on("change:workflow_state",function(b){if(a.progress.get("workflow_state")==="running")return a.renderProgressBar()})),this.progress.on("complete",function(b){return a.updateMigrationModel()})},l.prototype.renderProgressBar=function(){var a;return a=new i({model:this.progress,el:this.$changable}),a.render()},l.prototype.updateMigrationModel=function(){var a=this;return this.model.fetch({error:function(b,c,d){return a.model.set("status","failed")},success:function(b,c,d){return a.render()}})},l.prototype.toggleIssues=function(a){var b,c=this;return a.preventDefault(),this.issuesLoaded?(this.$migrationIssues.toggle(),this.setIssuesButtonText()):(b=this.fetchIssues(),b.done(function(){return c.issuesLoaded=!0,c.toggleIssues(a)}))},l.prototype.fetchIssues=function(){var a;return this.model.set("issuesButtonText","Loading..."),a=this.issues.fetch(),this.$el.disableWhileLoading(a),a},l.prototype.setIssuesButtonText=function(){var a;return a=this.model.get("issuesButtonText"),a.indexOf("issues")!==-1||a.indexOf("Loading...")!==-1?(this.$issuesCount.hide(),this.model.set("issuesButtonText","Hide Issues")):(this.$issuesCount.show(),this.model.set("issuesButtonText","issues"))},l.prototype.showSelectContentDialog=function(a){return a.preventDefault(),this.selectContentView||(this.selectContentView=new k({model:this.model,el:this.$selectContentDialog,title:"Select Content",width:900,height:700})),this.selectContentView.open()},l}(d.View)})}).call(this)