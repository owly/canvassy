(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!quizzes","compiled/views/ValidatedFormView","jst/messageStudentsDialog","compiled/models/Conversation","jst/_messageStudentsWhoRecipientList","underscore","compiled/jquery/serializeForm"],function(b,d,e,f,g,h){var i,j;return i=function(i){function k(){return this.updateListOfRecipients=a(this.updateListOfRecipients,this),this.getFormData=a(this.getFormData,this),this._findRecipientGroupByName=a(this._findRecipientGroupByName,this),this.validateBeforeSave=a(this.validateBeforeSave,this),this.toJSON=a(this.toJSON,this),j=k.__super__.constructor.apply(this,arguments),j}return c(k,i),k.optionProperty("recipientGroups"),k.optionProperty("context"),k.prototype.els={"[name=recipientGroupName]":"$recipientGroupName","#message-recipients":"$messageRecipients","[name=body]":"$messageBody"},k.prototype.template=e,k.prototype.className="validated-form-view form-dialog",k.prototype.initialize=function(a){return k.__super__.initialize.apply(this,arguments),this.title=this.context?b.t("message_students_for_context","Message students for %{context}",{context:this.context}):b.t("message_students","Message students"),this.recipients=this.recipientGroups[0].recipients,this.model||(this.model=new f)},k.prototype.events=h.extend({},d.prototype.events,{"change [name=recipientGroupName]":"updateListOfRecipients","click .dialog_closer":"close"}),k.prototype.toJSON=function(){var a,b,c,d,e;a={},e=["title","recipients","recipientGroups"];for(c=0,d=e.length;c<d;c++)b=e[c],a[b]=this[b];return a},k.prototype.validateBeforeSave=function(a,b){var c;return c=this.model.validate(a),c&&(c.body&&(b.body=c.body),c.recipients&&(b.recipientGroupName=c.recipients)),b},k.prototype._findRecipientGroupByName=function(a){return h.detect(this.recipientGroups,function(b){return b.name===a})},k.prototype.getFormData=function(){var a,b,c,d;return d=this.$el.toJSON(),b=d.recipientGroupName,a=d.body,c=this._findRecipientGroupByName(b).recipients,{body:a,recipients:h.pluck(c,"id")}},k.prototype.updateListOfRecipients=function(){var a,b;return a=this.$recipientGroupName.val(),b=this._findRecipientGroupByName(a).recipients,this.$messageRecipients.html(g({recipients:b}))},k.prototype.onSaveSuccess=function(){return this.close(),$.flashMessage(b.t("notices.message_sent","Message Sent!"))},k.prototype.open=function(){return this.render(),this.$el.dialog({autoOpen:!1,height:500,width:500,title:this.title}).dialog("open")},k.prototype.close=function(){return this.$el.dialog("close"),this.remove()},k}(d)})}).call(this)