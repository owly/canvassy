(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["jst/discussions/noResults","underscore","compiled/views/DiscussionTopic/FilterEntryView","compiled/views/DiscussionTopic/EntryCollectionView","compiled/collections/EntryCollection","compiled/regexp/rEscape"],function(b,d,e,f,g,h){var i,j;return i=function(i){function k(){return this.queryFilter=a(this.queryFilter,this),this.unreadFilter=a(this.unreadFilter,this),this.renderOrTeardownResults=a(this.renderOrTeardownResults,this),this.render=a(this.render,this),this.clearModel=a(this.clearModel,this),this.add=a(this.add,this),this.resetCollection=a(this.resetCollection,this),j=k.__super__.constructor.apply(this,arguments),j}return c(k,i),k.prototype.defaults=d.extend({},f.prototype.defaults,{descendants:0,displayShowMore:!0,threaded:!0}),k.prototype.initialize=function(){return k.__super__.initialize.apply(this,arguments),this.allData=this.options.allData},k.prototype.attach=function(){return this.model.on("change",this.renderOrTeardownResults)},k.prototype.setAllReadState=function(a){if(this.collection!=null)return this.collection.fullCollection.each(function(b){return b.set("read_state",a)})},k.prototype.resetCollection=function(a){var b,c=this;return b=new g(a,{perPage:10}),this.collection=b.getPageAsCollection(0),this.collection.on("add",this.add),this.render(),this.collection.on("change:read_state",function(a,b){var d;c.trigger("readStateChanged",a.id,b),d=$("#entry-"+a.id);if(d.length){a=d.data("view").model;if(a)return a.set("read_state",b)}})},k.prototype.add=function(a){var b,c=this;return b=new e({model:a}),b.render(),b.on("click",function(){return c.clearModel(),setTimeout(function(){return c.trigger("clickEntry",b.model)},1)}),this.list.append(b.el)},k.prototype.toggleRead=function(a){return a.preventDefault(),this.model.get("read_state")==="read"?this.model.markAsUnread():this.model.markAsRead()},k.prototype.clearModel=function(){return this.model.reset()},k.prototype.render=function(){return this.collection!=null&&k.__super__.render.apply(this,arguments),this.trigger("render"),this.$el.removeClass("hidden")},k.prototype.renderOrTeardownResults=function(){var a,b,c,d,e,f,g;if(this.model.hasFilter()){e=function(){var b,c;b=this.allData.flattened,c=[];for(d in b)a=b[d],c.push(a);return c}.call(this),g=this.model.toJSON();for(b in g)f=g[b],c=this[""+b+"Filter"],c&&(e=c(f,e));return e.length?this.resetCollection(e):this.renderNoResults()}if(!this.model.hasFilter())return this.$el.addClass("hidden"),this.trigger("hide")},k.prototype.renderNoResults=function(){return this.render(),this.$el.html(b)},k.prototype.unreadFilter=function(a,b){return a?(a=d.filter(b,function(a){return a.read_state==="unread"}),a.sort(function(a,b){return Date.parse(a.created_at)-Date.parse(b.created_at)})):b},k.prototype.queryFilter=function(a,b){var c,e;return c=function(){var b,c,d,f;d=(a!=null?a:"").trim().split(/\s+/g),f=[];for(b=0,c=d.length;b<c;b++)e=d[b],f.push(new RegExp(h(e),"i"));return f}(),c.length?d.filter(b,function(a){var b,d,e,f;b=""+a.message+"\n"+a.author.display_name+" ";for(e=0,f=c.length;e<f;e++){d=c[e];if(!d.test(b))return!1}return!0}):b},k}(f)})}).call(this)