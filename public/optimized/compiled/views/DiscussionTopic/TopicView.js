(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!discussions","jquery","Backbone","underscore","compiled/models/DiscussionTopic","compiled/views/DiscussionTopic/EntriesView","compiled/views/DiscussionTopic/EntryView","jst/discussions/_reply_form","compiled/discussions/Reply","compiled/widget/assignmentRubricDialog","compiled/util/wikiSidebarWithMultipleEditors","jquery.instructure_misc_helpers","str/htmlEscape"],function(b,d,e,f,g,h,i,j,k,l,m){var n,o;return n=function(e){function f(){return this.subscriptionStatusChanged=a(this.subscriptionStatusChanged,this),this.hideIfFiltering=a(this.hideIfFiltering,this),o=f.__super__.constructor.apply(this,arguments),o}return c(f,e),f.prototype.events={"click #discussion_topic .discussion-reply-action[data-event]":"handleEvent","click .add_root_reply":"addRootReply","click .discussion_locked_toggler":"toggleLocked","click .toggle_due_dates":"toggleDueDates","click .rte_switch_views_link":"toggleEditorMode","click .topic-subscribe-button":"subscribeTopic","click .topic-unsubscribe-button":"unsubscribeTopic"},f.prototype.els={".add_root_reply":"$addRootReply","#discussion_topic":"$topic",".due_date_wrapper":"$dueDates",".reply-textarea:first":"$textarea","#discussion-toolbar":"$discussionToolbar",".topic-subscribe-button":"$subscribeButton",".topic-unsubscribe-button":"$unsubscribeButton"},f.prototype.initialize=function(){var a=this;return this.model.set("id",ENV.DISCUSSION.TOPIC.ID),this.model.cid="main",this.model.set("canAttach",ENV.DISCUSSION.PERMISSIONS.CAN_ATTACH),this.filterModel=this.options.filterModel,this.filterModel.on("change",this.hideIfFiltering),this.topic=new g({id:ENV.DISCUSSION.TOPIC.ID}),this.topic.url=ENV.DISCUSSION.ROOT_URL.replace(/\/view/m,""),this.topic.set("subscribed",ENV.DISCUSSION.TOPIC.IS_SUBSCRIBED),i.on("addReply",function(){return a.setSubscribed(!0)})},f.prototype.hideIfFiltering=function(){return this.filterModel.hasFilter()?this.$topic.addClass("hidden"):this.$topic.removeClass("hidden")},f.prototype.afterRender=function(){return f.__super__.afterRender.apply(this,arguments),d(document.body).is(".with-right-side")&&d.scrollSidebar(),l.initTriggers(),this.$el.toggleClass("side_comment_discussion",!ENV.DISCUSSION.THREADED),this.subscriptionStatusChanged()},f.prototype.filter=f.prototype.afterRender,f.prototype.toggleLocked=function(a){var b;return b=d(a.currentTarget).data("mark-locked"),this.topic.save({locked:b}).done(function(){return window.location.reload()})},f.prototype.toggleDueDates=function(a){return a.preventDefault(),this.$dueDates.toggleClass("hidden"),d(a.currentTarget).text(this.$dueDates.hasClass("hidden")?b.t("show_due_dates","Show Due Dates"):b.t("hide_due_dates","Hide Due Dates"))},f.prototype.toggleEditorMode=function(a){return a.preventDefault(),a.stopPropagation(),this.$textarea.editorBox("toggle")},f.prototype.subscribeTopic=function(a){a.preventDefault(),this.topic.topicSubscribe(),this.subscriptionStatusChanged();if(this.$subscribeButton.is(":focus"))return this.$unsubscribeButton.focus()},f.prototype.unsubscribeTopic=function(a){a.preventDefault(),this.topic.topicUnsubscribe(),this.subscriptionStatusChanged();if(this.$unsubscribeButton.is(":focus"))return this.$subscribeButton.focus()},f.prototype.subscriptionStatusChanged=function(){var a;a=this.topic.get("subscribed"),this.$discussionToolbar.removeClass("subscribed"),this.$discussionToolbar.removeClass("unsubscribed");if(ENV.DISCUSSION.CAN_SUBSCRIBE)return a?this.$discussionToolbar.addClass("subscribed"):this.$discussionToolbar.addClass("unsubscribed")},f.prototype.addReply=function(a){var b=this;return a!=null&&a.preventDefault(),this.reply==null&&(this.reply=new k(this,{topLevel:!0,focus:!0}),this.reply.on("edit",function(){var a;return(a=b.$addRootReply)!=null?a.hide():void 0}),this.reply.on("hide",function(){var a;return(a=b.$addRootReply)!=null?a.show():void 0}),this.reply.on("save",function(a){return b.setSubscribed(!0),b.trigger("addReply",a)})),this.model.set("notification",""),this.reply.edit()},f.prototype.setSubscribed=function(a){return this.topic.set("subscribed",!0),this.subscriptionStatusChanged()},f.prototype.addReplyAttachment=i.prototype.addReplyAttachment,f.prototype.removeReplyAttachment=i.prototype.removeReplyAttachment,f.prototype.handleEvent=function(a){var b,c;return b=d(a.currentTarget),c=b.data("event"),typeof this[c]=="function"?this[c](a,b):void 0},f.prototype.render=function(){var a,b;return ENV.DISCUSSION.PERMISSIONS.CAN_REPLY&&(b=this.model.toJSON(),b.showBoxReplyLink=!0,a=j(b),this.$("#discussion_topic").append(a)),f.__super__.render.apply(this,arguments)},f.prototype.format=function(a,b){return a==="notification"?b:m(b)},f.prototype.addRootReply=function(a){var b,c;return b=this.$(a.currentTarget),c=d("#discussion_topic .discussion-reply-form"),this.addReply(a),d("html, body").animate({scrollTop:c.offset().top-100})},f}(e.View)})}).call(this)