(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!roster","jquery","underscore","Backbone","jst/courses/roster/rosterUser","compiled/views/courses/roster/EditSectionsView","compiled/views/courses/roster/InvitationsView","compiled/views/courses/roster/LinkToStudentsView","compiled/str/underscore","str/htmlEscape","compiled/jquery.kylemenu"],function(b,d,e,f,g,h,i,j,k,l){var m,n,o,p,q;return n=null,p=null,o=null,m=function(f){function k(){return this.blur=a(this.blur,this),this.focus=a(this.focus,this),this.handleMenuEvent=a(this.handleMenuEvent,this),q=k.__super__.constructor.apply(this,arguments),q}return c(k,f),k.prototype.tagName="tr",k.prototype.className="rosterUser al-hover-container",k.prototype.template=g,k.prototype.events={"click .admin-links [data-event]":"handleMenuEvent","focus *":"focus","blur *":"blur"},k.prototype.attach=function(){return this.model.on("change",this.render,this)},k.prototype.initialize=function(a){var b,c,d,e,f,g;k.__super__.initialize.apply(this,arguments),this.model.currentRole=(e=this.model.get("enrollments")[0])!=null?e.role:void 0,this.$el.attr("id","user_"+a.model.get("id")),f=this.model.get("enrollments"),g=[];for(c=0,d=f.length;c<d;c++)b=f[c],g.push(this.$el.addClass(b.role));return g},k.prototype.toJSON=function(){var a;return a=k.__super__.toJSON.apply(this,arguments),this.permissionsJSON(a),this.observerJSON(a),a},k.prototype.permissionsJSON=function(a){var b=this;return a.url=""+ENV.COURSE_ROOT_URL+"/users/"+this.model.get("id"),a.isObserver=this.model.hasEnrollmentType("ObserverEnrollment"),a.isPending=this.model.pending(this.model.currentRole),a.canEditSections=!e.isEmpty(this.model.sectionEditableEnrollments()),a.canViewLoginIdColumn=ENV.permissions.manage_admin_users||ENV.permissions.manage_students,a.canViewLoginId=a.canManage=e.any(["TeacherEnrollment","DesignerEnrollment","TaEnrollment"],function(a){return b.model.hasEnrollmentType(a)})?ENV.permissions.manage_admin_users:ENV.permissions.manage_students},k.prototype.observerJSON=function(a){var c,d,f,g,h,i,j,k,l,m;if(a.isObserver){g=e.filter(a.enrollments,function(a){return a.type==="ObserverEnrollment"}),a.enrollments=e.reject(a.enrollments,function(a){return a.type==="ObserverEnrollment"}),a.sections=e.map(a.enrollments,function(a){return ENV.CONTEXTS.sections[a.course_section_id]}),i={};if(g.length===1&&!g[0].observed_user)i[""]={name:b.t("nobody","nobody")};else for(j=0,k=g.length;j<k;j++){c=g[j];if(!c.observed_user)continue;h=c.observed_user,i[l=h.id]||(i[l]=h)}m=[];for(d in i)h=i[d],f={role:b.t("observing_user","Observing: %{user_name}",{user_name:h.name})},m.push(a.enrollments.push(f));return m}},k.prototype.resendInvitation=function(a){return o||(o=new i),o.model=this.model,o.render().show()},k.prototype.editSections=function(a){return n||(n=new h),n.model=this.model,n.render().show()},k.prototype.linkToStudents=function(a){return p||(p=new j),p.model=this.model,p.render().show()},k.prototype.removeFromCourse=function(a){var c,f,g,h=this;if(!confirm(b.t("delete_confirm","Are you sure you want to remove this user?")))return;return this.$el.hide(),g=function(){return d.flashMessage(b.t("flash.removed","User successfully removed."))},f=function(){return h.$el.show(),d.flashError(b.t("flash.removeError","Unable to remove the user. Please try again later."))},c=e.map(this.model.allEnrollmentsByRole(this.model.currentRole),function(a){return d.ajaxJSON(""+ENV.COURSE_ROOT_URL+"/unenroll/"+a.id,"DELETE")}),d.when.apply(d,c).then(g,f)},k.prototype.handleMenuEvent=function(a){var b;return this.blur(),a.preventDefault(),b=d(a.currentTarget).data("event"),this[b].call(this,a)},k.prototype.focus=function(){return this.$el.addClass("al-hover-container-active table-hover-row")},k.prototype.blur=function(){return this.$el.removeClass("al-hover-container-active table-hover-row")},k}(f.View)})}).call(this)