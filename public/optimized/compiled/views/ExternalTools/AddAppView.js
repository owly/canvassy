(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["Backbone","i18n!external_tools","underscore","jst/ExternalTools/AddAppView","jquery.disableWhileLoading"],function(b,d,e,f,g){var h,i;return h=function(b){function g(){return this.onSaveFail=a(this.onSaveFail,this),this.toJSON=a(this.toJSON,this),i=g.__super__.constructor.apply(this,arguments),i}return c(g,b),g.prototype.template=f,g.prototype.tagName="form",g.prototype.id="add_app_form",g.prototype.className="validated-form-view form-horizontal bootstrap-form",g.prototype.initialize=function(){return g.__super__.initialize.apply(this,arguments),this.app=this.options.app,this.model.set("name",this.app.get("name")),this.model.set("config_url",this.app.get("config_url")),this.model.set("description",this.app.get("description")),this.model.set("config_type","by_url"),this.model.on("error",this.onSaveFail,this),this.configOptions=this.app.get("config_options")||[],this.app.get("any_key")?(this.model.set("consumer_key","N/A"),this.model.set("shared_secret","N/A")):this.configOptions=this.keySecretConfigOptions().concat(this.configOptions)},g.prototype.afterRender=function(){var a=this;return this.$el.dialog({title:d.t("dialog_title_add_app","Add App"),width:520,height:"auto",resizable:!0,close:function(){return a.$el.remove()},buttons:[{"class":"btn-primary",text:d.t("submit","Submit"),"data-text-while-loading":d.t("saving","Saving..."),click:function(){return a.submit()}}]}),this.$el.submit(function(b){return a.submit(),!1}),this},g.prototype.toJSON=function(){var a;return a=g.__super__.toJSON.apply(this,arguments),a.anyKey=this.app.get("any_key"),a.configOptions=[],e.each(this.configOptions,function(b){return b.type==="checkbox"&&(b.isCheckbox=!0),b.type==="text"&&(b.isText=!0),a.configOptions.push(b)}),a},g.prototype.submit=function(){var a,b;b=this.$el.getFormData();if(this.validate(b))return b.canvas_app_name&&this.model.set("name",b.canvas_app_name),b.consumer_key&&this.model.set("consumer_key",b.consumer_key),b.shared_secret&&this.model.set("shared_secret",b.shared_secret),a=new $.Deferred,this.updateConfigUrl(b),this.model.save({error:function(){return a.reject()},success:function(){return a.resolve()}}),this.$el.disableWhileLoading(a)},g.prototype.updateConfigUrl=function(a){var b,c,d,e,f,g,h;b=this.model.get("config_url"),e={},h=this.configOptions;for(f=0,g=h.length;f<g;f++)d=h[f],a[d.name]&&(e[d.name]=a[d.name]);return delete e.consumer_key,delete e.shared_secret,c=this.model.get("config_url")+(b.indexOf("?")!==-1?"&":"?")+$.param(e),this.model.set("config_url",c)},g.prototype.validate=function(a){var b,c,d,e,f;this.removeErrors(),c=function(){var b,c,e,f;e=this.configOptions,f=[];for(b=0,c=e.length;b<c;b++)d=e[b],!a[d.name]&&d.required&&f.push(d);return f}.call(this);for(e=0,f=c.length;e<f;e++)b=c[e],this.addError("input[name='"+b.name+"']","Required");return c.length===0},g.prototype.removeErrors=function(){return this.$(".error .help-inline").remove(),this.$(".control-group").removeClass("error"),this.$(".alert.alert-error").remove()},g.prototype.addError=function(a,b){return a=this.$(a),a.parents(".control-group").addClass("error"),a.after("<span class='help-inline'>"+b+"</span>"),a.one("keypress",function(){return $(this).parents(".control-group").removeClass("error"),$(this).parents(".control-group").find(".help-inline").remove()})},g.prototype.onSaveFail=function(a){var b;return b=d.t("generic_error","There was an error in processing your request"),this.$el.prepend("<div class='alert alert-error'>"+b+"</span>")},g.prototype.keySecretConfigOptions=function(){return[{type:"text",name:"consumer_key",description:d.t("consumer_key","Consumer Key"),required:!0},{type:"text",name:"shared_secret",description:d.t("shared_secret","Shared Secret"),required:!0}]},g}(b.View)})}).call(this)