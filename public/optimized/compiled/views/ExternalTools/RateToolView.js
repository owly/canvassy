(function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define(["Backbone","jquery","i18n!external_tools","str/htmlEscape","jst/ExternalTools/RateToolView","compiled/models/AppReview"],function(a,c,d,e,f,g){var h,i;return h=function(a){function g(){return i=g.__super__.constructor.apply(this,arguments),i}return b(g,a),g.prototype.template=f,g.prototype.tagName="form",g.prototype.id="rate_app_form",g.prototype.els={"#rate-app-star":"$rateAppStar",'textarea[name="review_text"]':"$reviewText"},g.prototype.afterRender=function(){var a=this;return this.$reviewText.html(this.model.get("comments")),this.$rateAppStar.raty({path:"/images/raty/",size:24,starOff:"star-off-big.png",starOn:"star-on-big.png",score:this.model.get("rating"),click:function(a,b){return c(".alert-error").remove()}}),this.$el.dialog({title:d.t("dialog_title_rate_tool","How do you rate this tool?"),width:520,height:"auto",resizable:!0,close:function(){return a.$el.remove()},buttons:[{text:d.t("buttons.cancel","Cancel"),click:function(){return c(this).dialog("close")}},{"class":"btn-primary",text:d.t("submit","Submit"),"data-text-while-loading":d.t("saving","Saving..."),click:function(){return a.submit()}}]}),this.$el.submit(function(b){return a.submit(),!1}),this},g.prototype.submit=function(){var a=this;return c(".alert-error").remove(),this.$rateAppStar.raty("score")?(this.model.save({id:void 0,rating:this.$rateAppStar.raty("score"),comments:this.$reviewText.val()},{success:function(a,b){return b.type==="error"&&c.flashError(e(d.t("save_failed","Unable to save review: %{message}",{message:b.message}))),a.trigger("sync")}}),this.$el.dialog("close")):this.showErrorMessage()},g.prototype.showErrorMessage=function(){var a;return a=d.t("missing_stars","You must select a star rating"),this.$el.prepend("<div class='alert alert-error'>"+a+"</span>")},g}(a.View)})}).call(this)