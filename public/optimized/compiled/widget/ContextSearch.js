(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define(["i18n!recipient_input","jquery","underscore","compiled/util/contextList","compiled/widget/TokenInput","str/htmlEscape"],function(b,d,e,f,g,h){var i;return i=function(g){function h(b,c){this.contextList=a(this.contextList,this),this.buildContextInfo=a(this.buildContextInfo,this),this.populator=a(this.populator,this),c=d.extend(!0,{},this.defaults(),c),this.prefixUserIds=c.prefixUserIds,this.contexts=c.contexts,c.canToggle&&(this.canToggle=c.canToggle),h.__super__.constructor.call(this,b,c)}return c(h,g),h.prototype.defaults=function(){return{placeholder:b.t("context_search_placeholder","Enter a name, course, or group"),selector:{messages:{noResults:b.t("no_results","No results found")},populator:this.populator,baseData:{synthetic_contexts:1},browser:{data:{types:["context"]}}}}},h.prototype.populator=function(a,c,e,f){var g,h,i,j,k,l,m,n,o;f==null&&(f={}),l=(n=f.noExpand)!=null?n:e.noExpand,e.id=""+e.id,(o=e.type)==null&&(e.type="user"),e.avatar_url&&c.append(d("<img />",{alt:"","class":"avatar",src:e.avatar_url})),g=d("<b />"),g.text(e.name),i=d("<span />",{id:""+e.type+"-"+e.id+"-description"}),j=d("<span />",{"class":"name"}),f.parent||(h=this.buildContextInfo(e)),j.append(g,h),k=d("<span />",{"class":"details"}),e.common_courses!=null?k.html(this.contextList({courses:e.common_courses,groups:e.common_groups})):e.user_count!=null?k.text(b.t("people_count","person",{count:e.user_count})):e.item_count!=null?e.id.match(/_groups$/)?k.text(b.t("groups_count","group",{count:e.item_count})):e.id.match(/_sections$/)&&k.text(b.t("sections_count","section",{count:e.item_count})):e.subText&&k.text(e.subText),i.append(j,k),c.append(i),c.attr("role","menuitem"),c.attr("aria-labelledby",""+e.type+"-"+e.id+"-description"),m=e.name,f.parent&&(e.selectAll&&l?m=f.parent.data("text"):e.id.match(/_\d+_/)&&(m=b.beforeLabel(f.parent.data("text"))+" "+m)),c.data("text",m),c.data("id",e.type==="context"||!this.prefixUserIds?e.id:"user_"+e.id),e.rootId=f.ancestors[0],c.data("user_data",e),c.addClass(e.type),f.level>0&&a.options.showToggles&&(c.prepend('<a class="toggle"><i></i></a>'),this.canToggle(e)&&c.addClass("toggleable"));if(e.type==="context"&&!l)return c.prepend('<a class="expand"><i></i></a>'),c.addClass("expandable")},h.prototype.canToggle=function(a){return!a.item_count},h.prototype.buildContextInfo=function(a){var b,c,e;c=a.id.match(/^(course|section)_(\d+)$/),c&&(e=this.contexts[""+c[1]+"s"][c[2]]),b=a.context_name||"",b=b.length<40?b:b.substr(0,40)+"...";if(e!=null?e.term:void 0)b=b?""+b+" - "+e.term:e.term;return b?d("<span />",{"class":"context_info"}).text("("+b+")"):""},h.prototype.contextList=function(a){return a={courses:e.keys(a.courses),groups:e.keys(a.groups)},f(a,this.contexts,{linkToContexts:!1,hardCutoff:2})},h}(g),d.fn.contextSearch=function(a){return this.each(function(){return new i(d(this),d.extend(!0,{},a))})},i})}).call(this)