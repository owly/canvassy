(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["i18n!media_comments","underscore","jst/widget/UploadMediaTrackForm","vendor/mediaelement-and-player","jquery"],function(b,c,d,e,f){var g;return g=function(){function g(g,h){var i,j=this;this.mediaCommentId=g,this.video_url=h,this.onSubmit=a(this.onSubmit,this),i={languages:c.map(e.language.codes,function(a,b){return{name:a,code:b}}),video_url:this.video_url,is_amazon_url:this.video_url.search(/.mp4/)!==-1},this.$dialog=f(d(i)).appendTo("body").dialog({width:650,resizable:!1,buttons:[{"data-text-while-loading":b.t("cancel","Cancel"),text:b.t("cancel","Cancel"),click:function(){return j.$dialog.remove()}},{"class":"btn-primary","data-text-while-loading":b.t("uploading","Uploading..."),text:b.t("upload","Upload"),click:this.onSubmit}]})}return g.prototype.onSubmit=function(){var a,c=this;return a=new f.Deferred,a.fail(function(){return c.$dialog.find(".invalidInputMsg").show()}),this.$dialog.disableWhileLoading(a),this.getFileContent().fail(function(){return a.reject()}).done(function(d){var e;return e={content:d,locale:c.$dialog.find('[name="locale"]').val()},!e.content||!e.locale?a.reject():f.ajaxJSON("/media_objects/"+c.mediaCommentId+"/media_tracks","POST",e,function(){return a.resolve(),c.$dialog.dialog("close"),f.flashMessage(b.t("track_uploaded_successfully","Track uploaded successfuly, refresh to see it."))})})},g.prototype.getFileContent=function(){var a,b,c;return a=new f.Deferred,b=this.$dialog.find('input[name="content"]')[0].files[0],b?(c=new FileReader,c.onload=function(b){var c;return c=b.target.result,a.resolve(c)},c.readAsText(b)):a.reject(),a},g}()})}).call(this)