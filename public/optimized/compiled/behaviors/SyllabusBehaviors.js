(function(){define(["jquery","calendar_move","wikiSidebar","jquery.instructure_date_and_time","jquery.instructure_forms","jquery.instructure_misc_helpers","jquery.instructure_misc_plugins","jquery.loadingImg","compiled/tinymce","tinymce.editor_box","vendor/jquery.scrollTo","jqueryui/datepicker"],function(a,b,c){var d,e,f,g,h,i,j,k;return j=!1,h=function(){var b,c;b=a(".mini_month"),c=a("#syllabus");if(!b||!c)return;return b.find(".day.has_event").removeClass("has_event"),c.find("tr.date:visible").each(function(){var c;return c=a(this).find(".day_date").attr("data-date"),b.find("#mini_day_"+c).addClass("has_event")})},g=function(b){var c,d;c=a(".mini_month"),d=a("#syllabus"),a("tr.date.related, .day.related").removeClass("related");if(b){c&&c.find("#mini_day_"+b).addClass("related");if(d)return d.find("tr.date.events_"+b).addClass("related")}},i=function(b,c){var d,e,f,g,h,i;d=a("#syllabus"),d.find(".detail_list tr.related_event").removeClass("related_event");if(b&&d){h=d.find(".detail_list tr.related-"+b),i=[];for(f=0,g=h.length;f<g;f++)e=h[f],e!==c&&i.push(a(e).addClass("related_event"));return i}},k=function(){var b;return a(".special_date").each(function(){var b,c;return c=a(this),b=c,c.siblings().not(".special_date").length||(b=c.closest("tr.date")),b.toggle(j)}),b=a("#toggle_special_dates_in_syllabus"),b.removeClass("hidden").removeClass("shown"),b.addClass(j?"shown":"hidden"),j=!j,h()},f=function(){var b,c,d;return b=a("#syllabus"),b.on("mouseenter mouseleave","tr.date",function(b){var c;return b.type==="mouseenter"&&(c=a(this).find(".day_date").attr("data-date")),g(c)}),b.on("mouseenter mouseleave","tr.date .detail_list tr",function(b){var c,d,e,f,g,h;d=null;if(b.type==="mouseenter"){h=(g=a(this).attr("class"))!=null?g.split(/\s+/):void 0;for(e=0,f=h.length;e<f;e++){c=h[e];if(c.substr(0,8)==="related-"){d=c.substr(8);break}}}return i(d,this)}),c=a("#toggle_special_dates_in_syllabus"),c.on("click",function(a){return a.preventDefault(),k()}),h(),d=a.datepicker.formatDate("yy_mm_dd",new Date),g(d)},e=function(){var c,d;return c=a(".mini_month"),d=c.find(".next_month_link, .prev_month_link"),d.on("click",!1),d.on("mousedown",function(d){return d.preventDefault(),b.changeMonth(c,a(this).hasClass("next_month_link")?1:-1),h()}),c.on("click",".mini_calendar_day",function(d){var e,f,i,j,k;return d.preventDefault(),e=this.id.slice(9),k=e.split("_"),j=k[0],i=k[1],f=k[2],b.changeMonth(c,""+i+"/"+f+"/"+j),h(),a(".events_"+e).ifExists(function(b){return a("html, body").scrollTo(b),g(e)})}),c.on("mouseover mouseout",".mini_calendar_day",function(a){var b;return a.type!=="mouseout"&&(b=this.id.slice(9)),g(b)}),a(".jump_to_today_link").on("click",function(d){var e,f;return d.preventDefault(),f=a.datepicker.formatDate("yy_mm_dd",new Date),e=void 0,a("tr.date").each(function(){var b;return b=a(this).find(".day_date").attr("data-date"),b>f?!1:e=a(this)}),b.changeMonth(c,a.datepicker.formatDate("mm/dd/yy",new Date)),h(),a("html, body").scrollTo(e||a("tr.date:first")),g(f)})},d=function(){var b,d,e,f;return f=a("#edit_course_syllabus_form"),d=a("#course_syllabus_body"),b=a("#course_syllabus"),e=a("#course_syllabus_details"),b.data("syllabus_body",ENV.SYLLABUS_BODY),c&&c.init(),f.on("edit",function(){f.show(),b.hide(),e.hide(),d.editorBox(),d.editorBox("set_code",b.data("syllabus_body"));if(c)return c.attachToEditor(d),c.show(),a("#sidebar_content").hide()}),f.on("hide_edit",function(){var g;f.hide(),b.show(),g=a.trim(b.html()),e.showIf(!g),d.editorBox("destroy"),a("#sidebar_content").show();if(c)return c.hide()}),a(".edit_syllabus_link").on("click",function(a){return a.preventDefault(),f.triggerHandler("edit")}),f.on("click",".toggle_views_link",function(a){return a.preventDefault(),d.editorBox("toggle")}),f.on("click",".cancel_button",function(a){return a.preventDefault(),f.triggerHandler("hide_edit")}),f.formSubmit({object_name:"course",processData:function(a){return a["course[syllabus_body]"]=d.editorBox("get_code"),a},beforeSubmit:function(a){return f.triggerHandler("hide_edit"),e.hide(),b.loadingImage()},success:function(a){return b.loadingImage("remove").html(a.course.syllabus_body),b.data("syllabus_body",a.course.syllabus_body),e.hide()},error:function(a){return f.triggerHandler("edit").formErrors(a)}})},{bindToEditSyllabus:d,bindToMiniCalendar:e,bindToSyllabus:f}})}).call(this)