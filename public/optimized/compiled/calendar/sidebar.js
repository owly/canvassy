(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};define(["jquery","underscore","compiled/userSettings","jst/calendar/contextList","jst/calendar/undatedEvents","compiled/calendar/commonEventFactory","compiled/calendar/EditEventDetailsDialog","compiled/calendar/EventDataSource","compiled/jquery.kylemenu","jquery.instructure_misc_helpers","vendor/jquery.ba-tinypubsub"],function(c,d,e,f,g,h,i,j){var k,l,m;return l=d.map,k=function(){function d(b,d,f){var g,h,i;this.$holder=f,this.restoreList=a(this.restoreList,this),this.saveAndClear=a(this.saveAndClear,this),i=function(){try{return c.parseJSON(c.decodeFromHex(location.hash.substring(1)))||{}}catch(a){return h=a,{}}}(),i.show&&(this.contexts=i.show.split(",")),this.contexts||(this.contexts=d),this.contexts||(this.contexts=e.get("checked_calendar_codes")),this.contexts||(this.contexts=function(){var a,c,d,e;d=b.slice(0,10),e=[];for(a=0,c=d.length;a<c;a++)g=d[a],e.push(g.asset_string);return e}()),this.notify(),c.subscribe("Calendar/saveVisibleContextListAndClear",this.saveAndClear),c.subscribe("Calendar/restoreVisibleContextList",this.restoreList)}return d.prototype.saveAndClear=function(){if(!this.savedContexts)return this.savedContexts=this.contexts,this.contexts=[],this.notify()},d.prototype.restoreList=function(){if(this.savedContexts)return this.contexts=this.savedContexts,this.savedContexts=null,this.notify()},d.prototype.toggle=function(a){var b;return b=c.inArray(a,this.contexts),b>=0?this.contexts.splice(b,1):(this.contexts.push(a),this.contexts.length>10&&this.contexts.shift),this.notify()},d.prototype.notify=function(){var a=this;return c.publish("Calendar/visibleContextListChanged",[this.contexts]),this.$holder.find(".context_list_context").each(function(d,e){var f,g,h;return f=c(e),g=(h=f.data("context"),b.call(a.contexts,h)>=0),f.toggleClass("checked",g).toggleClass("not-checked",!g).find(".context-list-toggle-box").attr("aria-checked",g)})},d}(),m=function(a,b,d){var g,h;return g=c("#context-list-holder"),g.html(f({contexts:a})),h=new k(a,b,g),g.delegate(".context_list_context","click",function(a){return h.toggle(c(this).data("context")),e.set("checked_calendar_codes",l(c(this).parent().children(".checked"),function(a){return c(a).data("context")}))})}})}).call(this)