(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};define(["i18n!gradebook2","jquery","jst/CurveGradesDialog","jquery.disableWhileLoading","jquery.instructure_forms","jqueryui/dialog","jquery.instructure_misc_plugins","compiled/jquery/fixDialogButtons","vendor/jquery.ba-tinypubsub"],function(b,c,d){var e;return e=function(){function e(e,f){var g,h=this;this.assignment=e,this.gradebook=f,this.curve=a(this.curve,this),g={assignment:this.assignment,action:""+this.gradebook.options.context_url+"/gradebook/update_submission",middleScore:parseInt((this.assignment.points_possible||0)*.6),showOutOf:this.assignment.points_possible>=0},this.$dialog=c(d(g)),this.$dialog.formSubmit({disableWhileLoading:!0,processData:function(a){var c,d,e,f,g;c=0,d=h.curve();for(f in d)g="submissions[submission_"+f+"]",a[g+"[assignment_id]"]=a.assignment_id,a[g+"[user_id]"]=f,a[g+"[grade]"]=d[f],c++;return c===0?(e=h.$dialog.errorBox(b.t("errors.none_to_update","None to Update")),setTimeout(function(){return e.fadeOut(function(){return e.remove()})},3500),!1):a},success:function(a){var d,e;return h.$dialog.dialog("close"),e=function(){var b,c,e;e=[];for(b=0,c=a.length;b<c;b++)d=a[b],e.push(d.submission);return e}(),c.publish("submissions_updated",[e]),alert(b.t("alerts.scores_updated",{one:"1 Student score updated",other:"%{count} Student scores updated"},{count:a.length}))}}).dialog({width:350,modal:!0,resizable:!1,open:this.curve,close:function(){return h.$dialog.remove()}}).fixDialogButtons(),this.$dialog.find("#middle_score").bind("blur change keyup focus",this.curve),this.$dialog.find("#assign_blanks").change(this.curve)}return e.prototype.curve=function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;l=0,t={},h=this.$dialog.getFormData(),A=[],s=0,p=parseInt(c("#middle_score").val(),10),p/=this.assignment.points_possible,u=c("#assign_blanks").prop("checked");if(isNaN(p))return;C=this.gradebook.students;for(l in C){w=C[l],r=w["assignment_"+this.assignment.id].score,r>this.assignment.points_possible&&(r=this.assignment.points_possible);if(r<0||r==null&&u)r=0;A[parseInt(r,10)]=A[parseInt(r,10)]||[],A[parseInt(r,10)].push([l,r||0]),s++}d=[.006,.012,.028,.04,.068,.106,.159,.227,.309,.401,.5,.599,.691,.773,.841,.894,.933,.96,.977,.988,1],m=(1-p)/Math.floor(d.length/2),b=[],a=[],l=0;while(l<d.length)a.push(1-m*l),b.push(Math.round((1-m*l)*this.assignment.points_possible)),l++;x=0,j={},g=0,c("#results_list").empty(),c("#results_values").empty(),k=[],l=A.length-1;while(l>=0){z=A[l]||[],r=Math.round(b[g]);for(n in z)y=z[n],j[y[0]]=r,y[1]===0&&(j[y[0]]=0),i=j[y[0]],k[i]=k[i]||[],k[i].push(y[0]);x+=z.length;while(x>d[g]*s)g++;l--}o=0,l=k.length-1;while(l>=0)e=(k[l]||[]).length,e>o&&(o=e),l--;B=15,v=0,l=k.length-1;while(l>=0)z=k[l],q=0,e=0,z||v>this.assignment.points_possible/10?(z&&(q=z.length/o,e=z.length),f=l===0?"#ee8":"#cdf",c("#results_list").prepend("<td style='padding: 1px;'><div title='"+e+" student"+(e===1?"":"s")+" will get "+l+" points' style='border: 1px solid #888; background-color: "+f+"; width: "+B+"px; height: "+100*q+"px; margin-top: "+100*(1-q)+"px;'>&nbsp;</div></td>"),c("#results_values").prepend("<td style='text-align: center;'>"+l+"</td>"),v=0):v++,l--;return c("#results_list").prepend("<td><div style='height: 100px; position: relative; width: 30px; font-size: 0.8em;'><img src='/images/number_of_students.png' alt='# of students'/><div style='position: absolute; top: 0; right: 3px;'>"+o+"</div><div style='position: absolute; bottom: 0; right: 3px;'>0</div></div></td>"),c("#results_values").prepend("<td>&nbsp;</td>"),j},e}()})}).call(this)