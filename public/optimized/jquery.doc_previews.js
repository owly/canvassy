define(["INST","i18n!instructure","jquery","underscore","vendor/scribd.view","str/htmlEscape","jquery.ajaxJSON","jquery.google-analytics","jquery.instructure_misc_helpers","jquery.loadingImg"],function(a,b,c,d,e,f){var g={"application/vnd.openxmlformats-officedocument.wordprocessingml.template":[1,1],"application/vnd.oasis.opendocument.spreadsheet":[1,1],"application/vnd.sun.xml.writer":[1,1],"application/excel":[1,1],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[1,1],"text/rtf":[1,!1],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":[1,1],"application/vnd.sun.xml.impress":[1,1],"application/vnd.sun.xml.calc":[1,1],"application/vnd.ms-excel":[1,1],"application/msword":[1,1],"application/mspowerpoint":[1,1],"application/rtf":[1,1],"application/vnd.oasis.opendocument.presentation":[1,1],"application/vnd.oasis.opendocument.text":[1,1],"application/vnd.openxmlformats-officedocument.presentationml.template":[1,1],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":[1,1],"text/plain":[1,!1],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[1,1],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[1,1],"application/postscript":[1,1],"application/pdf":[1,1],"application/vnd.ms-powerpoint":[1,1]};c.filePreviewsEnabled=function(){return!(a.disableCrocodocPreviews&&a.disableScribdPreviews&&a.disableGooglePreviews)},c.isPreviewable=function(b,d){return c.filePreviewsEnabled()&&g[b]&&(!d||!a["disable"+c.capitalize(d)+"Previews"]&&g[b][{scribd:0,google:1}[d]])},c.fn.loadDocPreview=function(g){var h=swfobject.getFlashPlayerVersion(),i=h&&h.major>9;return this.each(function(){function k(a){j.attachment_view_inline_ping_url&&(c.ajaxJSON(j.attachment_view_inline_ping_url,"POST",{},function(){},function(){}),c.trackEvent("Doc Previews",a,JSON.stringify(j)))}var h=c(this),j=c.extend({width:"100%",height:"400px"},h.data(),g);if(!a.disableCrocodocPreviews&&j.crocodoc_session_url){var l=c("<iframe/>",{src:j.crocodoc_session_url,width:j.width,height:j.height});l.appendTo(h),l.load(function(){k("crocodoc"),c.isFunction(j.ready)&&j.ready()})}else if(!a.disableScribdPreviews&&j.scribd_doc_id&&j.scribd_access_key&&i&&e){var m=e.Document.getDoc(j.scribd_doc_id,j.scribd_access_key),n=h.attr("id"),o=c.extend({jsapi_version:1,disable_related_docs:!0,auto_size:!1,height:j.height,use_ssl:"https:"==document.location.protocol},j.scribdParams);n||(n=d.uniqueId("scribd_preview_"),h.attr("id",n)),c.each(o,function(a,b){m.addParam(a,b)}),c.isFunction(j.ready)&&m.addEventListener("iPaperReady",j.ready),m.write(n),this.childNodes[0].keyboardShortcutDown=this.childNodes[0].keyboardShortcutUp=function(){},k("scribd")}else if(!a.disableGooglePreviews&&(!j.mimeType||c.isPreviewable(j.mimeType,"google"))&&j.attachment_id||j.public_url){function p(){var a="//docs.google.com/viewer?"+c.param({embedded:!0,url:j.public_url});c('<iframe src="'+a+'" height="'+j.height+'" width="100%" />').appendTo(h).load(function(){k("google"),c.isFunction(j.ready)&&j.ready()})}if(j.public_url)p();else if(j.attachment_id){var q="/files/"+j.attachment_id+"/public_url.json";j.submission_id&&(q+="?"+c.param({submission_id:j.submission_id})),h.loadingImage(),c.ajaxJSON(q,"GET",{},function(a){h.loadingImage("remove"),a&&a.public_url&&(c.extend(j,a),p())})}}else c.filePreviewsEnabled()&&h.html("<p>"+f(b.t("errors.cannot_view_document_inline","This document cannot be viewed inline."))+"</p>")})}})