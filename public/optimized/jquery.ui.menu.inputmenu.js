define(["jquery","jqueryui/menu"],function(a){var b=a.ui.menu.prototype,c=b.refresh;a.extend(b,{refresh:function(){c.call(this);var b=this,d=this.element.find("li.ui-menu-item"),e=!1;this.element.bind("click.menu",function(a){(new RegExp(/^a$/i)).test(a.target.tagName)||a.preventDefault()});var f=0;this.element.find("input[type='checkbox'], input[type='radio']").each(function(){var b=a(this).closest("label");b.length&&(a(this).insertBefore(b),a(this).attr("id")||a(this).attr("id","ui-input-"+f++),b.attr("for",a(this).attr("id")))}),this.element.bind("menufocus",function(b){var c=a(b.target).find("a.ui-state-focus").children("input[type='text']");c.length&&c[0].focus()}).bind("menublur",function(b){var c=a(b.target).find("input[type='text']:focus");c.length&&c[0].blur()}),d.children("a").each(function(b,c){var d=a(c),f=d.parent();d.children().is("input[type='checkbox'], input[type='radio']")&&(d.closest("ul").addClass("ui-menu-icons"),d.children("input[type='checkbox']").is(":checked")?(d.prepend('<span class="ui-icon ui-icon-check"></span>'),f.attr({role:"menuitemcheckbox","aria-checked":"true"})):d.children("input[type='radio']").is(":checked")?(d.prepend('<span class="ui-icon ui-icon-radio-on"></span>'),f.attr({role:"menuitemradio","aria-checked":"true"})):d.children("input[type='radio']").length?(d.prepend('<span class="ui-icon ui-icon-radio-off"></span>'),f.attr({role:"menuitemradio","aria-checked":"false"})):f.attr({role:"menuitemcheckbox","aria-checked":"false"}),d.children().is("input[type='radio']")&&f.attr("radio-group",d.children("input[type='radio']").attr("name")),f.prev().length&&!f.prev().children("a").length?(f.prev().addClass("ui-state-disabled").html("<span class='ui-menu-input-group'>"+f.prev().text()+"</span>").bind("click.menu",function(a){return!1}).after("<li><hr /></li>"),e=!0):f.prev().length&&!f.prev().children("a").children().is("input[type='checkbox'], input[type='radio']")&&f.before("<li><hr /></li>"),e&&f.next().length&&!f.next().children("a").children().is("input[type='checkbox'], input[type='radio']")?(f.after("<li><hr /></li>"),e=!1):f.next().length&&!f.next().children("a").children().is("input[type='checkbox'], input[type='radio']")&&f.after("<li><hr /></li>"),d.children("input[type='checkbox'], input[type='radio']").hide())}),d.bind("keydown.menu",function(c){c.keyCode===a.ui.keyCode.SPACE&&(b.active.children("a").children().is("input[type='checkbox'], input[type='radio']")&&(b.select(c),c.stopImmediatePropagation()),c.preventDefault())}),d.find("input[type='text']").bind("keydown",function(c){c.stopPropagation(),c.keyCode===a.ui.keyCode.UP&&(b.element.trigger("focus"),this.blur(),b.focus(c,a(this).closest(".ui-menu-item").prev())),c.keyCode===a.ui.keyCode.DOWN&&(b.element.trigger("focus"),this.blur(),b.focus(c,a(this).closest(".ui-menu-item").next()))}).bind("click",function(a){a.stopPropagation()})},select:function(b){var c={item:this.active||a(b.target).closest(".ui-menu-item")};c.item.children("a").children().is("input[type='checkbox']")&&(c.item.attr("aria-checked")==="false"?(c.item.children("a").prepend('<span class="ui-icon ui-icon-check"></span>'),c.item.attr("aria-checked","true"),c.item.children("a").children("input[type='checkbox']").prop("checked","checked").trigger("change")):c.item.attr("aria-checked")==="true"&&(c.item.children("a").children("span.ui-icon-check").remove(),c.item.attr("aria-checked","false"),c.item.children("a").children("input[type='checkbox']").removeAttr("checked").trigger("change"))),c.item.children("a").children().is("input[type='radio']")&&c.item.attr("aria-checked")==="false"&&(c.item.children("a").children("span.ui-icon-radio-off").toggleClass("ui-icon-radio-on ui-icon-radio-off"),c.item.attr("aria-checked","true"),c.item.children("a").children("input[type='radio']").prop("checked","checked").trigger("change"),c.item.siblings("[radio-group="+a(c.item).attr("radio-group")+"]").each(function(){a(this).attr("aria-checked","false"),a(this).children("a").children("span.ui-icon-radio-on").toggleClass("ui-icon-radio-on ui-icon-radio-off"),a(this).children("a").children("input[type='radio']").removeAttr("checked")})),c.item.children("a").children().is("input[type='checkbox'], input[type='radio']")||this.collapseAll(),this._trigger("select",b,c)}})})