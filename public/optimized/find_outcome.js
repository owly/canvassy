define(["i18n!find_outcome","jquery","compiled/str/TextHelper","jquery.ajaxJSON","jqueryui/dialog","jquery.templateData"],function(a,b,c){var d=function(){return{find:function(e,f){f=f||{},d.callback=e;var g=b("#find_outcome_criterion_dialog");g.hasClass("loaded")||(g.find(".loading_message").text(a.t("messages.loading_outcomes","Loading Outcomes...")),b.ajaxJSON(g.find(".outcomes_list_url").attr("href"),"GET",{},function(d){valids=[];for(var e in d){var h=d[e].learning_outcome;(!f.for_rubric||h.data&&h.data.rubric_criterion)&&valids.push(h)}if(valids.length===0){var i;f.for_rubric?i=a.t("messages.no_rubric_outcomes_found","No Rubric-Configured Outcomes found"):i=a.t("messages.no_outcomes_found","No Outcomes found"),g.find(".loading_message").text(i)}else{g.find(".loading_message").hide(),g.addClass("loaded");for(var e in valids){var h=valids[e];h.name=h.short_description,h.mastery_points=h.data.rubric_criterion.mastery_points||h.data.rubric_criterion.points_possible;var j=g.find(".outcomes_select.blank:first").clone(!0).removeClass("blank");h.title=h.short_description;var k=b("<div/>");k.text(h.short_description),h.title=c.truncateText(b.trim(k.text()),{max:35}),h.display_name=h.cached_context_short_name||"",j.fillTemplateData({data:h}),g.find(".outcomes_selects").append(j.show());var l=g.find(".outcome.blank:first").clone(!0).removeClass("blank");l.find(".mastery_level").attr("id","outcome_question_bank_mastery_"+h.id).end().find(".mastery_level_text").attr("for","outcome_question_bank_mastery_"+h.id),h.learning_outcome_id=h.id;var m=h.data&&h.data.rubric_criterion,n=m.points_possible&&m.mastery_points!=null&&m.mastery_points/m.points_possible||0;n=Math.round(n*1e4)/100||"",l.find(".mastery_level").val(n),l.fillTemplateData({data:h,htmlValues:["description"]}),l.addClass("outcome_"+h.id);if(h.data&&h.data.rubric_criterion)for(var o in h.data.rubric_criterion.ratings){var p=h.data.rubric_criterion.ratings[o],q=l.find(".rating.blank").clone(!0).removeClass("blank");q.fillTemplateData({data:p}),l.find("tr").append(q.show())}g.find(".outcomes_list").append(l)}g.find(".outcomes_select:not(.blank):first").click()}},function(b){g.find(".loading_message").text(a.t("errors.outcome_retrieval_failed","Outcomes Retrieval failed unexpected.  Please try again."))}));var h;f.for_rubric?h=a.t("titles.find_outcome_criterion","Find Outcome Criterion"):h=a.t("titles.find_outcome","Find Outcome"),g.dialog({modal:!0,title:h,width:700,height:400})}}}();return window.find_outcome=d,b(document).ready(function(){b("#find_outcome_criterion_dialog .outcomes_select").click(function(a){a.preventDefault(),b("#find_outcome_criterion_dialog .outcomes_select.selected_side_tab").removeClass("selected_side_tab"),b(this).addClass("selected_side_tab");var c=b(this).getTemplateData({textValues:["id"]}).id;b("#find_outcome_criterion_dialog .outcomes_list .outcome").hide(),b("#find_outcome_criterion_dialog .outcomes_list .outcome_"+c).show()}),b("#find_outcome_criterion_dialog .select_outcome_link").click(function(a){a.preventDefault();var c=b(this).parents(".outcome");b("#find_outcome_criterion_dialog").dialog("close"),b.isFunction(d.callback)&&d.callback(c)})}),d})