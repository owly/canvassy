define(["i18n!mathquill","jquery"],function(a,b){function h(){}function i(){}function j(a,b,c){this.init(a,[b],[c||(a&&a.length>1?a.slice(1):a)])}function k(){}function l(a,c,d){if(!arguments.length)return;var e=this;e.parent=a,e.prev=c||0,e.next=d||0,e.jQinit(e.fold(b(),function(a,b){return b.jQ.add(a)}))}function m(a,d,f,g,h){function p(){o=c;var a=j.selection?"$"+j.selection.latex()+"$":"";m.val(a);if(a)if(m[0].select)m[0].select();else if(document.selection){var b=m[0].createTextRange();b.expand("textedit"),b.select()}}function s(a){return j.seek(b(a.target),a.pageX,a.pageY),(j.prev!==q.prev||j.parent!==q.parent)&&j.selectFrom(q),!1}function t(a){return delete a.target,s(a)}function v(d){q=c,j.blink=r,j.selection||(g?j.show():k.detach()),a.unbind("mousemove",s),b(document).unbind("mousemove",t).unbind("mouseup",v)}function x(){m.focus()}function y(){var a=m.val();a.slice(0,1)==="$"&&a.slice(-1)==="$"?a=a.slice(1,-1):a.match(/^\\/)||(a="\\text{"+a+"}"),j.writeLatex(a).show(),m.val("")}function D(){if(C)return;var a=m.val();if(a){m.val("");for(var b=0;b<a.length;b+=1)j.parent.textInput(a.charAt(b))}else(j.selection||o!==c)&&p()}var i=a.contents().detach();f||a.addClass("mathquill-rendered-math"),d.jQ=a.data(e,{block:d,revert:function(){a.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox mathquill-editor").append(i)}});var j=d.cursor=new _(d);d.renderLatex(i.text());var k=d.textarea=b('<span class="textarea"><textarea></textarea></span>'),m=k.children();h&&n(d,a);var o;d.selectionChanged=function(){o===c&&(o=setTimeout(p)),u(a[0])},a.bind("selectstart.mathquill",function(a){a.target!==m[0]&&a.preventDefault(),a.stopPropagation()});var q,r=j.blink;a.bind("mousedown.mathquill",function(c){j.blink=b.noop,j.seek(b(c.target),c.pageX,c.pageY),q=new l(j.parent,j.prev,j.next),g||a.prepend(k),a.mousemove(s),b(document).mousemove(t).mouseup(v),c.stopPropagation()});if(!g){a.bind("cut paste",!1).bind("copy",p).prepend('<span class="selectable">$'+d.latex()+"$</span>"),m.blur(function(){j.clearSelection(),setTimeout(w)});function w(){k.detach()}return}a.prepend(k),a.addClass("mathquill-editable"),f&&a.addClass("mathquill-textbox"),m.focus(function(a){j.parent||j.appendTo(d),j.parent.jQ.addClass("hasCursor"),j.selection?(j.selection.jQ.removeClass("blur"),setTimeout(d.selectionChanged)):j.show(),a.stopPropagation()}).blur(function(a){j.hide().parent.blur(),j.selection&&j.selection.jQ.addClass("blur"),a.stopPropagation()}),a.bind("focus.mathquill blur.mathquill",function(a){m.trigger(a)}).bind("mousedown.mathquill",function(){setTimeout(x)}).bind("click.mathquill",x).blur(),a.bind("cut",function(a){p(),j.selection&&setTimeout(function(){j.deleteSelection(),j.redraw()}),a.stopPropagation()}).bind("copy",function(a){p(),C=!0,a.stopPropagation()}).bind("paste",function(a){C=!0,setTimeout(y),a.stopPropagation()});var z,A,B,C=!1;a.bind("keydown.mathquill",function(a){z=a,A=!0,j.parent.keydown(a)===!1&&a.preventDefault()}).bind("keypress.mathquill",function(a){if(A)A=!1;else{if(B!==a.which)return;j.parent.keydown(z)}B=a.which,o!==c&&clearTimeout(o),C=!1,setTimeout(D)})}function n(d,e){var f=[{name:a.t("tabs.basic","Basic"),example:"+",button_groups:[["subscript","supscript","frac","sqrt","nthroot","langle","binomial","vector","f","prime"],["+","-","pm","mp","cdot","=","times","div","ast"],["therefore","because"],["sum","prod","coprod","int"],["N","P","Z","Q","R","C","H"]]},{name:a.t("tabs.greek","Greek"),example:"&pi;",button_groups:[["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"],["digamma","varepsilon","vartheta","varkappa","varpi","varrho","varsigma","varphi"],["Gamma","Delta","Theta","Lambda","Xi","Pi","Sigma","Upsilon","Phi","Psi","Omega"]]},{name:a.t("tabs.operators","Operators"),example:"&oplus;",button_groups:[["wedge","vee","cup","cap","diamond","bigtriangleup","ominus","uplus","otimes","oplus","bigtriangledown","sqcap","triangleleft","sqcup","triangleright","odot","bigcirc","dagger","ddagger","wr","amalg"]]},{name:a.t("tabs.relationships","Relationships"),example:"&le;",button_groups:[["<",">","equiv","cong","sim","notin","ne","propto","approx","le","ge","in","ni","notni","subset","supset","notsubset","notsupset","subseteq","supseteq","notsubseteq","notsupseteq","models","prec","succ","preceq","succeq","simeq","mid","ll","gg","parallel","bowtie","sqsubset","sqsupset","smile","sqsubseteq","sqsupseteq","doteq","frown","vdash","dashv","exists","varnothing"]]},{name:a.t("tabs.arrows","Arrows"),example:"&hArr;",button_groups:[["longleftarrow","longrightarrow","Longleftarrow","Longrightarrow","longleftrightarrow","updownarrow","Longleftrightarrow","Updownarrow","mapsto","nearrow","hookleftarrow","hookrightarrow","searrow","leftharpoonup","rightharpoonup","swarrow","leftharpoondown","rightharpoondown","nwarrow","downarrow","Downarrow","uparrow","Uparrow","rightarrow","Rightarrow","leftarrow","lArr","leftrightarrow","Leftrightarrow"]]},{name:a.t("tabs.delimiters","Delimiters"),example:"{",button_groups:[["lfloor","rfloor","lceil","rceil","slash","opencurlybrace","closecurlybrace"]]},{name:a.t("tabs.miscellaneous","Misc"),example:"&infin;",button_groups:[["forall","ldots","cdots","vdots","ddots","surd","triangle","ell","top","flat","natural","sharp","wp","bot","clubsuit","diamondsuit","heartsuit","spadesuit","caret","underscore","backslash","vert","perp","nabla","hbar","AA","circ","bullet","setminus","neg","dots","Re","Im","partial","infty","aleph","deg","angle"]]}],g={binomial:'<span style="font-size: 0.48em"><span class="paren" style="font-size: 2.087912087912088em; ">(</span><span class="array"><span><var>n</var></span><span><var>m</var></span></span><span class="paren" style="font-size: 2.087912087912088em; ">)</span></span>',frac:'<span style="font-size: 0.55em; vertical-align: middle" class="fraction"><span class="numerator"><var>n</var></span><span class="denominator"><var>m</var></span><span style="width:0"></span></span>',sqrt:'<span class="block"><span class="sqrt-prefix">&radic;</span><span class="sqrt-stem">&nbsp;</span></span>',nthroot:'<span style="font-size: 0.7em"><sup class="nthroot"><var>n</var></sup><span class="block"><span class="sqrt-prefix">&radic;</span><span class="sqrt-stem">&nbsp;</span></span></span>',supscript:'<sup style="font-size: 0.6em">sup</sup>',subscript:'<sub style="font-size: 0.6em; line-height: 3.5;">sub</sub>',vector:'<span class="array" style="vertical-align: middle; font-size: 0.4em; line-height: 0.9em"><span>1</span><span>2</span><span>3</span></span>'},h=[],i=[];b.each(f,function(a,d){h.push('<li><a href="#'+d.name+'_tab"><span class="mathquill-rendered-math">'+d.example+"</span>"+d.name+"</a></li>");var e=[];b.each(d.button_groups,function(a,d){b.each(d,function(a,b){var d=new s[b](c,b);e.push('<li><a class="mathquill-rendered-math" title="'+(b.match(/^[a-z]+$/i)?"\\"+b:b)+'">'+(g[b]?g[b]:'<span style="line-height: 1.5em">'+d.html_template.join("")+"</span>")+"</a></li>")}),e.push('<li class="mathquill-button-spacer"></li>')}),i.push('<div class="mathquill-tab-pane" id="'+d.name+'_tab"><ul>'+e.join("")+"</ul></div>")}),d.toolbar=b("#mathquill-view .mathquill-toolbar").html('<ul class="mathquill-tab-bar">'+h.join("")+'</ul><div class="mathquill-toolbar-panes">'+i.join("")+"</div>"),b("#mathquill-view .mathquill-tab-bar li a").click(function(){b("#mathquill-view .mathquill-tab-bar li").removeClass("mathquill-tab-selected"),b("#mathquill-view .mathquill-tab-pane").removeClass("mathquill-tab-pane-selected"),b(this).parent().addClass("mathquill-tab-selected"),b(this.href.replace(/.*#/,"#")).addClass("mathquill-tab-pane-selected")}),b("#mathquill-view .mathquill-tab-bar li:first-child a").click(),b("#mathquill-view a.mathquill-rendered-math").mousedown(function(a){a.stopPropagation()}).click(function(){d.cursor.writeLatex(this.title,!0),e.focus()})}function o(){}function p(a){this.init("$"),this.firstChild.cursor=a,this.firstChild.textInput=function(b){if(this.skipTextInput)return;b!=="$"||a.parent!==this?a.write(b):this.isEmpty()?a.insertAfter(this.parent).backspace().insertNew(new V("\\$","$")).show():a.next?a.prev?a.write(b):a.insertBefore(this.parent):a.insertAfter(this.parent)}}function q(){}function A(a,b){return b.prototype=a.prototype,b}function B(a){var b=Array.prototype.slice.call(arguments,1);return A(a,function(){a.apply(this,Array.prototype.concat.apply(b,arguments))})}function C(a,b,d){this.init(a,[b],c,d)}function D(a,b,c,d){this.init(a,[b],[c],d)}function E(a){this.init("\\frac",c,c,a),this.jQ.append('<span style="display:inline-block;width:0">&nbsp;</span>')}function F(){E.apply(this,arguments)}function G(a){this.init("\\sqrt",c,c,a)}function H(a){G.call(this,a),this.jQ=this.firstChild.jQ.detach().add(this.jQ)}function I(a,b,c,d,e){this.init("\\left"+c,['<span class="block"><span class="paren">'+a+'</span><span class="block"></span><span class="paren">'+b+"</span></span>"],[a,b],e),this.end="\\right"+d}function J(a,b,c,d,e){I.apply(this,arguments)}function K(a,b,c){I.call(this,a,b,a,b,c)}function L(a,b,c){J.call(this,a,b,a,b,c)}function M(a){K.call(this,"|","|",a)}function N(a){a instanceof l?this.replacedText=a.remove().jQ.text():typeof a=="string"&&(this.replacedText=a),this.init()}function O(){}function P(a,b){function c(){N.apply(this,arguments)}return d=c.prototype=new N,d.cmd=a,d.html_template=[b],c}function Q(a){this.init("\\"),a&&(this.replacedFragment=a.detach(),this.isEmpty=function(){return!1})}function R(a){this.init("\\binom",c,c,a),this.jQ.wrapInner('<span class="array"></span>'),this.blockjQ=this.jQ.children(),this.bracketjQs=b('<span class="paren">(</span>').prependTo(this.jQ).add(b('<span class="paren">)</span>').appendTo(this.jQ))}function S(){R.apply(this,arguments)}function T(a){this.init("\\vector",c,c,a)}function U(a,b){j.call(this,a,"<var>"+(b||a)+"</var>")}function V(a,b){j.call(this,a,"<span>"+(b||a)+"</span>")}function W(a,b){j.call(this,a,'<span class="nonSymbola">'+(b||a)+"</span>")}function X(a,b,c){j.call(this,a,'<span class="binary-operator">'+b+"</span>",c)}function Y(a,b){V.apply(this,arguments)}function Z(a,b){j.call(this,a,"<big>"+b+"</big>")}function $(a,b){j.call(this,"\\"+b+" ","<span>"+b+"</span>")}function _(a){this.parent=this.root=a;var c=this.jQ=this._jQ=b('<span class="cursor">&zwj;</span>');this.blink=function(){c.toggleClass("blink")}}function ab(a,b,c){l.apply(this,arguments)}var c,d,e="[[mathquill internal data]]",f=Math.min,g=Math.max;d=h.prototype,d.prev=0,d.next=0,d.parent=0,d.firstChild=0,d.lastChild=0,d.eachChild=function(a){for(var b=this.firstChild;b;b=b.next)if(a.call(this,b)===!1)break;return this},d.foldChildren=function(a,b){return this.eachChild(function(c){a=b.call(this,a,c)}),a},d.keydown=function(a){return this.parent.keydown(a)},d.textInput=function(a){return this.parent.textInput(a)},d=i.prototype=new h,d.init=function(a,c,d,f){var g=this;a&&(g.cmd=a),c&&(g.html_template=c),d&&(g.text_template=d),g.jQ=b(g.html_template[0]).data(e,{cmd:g}),g.initBlocks(f)},d.initBlocks=function(a){var c=this;if(c.html_template.length===1){c.firstChild=c.lastChild=c.jQ.data(e).block=a&&a.blockify()||new k,c.firstChild.parent=c,c.firstChild.jQ=c.jQ.append(c.firstChild.jQ);return}var d,f,g=c.html_template.length;this.firstChild=d=f=a&&a.blockify()||new k,d.parent=c,d.jQ=b(c.html_template[1]).data(e,{block:d}).append(d.jQ).appendTo(c.jQ),d.blur();for(var h=2;h<g;h+=1)d=new k,d.parent=c,d.prev=f,f.next=d,f=d,d.jQ=b(c.html_template[h]).data(e,{block:d}).appendTo(c.jQ),d.blur();c.lastChild=d},d.latex=function(){return this.foldChildren(this.cmd,function(a,b){return a+"{"+(b.latex()||" ")+"}"})},d.text_template=[""],d.text=function(){var a=0;return this.foldChildren(this.text_template[a],function(b,c){a+=1;var d=c.text();return b&&this.text_template[a]==="("&&d[0]==="("&&d.slice(-1)===")"?b+d.slice(1,-1)+this.text_template[a]:b+c.text()+(this.text_template[a]||"")})},d.insertAt=function(a){var b=this;b.parent=a.parent,b.next=a.next,b.prev=a.prev,a.prev?a.prev.next=b:a.parent.firstChild=b,a.next?a.next.prev=b:a.parent.lastChild=b,a.prev=b,b.jQ.insertBefore(a.jQ),b.respace(),b.next&&b.next.respace(),b.prev&&b.prev.respace(),b.placeCursor(a),a.redraw()},d.respace=b.noop,d.placeCursor=function(a){a.appendTo(this.foldChildren(this.firstChild,function(a,b){return a.isEmpty()?a:b}))},d.isEmpty=function(){return this.foldChildren(!0,function(a,b){return a&&b.isEmpty()})},d.remove=function(){var a=this,b=a.prev,c=a.next,d=a.parent;return b?b.next=c:d.firstChild=c,c?c.prev=b:d.lastChild=b,a.jQ.remove(),a},d=j.prototype=new i,d.initBlocks=b.noop,d.latex=function(){return this.cmd},d.text=function(){return this.text_template},d.placeCursor=b.noop,d.isEmpty=function(){return!0},d=k.prototype=new h,d.latex=function(){return this.foldChildren("",function(a,b){return a+b.latex()})},d.text=function(){return this.firstChild===this.lastChild?this.firstChild.text():this.foldChildren("(",function(a,b){return a+b.text()})+")"},d.isEmpty=function(){return this.firstChild===0&&this.lastChild===0},d.focus=function(){return this.jQ.addClass("hasCursor"),this.isEmpty()&&this.jQ.removeClass("empty"),this},d.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this},d=l.prototype,d.remove=i.prototype.remove,d.jQinit=function(a){this.jQ=a},d.each=function(a){for(var b=this.prev.next||this.parent.firstChild;b!==this.next;b=b.next)if(a.call(this,b)===!1)break;return this},d.fold=function(a,b){return this.each(function(c){a=b.call(this,a,c)}),a},d.latex=function(){return this.fold("",function(a,b){return a+b.latex()})},d.blockify=function(){var a=this,b=a.prev,c=a.next,d=a.parent,e=new k,f=e.firstChild=b.next||d.firstChild,g=e.lastChild=c.prev||d.lastChild;return b?b.next=c:d.firstChild=c,c?c.prev=b:d.lastChild=b,f.prev=a.prev=0,g.next=a.next=0,a.parent=e,a.each(function(a){a.parent=e}),e.jQ=a.jQ,e},d=o.prototype=new k,d.latex=function(){return k.prototype.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/ig,"$1")},d.text=function(){return this.foldChildren("",function(a,b){return a+b.text()})},d.renderLatex=function(a){this.jQ.children().slice(1).remove(),this.firstChild=this.lastChild=0,this.cursor.appendTo(this).writeLatex(a),this.blur()},d.keydown=function(a){a.ctrlKey=a.ctrlKey||a.metaKey;switch(a.originalEvent&&a.originalEvent.keyIdentifier||a.which){case 8:case"Backspace":case"U+0008":if(a.ctrlKey)while(this.cursor.prev||this.cursor.selection)this.cursor.backspace();else this.cursor.backspace();break;case 27:case"Esc":case"U+001B":case 9:case"Tab":case"U+0009":if(a.ctrlKey)break;var b=this.cursor.parent;if(a.shiftKey){if(b===this.cursor.root)return this.skipTextInput=!0;b.prev?this.cursor.appendTo(b.prev):this.cursor.insertBefore(b.parent)}else{if(b===this.cursor.root)return this.skipTextInput=!0;b.next?this.cursor.prependTo(b.next):this.cursor.insertAfter(b.parent)}this.cursor.clearSelection();break;case 13:case"Enter":break;case 35:case"End":if(a.shiftKey)while(this.cursor.next||a.ctrlKey&&this.cursor.parent!==this)this.cursor.selectRight();else this.cursor.clearSelection().appendTo(a.ctrlKey?this:this.cursor.parent);break;case 36:case"Home":if(a.shiftKey)while(this.cursor.prev||a.ctrlKey&&this.cursor.parent!==this)this.cursor.selectLeft();else this.cursor.clearSelection().prependTo(a.ctrlKey?this:this.cursor.parent);break;case 37:case"Left":if(a.ctrlKey)break;a.shiftKey?this.cursor.selectLeft():this.cursor.moveLeft();break;case 38:case"Up":if(a.ctrlKey)break;if(a.shiftKey)if(this.cursor.prev)while(this.cursor.prev)this.cursor.selectLeft();else this.cursor.selectLeft();else this.cursor.parent.prev?this.cursor.clearSelection().appendTo(this.cursor.parent.prev):this.cursor.prev?this.cursor.clearSelection().prependTo(this.cursor.parent):this.cursor.parent!==this&&this.cursor.clearSelection().insertBefore(this.cursor.parent.parent);break;case 39:case"Right":if(a.ctrlKey)break;a.shiftKey?this.cursor.selectRight():this.cursor.moveRight();break;case 40:case"Down":if(a.ctrlKey)break;if(a.shiftKey)if(this.cursor.next)while(this.cursor.next)this.cursor.selectRight();else this.cursor.selectRight();else this.cursor.parent.next?this.cursor.clearSelection().prependTo(this.cursor.parent.next):this.cursor.next?this.cursor.clearSelection().appendTo(this.cursor.parent):this.cursor.parent!==this&&this.cursor.clearSelection().insertAfter(this.cursor.parent.parent);break;case 46:case"Del":case"U+007F":if(a.ctrlKey)while(this.cursor.next||this.cursor.selection)this.cursor.deleteForward();else this.cursor.deleteForward();break;case 65:case"A":case"U+0041":if(a.ctrlKey&&!a.shiftKey&&!a.altKey){if(this!==this.cursor.root)return this.parent.keydown(a);this.cursor.clearSelection().appendTo(this);while(this.cursor.prev)this.cursor.selectLeft();break};default:return this.skipTextInput=!1,!0}return this.skipTextInput=!0,!1},d.textInput=function(a){this.skipTextInput||this.cursor.write(a)},d=p.prototype=new i,d.html_template=['<span class="mathquill-rendered-math"></span>'],d.initBlocks=function(){this.firstChild=this.lastChild=this.jQ.data(e).block=new o,this.firstChild.parent=this,this.firstChild.jQ=this.jQ},d.latex=function(){return"$"+this.firstChild.latex()+"$"},d=q.prototype=new k,d.renderLatex=function(a){var b=this,c=b.cursor;b.jQ.children().slice(1).remove(),b.firstChild=b.lastChild=0,c.show().appendTo(b),a=a.match(/(?:\\\$|[^$])+|\$(?:\\\$|[^$])*\$|\$(?:\\\$|[^$])*$/g)||"";for(var d=0;d<a.length;d+=1){var e=a[d];if(e[0]==="$"){e[-1+e.length]==="$"&&e[-2+e.length]!=="\\"?e=e.slice(1,-1):e=e.slice(1);var f=new p(c);c.insertNew(f),f.firstChild.renderLatex(e),c.show().insertAfter(f)}else for(var g=0;g<e.length;g+=1)this.cursor.insertNew(new V(e[g]))}},d.keydown=o.prototype.keydown,d.textInput=function(a){if(this.skipTextInput)return;this.cursor.deleteSelection(),a==="$"?this.cursor.insertNew(new p(this.cursor)):this.cursor.insertNew(new V(a))};var r={},s={},t,u=b.noop,v=document.createElement("div"),w=v.style,x={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1},y;for(var z in x)if(z in w){y=z;break}y?t=function(a,b,c){a.css(y,"scale("+b+","+c+")")}:"filter"in w?(u=function(a){a.className=a.className},t=function(a,c,d){function e(){a.css("marginRight",(1+a.width())*(c-1)/c+"px")}c/=1+(d-1)/2,a.addClass("matrixed").css({fontSize:d+"em",marginTop:"-.1em",filter:"progid:DXImageTransform.Microsoft.Matrix(M11="+c+",SizingMethod='auto expand')"}),e();var f=setInterval(e);b(window).load(function(){clearTimeout(f),e()})}):t=function(a,b,c){a.css("fontSize",c+"em")},A(i,C),s.mathrm=B(C,"\\mathrm",'<span class="roman font"></span>'),s.mathit=B(C,"\\mathit",'<i class="font"></i>'),s.mathbf=B(C,"\\mathbf",'<b class="font"></b>'),s.mathsf=B(C,"\\mathsf",'<span class="sans-serif font"></span>'),s.mathtt=B(C,"\\mathtt",'<span class="monospace font"></span>'),s.underline=B(C,"\\underline",'<span class="underline"></span>'),s.overline=s.bar=B(C,"\\overline",'<span class="overline"></span>'),d=D.prototype=new i,d.latex=function(){var a=this.firstChild.latex();return a.length===1?this.cmd+a:this.cmd+"{"+(a||" ")+"}"},d.redraw=function(){this.prev&&this.prev.respace(),this.prev instanceof D||(this.respace(),this.next&&!(this.next instanceof D)&&this.next.respace())},d.respace=function(){this.prev.cmd==="\\int "||this.prev instanceof D&&this.prev.cmd!=this.cmd&&this.prev.prev&&this.prev.prev.cmd==="\\int "?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),this.respaced=this.prev instanceof D&&this.prev.cmd!=this.cmd&&!this.prev.respaced;if(this.respaced){var a=+this.jQ.css("fontSize").slice(0,-2),b=this.prev.jQ.outerWidth();thisWidth=this.jQ.outerWidth(),this.jQ.css({left:(this.limit&&this.cmd==="_"?-0.25:0)-b/a+"em",marginRight:.1-f(thisWidth,b)/a+"em"})}else this.limit&&this.cmd==="_"?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""});return this.next instanceof D&&this.next.respace(),this},s.subscript=s._=A(D,function(a){D.call(this,"_","<sub></sub>","_",a)}),s.superscript=s.supscript=s["^"]=A(D,function(a){D.call(this,"^","<sup></sup>","**",a)}),d=E.prototype=new i,d.html_template=['<span class="fraction"></span>','<span class="numerator"></span>','<span class="denominator"></span>'],d.text_template=["(","/",")"],s.frac=s.dfrac=s.cfrac=s.fraction=E,d=F.prototype=new E,d.placeCursor=function(a){if(this.firstChild.isEmpty()){var b=this.prev;while(b&&!(b instanceof X||b instanceof N||b instanceof Z))b=b.prev;b instanceof Z&&b.next instanceof D&&(b=b.next,b.next instanceof D&&b.next.cmd!=b.cmd&&(b=b.next));if(b!==this.prev){var c=(new l(this.parent,b,this)).blockify();c.jQ=this.firstChild.jQ.empty().removeClass("empty").append(c.jQ).data(e,{block:c}),c.next=this.lastChild,c.parent=this,this.firstChild=this.lastChild.prev=c}}a.appendTo(this.lastChild)},s.over=r["/"]=F,d=G.prototype=new i,d.html_template=['<span class="block"><span class="sqrt-prefix">&radic;</span></span>','<span class="sqrt-stem"></span>'],d.text_template=["sqrt(",")"],d.redraw=function(){var a=this.lastChild.jQ;t(a.prev(),1,a.innerHeight()/+a.css("fontSize").slice(0,-2)-.1)},d.optional_arg_command="nthroot",s.sqrt=s["√"]=G,d=H.prototype=new G,d.html_template=['<span class="block"><span class="sqrt-prefix">&radic;</span></span>','<sup class="nthroot"></sup>','<span class="sqrt-stem"></span>'],d.text_template=["sqrt[","](",")"],d.latex=function(){return"\\sqrt["+this.firstChild.latex()+"]{"+this.lastChild.latex()+"}"},s.nthroot=H,d=I.prototype=new i,d.initBlocks=function(a){this.firstChild=this.lastChild=a&&a.blockify()||new k,this.firstChild.parent=this,this.firstChild.jQ=this.jQ.children(":eq(1)").data(e,{block:this.firstChild}).append(this.firstChild.jQ);var b=this.blockjQ=this.firstChild.jQ;this.bracketjQs=b.prev().add(b.next())},d.latex=function(){return this.cmd+this.firstChild.latex()+this.end},d.redraw=function(){var a=this.blockjQ.outerHeight()/+this.blockjQ.css("fontSize").slice(0,-2);t(this.bracketjQs,f(1+.2*(a-1),1.2),1.05*a)},s.lbrace=r["{"]=A(I,function(a){I.call(this,"{","}","\\{","\\}",a)}),s.langle=s.lang=A(I,function(a){I.call(this,"&lang;","&rang;","\\langle ","\\rangle ",a)}),d=J.prototype=new I,d.placeCursor=function(a){!this.next&&this.parent.parent&&this.parent.parent.end===this.end&&this.firstChild.isEmpty()?a.backspace().insertAfter(this.parent.parent):(this.firstChild.blur(),this.redraw())},s.rbrace=r["}"]=A(J,function(a){J.call(this,"{","}","\\{","\\}",a)}),s.rangle=s.rang=A(J,function(a){J.call(this,"&lang;","&rang;","\\langle ","\\rangle ",a)}),K.prototype=I.prototype,s.lparen=r["("]=A(K,function(a){K.call(this,"(",")",a)}),s.lbrack=s.lbracket=r["["]=A(K,function(a){K.call(this,"[","]",a)}),L.prototype=J.prototype,s.rparen=r[")"]=A(L,function(a){L.call(this,"(",")",a)}),s.rbrack=s.rbracket=r["]"]=A(L,function(a){L.call(this,"[","]",a)}),d=M.prototype=new K,d.placeCursor=function(a){!this.next&&this.parent.parent&&this.parent.parent.end===this.end&&this.firstChild.isEmpty()?a.backspace().insertAfter(this.parent.parent):a.appendTo(this.firstChild)},s.lpipe=s.rpipe=r["|"]=M,d=N.prototype=new i,d.cmd="\\text",d.html_template=['<span class="text"></span>'],d.text_template=['"','"'],d.initBlocks=function(){this.firstChild=this.lastChild=this.jQ.data(e).block=new O,this.firstChild.parent=this,this.firstChild.jQ=this.jQ.append(this.firstChild.jQ)},d.placeCursor=function(a){(this.cursor=a).appendTo(this.firstChild);if(this.replacedText)for(var b=0;b<this.replacedText.length;b+=1)this.write(this.replacedText.charAt(b))},d.write=function(a){this.cursor.insertNew(new V(a))},d.keydown=function(a){return!this.cursor.selection&&(a.which===8&&!this.cursor.prev||a.which===46&&!this.cursor.next)?(this.isEmpty()&&this.cursor.insertAfter(this),!1):this.parent.keydown(a)},d.textInput=function(a){this.cursor.deleteSelection();if(a!=="$")this.write(a);else if(this.isEmpty())this.cursor.insertAfter(this).backspace().insertNew(new V("\\$","$"));else if(!this.cursor.next)this.cursor.insertAfter(this);else if(!this.cursor.prev)this.cursor.insertBefore(this);else{var b=new N(new l(this.firstChild,this.cursor.prev));b.placeCursor=function(a){this.prev=0,delete this.placeCursor,this.placeCursor(a)},b.firstChild.focus=function(){return this},this.cursor.insertAfter(this).insertNew(b),b.prev=this,this.cursor.insertBefore(b),delete b.firstChild.focus}},d=O.prototype=new k,d.blur=function(){this.jQ.removeClass("hasCursor");if(this.isEmpty()){var a=this.parent,b=a.cursor;b.parent===this?this.jQ.addClass("empty"):(b.hide(),a.remove(),b.next===a?b.next=a.next:b.prev===a&&(b.prev=a.prev),b.show().redraw())}return this},d.focus=function(){k.prototype.focus.call(this);var a=this.parent;if(a.next.cmd===a.cmd){var b=this,c=a.cursor,d=a.next.firstChild;d.eachChild(function(a){a.parent=b,a.jQ.appendTo(b.jQ)}),this.lastChild?this.lastChild.next=d.firstChild:this.firstChild=d.firstChild,d.firstChild.prev=this.lastChild,this.lastChild=d.lastChild,d.parent.remove(),c.prev?c.insertAfter(c.prev):c.prependTo(this),c.redraw()}else if(a.prev.cmd===a.cmd){var c=a.cursor;c.prev?a.prev.firstChild.focus():c.appendTo(a.prev.firstChild)}return this},r.$=s.text=s.textnormal=s.textrm=s.textup=s.textmd=N,s.em=s.italic=s.italics=s.emph=s.textit=s.textsl=P("\\textit",'<i class="text"></i>'),s.strong=s.bold=s.textbf=P("\\textbf",'<b class="text"></b>'),s.sf=s.textsf=P("\\textsf",'<span class="sans-serif text"></span>'),s.tt=s.texttt=P("\\texttt",'<span class="monospace text"></span>'),s.textsc=P("\\textsc",'<span style="font-variant:small-caps" class="text"></span>'),s.uppercase=P("\\uppercase",'<span style="text-transform:uppercase" class="text"></span>'),s.lowercase=P("\\lowercase",'<span style="text-transform:lowercase" class="text"></span>'),d=Q.prototype=new i,d.html_template=['<span class="latex-command-input">\\</span>'],d.text_template=["\\"],d.placeCursor=function(a){this.cursor=a.appendTo(this.firstChild),this.replacedFragment&&(this.jQ=this.jQ.add(this.replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(a){return b(a.target=this.nextSibling).trigger(a),!1}).insertBefore(this.jQ)))},d.latex=function(){return"\\"+this.firstChild.latex()+" "},d.keydown=function(a){return a.which===9||a.which===13?(this.renderCommand(),!1):this.parent.keydown(a)},d.textInput=function(a){if(a.match(/[a-z:]/i)){this.cursor.deleteSelection(),this.cursor.insertNew(new V(a));return}this.renderCommand();if(a===" "||a==="\\"&&this.firstChild.isEmpty())return;this.cursor.parent.textInput(a)},d.renderCommand=function(){this.jQ=this.jQ.last(),this.remove(),this.next?this.cursor.insertBefore(this.next):this.cursor.appendTo(this.parent);var a=this.firstChild.latex();if(a)this.cursor.insertCmd(a,this.replacedFragment);else{var b=new V("\\backslash ","\\");this.cursor.insertNew(b),this.replacedFragment&&this.replacedFragment.remove()}},r["\\"]=Q,d=R.prototype=new i,d.html_template=['<span class="block"></span>',"<span></span>","<span></span>"],d.text_template=["choose(",",",")"],d.redraw=I.prototype.redraw,s.binom=s.binomial=R,d=S.prototype=new R,d.placeCursor=F.prototype.placeCursor,s.choose=S,d=T.prototype=new i,d.html_template=['<span class="array"></span>',"<span></span>"],d.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(a,b){return a.push(b.latex()),a}).join("\\\\")+"\\end{matrix}"},d.text=function(){return"["+this.foldChildren([],function(a,b){return a.push(b.text()),a}).join()+"]"},d.placeCursor=function(a){this.cursor=a.appendTo(this.firstChild)},d.keydown=function(a){var c=this.cursor.parent;if(c.parent===this){if(a.which===13){var d=new k;return d.parent=this,d.jQ=b("<span></span>").data(e,{block:d}).insertAfter(c.jQ),c.next?c.next.prev=d:this.lastChild=d,d.next=c.next,c.next=d,d.prev=c,this.cursor.appendTo(d).redraw(),!1}if(a.which===9&&!a.shiftKey&&!c.next){if(c.isEmpty())return c.prev?(this.cursor.insertAfter(this),delete c.prev.next,this.lastChild=c.prev,c.jQ.remove(),this.cursor.redraw(),!1):this.parent.keydown(a);var d=new k;return d.parent=this,d.jQ=b("<span></span>").data(e,{block:d}).appendTo(this.jQ),this.lastChild=d,c.next=d,d.prev=c,this.cursor.appendTo(d).redraw(),!1}if(a.which===8){if(c.isEmpty())return c.prev?(this.cursor.appendTo(c.prev),c.prev.next=c.next):(this.cursor.insertBefore(this),this.firstChild=c.next),c.next?c.next.prev=c.prev:this.lastChild=c.prev,c.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.cursor.redraw(),!1;if(!this.cursor.prev)return!1}}return this.parent.keydown(a)},s.vector=T,s.editable=A(p,function(){this.init("\\editable"),m(this.jQ,this.firstChild,!1,!0);var a;this.placeCursor=function(b){a=b.appendTo(this.firstChild)},this.firstChild.blur=function(){if(a.prev!==this.parent)return;delete this.blur,this.cursor.appendTo(this),k.prototype.blur.call(this)},this.latex=function(){return this.firstChild.latex()},this.text=function(){return this.firstChild.text()}}),s.f=B(j,"f",'<var class="florin">&fnof;</var><span style="display:inline-block;width:0">&nbsp;</span>'),d=U.prototype=new j,d.text=function(){var a=this.cmd;return this.prev&&!(this.prev instanceof U)&&!(this.prev instanceof X)&&(a="*"+a),this.next&&!(this.next instanceof X)&&this.next.cmd!=="^"&&(a+="*"),a},V.prototype=j.prototype,s[":"]=r[" "]=B(V,"\\:"," "),s.prime=r["'"]=B(V,"'","&prime;"),W.prototype=j.prototype,s["@"]=W,s["&"]=B(W,"\\&","&"),s["%"]=B(W,"\\%","%"),s.alpha=s.beta=s.gamma=s.delta=s.zeta=s.eta=s.theta=s.iota=s.kappa=s.mu=s.nu=s.xi=s.rho=s.sigma=s.tau=s.chi=s.psi=s.omega=A(j,function(a,b){U.call(this,"\\"+b+" ","&"+b+";")}),s.phi=B(U,"\\phi ","&#981;"),s.phiv=s.varphi=B(U,"\\varphi ","&phi;"),s.epsilon=B(U,"\\epsilon ","&#1013;"),s.epsiv=s.varepsilon=B(U,"\\varepsilon ","&epsilon;"),s.piv=s.varpi=B(U,"\\varpi ","&piv;"),s.sigmaf=s.sigmav=s.varsigma=B(U,"\\varsigma ","&sigmaf;"),s.thetav=s.vartheta=s.thetasym=B(U,"\\vartheta ","&thetasym;"),s.upsilon=s.upsi=B(U,"\\upsilon ","&upsilon;"),s.gammad=s.Gammad=s.digamma=B(U,"\\digamma ","&#989;"),s.kappav=s.varkappa=B(U,"\\varkappa ","&#1008;"),s.rhov=s.varrho=B(U,"\\varrho ","&#1009;"),s.pi=s["π"]=B(W,"\\pi ","&pi;"),s.lambda=B(W,"\\lambda ","&lambda;"),s.Upsilon=s.Upsi=s.upsih=s.Upsih=B(j,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),s.Gamma=s.Delta=s.Theta=s.Lambda=s.Xi=s.Pi=s.Sigma=s.Phi=s.Psi=s.Omega=s.forall=A(j,function(a,b){V.call(this,"\\"+b+" ","&"+b+";")}),X.prototype=new j,d=Y.prototype=new X,d.respace=function(){return this.prev?this.prev instanceof X&&this.next&&!(this.next instanceof X)?this.jQ[0].className="unary-operator":this.jQ[0].className="binary-operator":this.jQ[0].className="",this},s["+"]=B(Y,"+","+"),s["–"]=s["-"]=B(Y,"-","&minus;"),s["±"]=s.pm=s.plusmn=s.plusminus=B(Y,"\\pm ","&plusmn;"),s.mp=s.mnplus=s.minusplus=B(Y,"\\mp ","&#8723;"),r["*"]=s.sdot=s.cdot=B(X,"\\cdot ","&middot;"),s["="]=B(X,"=","="),s["<"]=B(X,"<","&lt;"),s[">"]=B(X,">","&gt;"),s.notin=s.sim=s.cong=s.equiv=s.oplus=s.otimes=A(X,function(a,b){X.call(this,"\\"+b+" ","&"+b+";")}),s.times=A(X,function(a,b){X.call(this,"\\times ","&times;","[x]")}),s["÷"]=s.div=s.divide=s.divides=B(X,"\\div ","&divide;","[/]"),s["≠"]=s.ne=s.neq=B(X,"\\ne ","&ne;"),s.ast=s.star=s.loast=s.lowast=B(X,"\\ast ","&lowast;"),s.therefor=s.therefore=B(X,"\\therefore ","&there4;"),s.cuz=s.because=B(X,"\\because ","&#8757;"),s.prop=s.propto=B(X,"\\propto ","&prop;"),s["≈"]=s.asymp=s.approx=B(X,"\\approx ","&asymp;"),s.lt=B(X,"<","&lt;"),s.gt=B(X,">","&gt;"),s["≤"]=s.le=s.leq=B(X,"\\le ","&le;"),s["≥"]=s.ge=s.geq=B(X,"\\ge ","&ge;"),s.isin=s["in"]=B(X,"\\in ","&isin;"),s.ni=s.contains=B(X,"\\ni ","&ni;"),s.notni=s.niton=s.notcontains=s.doesnotcontain=B(X,"\\not\\ni ","&#8716;"),s.sub=s.subset=B(X,"\\subset ","&sub;"),s.sup=s.supset=s.superset=B(X,"\\supset ","&sup;"),s.nsub=s.notsub=s.nsubset=s.notsubset=B(X,"\\not\\subset ","&#8836;"),s.nsup=s.notsup=s.nsupset=s.notsupset=s.nsuperset=s.notsuperset=B(X,"\\not\\supset ","&#8837;"),s.sube=s.subeq=s.subsete=s.subseteq=B(X,"\\subseteq ","&sube;"),s.supe=s.supeq=s.supsete=s.supseteq=s.supersete=s.superseteq=B(X,"\\supseteq ","&supe;"),s.nsube=s.nsubeq=s.notsube=s.notsubeq=s.nsubsete=s.nsubseteq=s.notsubsete=s.notsubseteq=B(X,"\\not\\subseteq ","&#8840;"),s.nsupe=s.nsupeq=s.notsupe=s.notsupeq=s.nsupsete=s.nsupseteq=s.notsupsete=s.notsupseteq=s.nsupersete=s.nsuperseteq=s.notsupersete=s.notsuperseteq=B(X,"\\not\\supseteq ","&#8841;"),Z.prototype=new j,s["∑"]=s.sum=s.summation=B(Z,"\\sum ","&sum;"),s["∏"]=s.prod=s.product=B(Z,"\\prod ","&prod;"),s.coprod=s.coproduct=B(Z,"\\coprod ","&#8720;"),s["∫"]=s["int"]=s.integral=B(Z,"\\int ","&int;"),s.N=s.naturals=s.Naturals=B(V,"\\mathbb{N}","&#8469;"),s.P=s.primes=s.Primes=s.projective=s.Projective=s.probability=s.Probability=B(V,"\\mathbb{P}","&#8473;"),s.Z=s.integers=s.Integers=B(V,"\\mathbb{Z}","&#8484;"),s.Q=s.rationals=s.Rationals=B(V,"\\mathbb{Q}","&#8474;"),s.R=s.reals=s.Reals=B(V,"\\mathbb{R}","&#8477;"),s.C=s.complex=s.Complex=s.complexes=s.Complexes=s.complexplane=s.Complexplane=s.ComplexPlane=B(V,"\\mathbb{C}","&#8450;"),s.H=s.Hamiltonian=s.quaternions=s.Quaternions=B(V,"\\mathbb{H}","&#8461;"),s.quad=s.emsp=B(V,"\\quad ","    "),s.qquad=B(V,"\\qquad ","        "),s.diamond=B(V,"\\diamond ","&#9671;"),s.bigtriangleup=B(V,"\\bigtriangleup ","&#9651;"),s.ominus=B(V,"\\ominus ","&#8854;"),s.uplus=B(V,"\\uplus ","&#8846;"),s.bigtriangledown=B(V,"\\bigtriangledown ","&#9661;"),s.sqcap=B(V,"\\sqcap ","&#8851;"),s.triangleleft=B(V,"\\triangleleft ","&#8882;"),s.sqcup=B(V,"\\sqcup ","&#8852;"),s.triangleright=B(V,"\\triangleright ","&#8883;"),s.odot=B(V,"\\odot ","&#8857;"),s.bigcirc=B(V,"\\bigcirc ","&#9711;"),s.dagger=B(V,"\\dagger ","&#0134;"),s.ddagger=B(V,"\\ddagger ","&#135;"),s.wr=B(V,"\\wr ","&#8768;"),s.amalg=B(V,"\\amalg ","&#8720;"),s.models=B(V,"\\models ","&#8872;"),s.prec=B(V,"\\prec ","&#8826;"),s.succ=B(V,"\\succ ","&#8827;"),s.preceq=B(V,"\\preceq ","&#8828;"),s.succeq=B(V,"\\succeq ","&#8829;"),s.simeq=B(V,"\\simeq ","&#8771;"),s.mid=B(V,"\\mid ","&#8739;"),s.ll=B(V,"\\ll ","&#8810;"),s.gg=B(V,"\\gg ","&#8811;"),s.parallel=B(V,"\\parallel ","&#8741;"),s.bowtie=B(V,"\\bowtie ","&#8904;"),s.sqsubset=B(V,"\\sqsubset ","&#8847;"),s.sqsupset=B(V,"\\sqsupset ","&#8848;"),s.smile=B(V,"\\smile ","&#8995;"),s.sqsubseteq=B(V,"\\sqsubseteq ","&#8849;"),s.sqsupseteq=B(V,"\\sqsupseteq ","&#8850;"),s.doteq=B(V,"\\doteq ","&#8784;"),s.frown=B(V,"\\frown ","&#8994;"),s.vdash=B(V,"\\vdash ","&#8870;"),s.dashv=B(V,"\\dashv ","&#8867;"),s.longleftarrow=B(V,"\\longleftarrow ","&#8592;"),s.longrightarrow=B(V,"\\longrightarrow ","&#8594;"),s.Longleftarrow=B(V,"\\Longleftarrow ","&#8656;"),s.Longrightarrow=B(V,"\\Longrightarrow ","&#8658;"),s.longleftrightarrow=B(V,"\\longleftrightarrow ","&#8596;"),s.updownarrow=B(V,"\\updownarrow ","&#8597;"),s.Longleftrightarrow=B(V,"\\Longleftrightarrow ","&#8660;"),s.Updownarrow=B(V,"\\Updownarrow ","&#8661;"),s.mapsto=B(V,"\\mapsto ","&#8614;"),s.nearrow=B(V,"\\nearrow ","&#8599;"),s.hookleftarrow=B(V,"\\hookleftarrow ","&#8617;"),s.hookrightarrow=B(V,"\\hookrightarrow ","&#8618;"),s.searrow=B(V,"\\searrow ","&#8600;"),s.leftharpoonup=B(V,"\\leftharpoonup ","&#8636;"),s.rightharpoonup=B(V,"\\rightharpoonup ","&#8640;"),s.swarrow=B(V,"\\swarrow ","&#8601;"),s.leftharpoondown=B(V,"\\leftharpoondown ","&#8637;"),s.rightharpoondown=B(V,"\\rightharpoondown ","&#8641;"),s.nwarrow=B(V,"\\nwarrow ","&#8598;"),s.ldots=B(V,"\\ldots ","&#8230;"),s.cdots=B(V,"\\cdots ","&#8943;"),s.vdots=B(V,"\\vdots ","&#8942;"),s.ddots=B(V,"\\ddots ","&#8944;"),s.surd=B(V,"\\surd ","&#8730;"),s.triangle=B(V,"\\triangle ","&#9653;"),s.ell=B(V,"\\ell ","&#8467;"),s.top=B(V,"\\top ","&#8868;"),s.flat=B(V,"\\flat ","&#9837;"),s.natural=B(V,"\\natural ","&#9838;"),s.sharp=B(V,"\\sharp ","&#9839;"),s.wp=B(V,"\\wp ","&#8472;"),s.bot=B(V,"\\bot ","&#8869;"),s.clubsuit=B(V,"\\clubsuit ","&#9827;"),s.diamondsuit=B(V,"\\diamondsuit ","&#9826;"),s.heartsuit=B(V,"\\heartsuit ","&#9825;"),s.spadesuit=B(V,"\\spadesuit ","&#9824;"),s.oint=B(V,"\\oint ","&#8750;"),s.bigcap=B(V,"\\bigcap ","&#8745;"),s.bigcup=B(V,"\\bigcup ","&#8746;"),s.bigsqcup=B(V,"\\bigsqcup ","&#8852;"),s.bigvee=B(V,"\\bigvee ","&#8744;"),s.bigwedge=B(V,"\\bigwedge ","&#8743;"),s.bigodot=B(V,"\\bigodot ","&#8857;"),s.bigotimes=B(V,"\\bigotimes ","&#8855;"),s.bigoplus=B(V,"\\bigoplus ","&#8853;"),s.biguplus=B(V,"\\biguplus ","&#8846;"),s.lfloor=B(V,"\\lfloor ","&#8970;"),s.rfloor=B(V,"\\rfloor ","&#8971;"),s.lceil=B(V,"\\lceil ","&#8968;"),s.rceil=B(V,"\\rceil ","&#8969;"),s.slash=B(V,"\\slash ","&#47;"),s.opencurlybrace=B(V,"\\opencurlybrace ","&#123;"),s.closecurlybrace=B(V,"\\closecurlybrace ","&#125;"),s.caret=B(V,"\\caret ","^"),s.underscore=B(V,"\\underscore ","_"),s.backslash=B(V,"\\backslash ","\\"),s.vert=B(V,"|"),s.perp=s.perpendicular=B(V,"\\perp ","&perp;"),s.nabla=s.del=B(V,"\\nabla ","&nabla;"),s.hbar=B(V,"\\hbar ","&#8463;"),s.AA=s.Angstrom=s.angstrom=B(V,"\\text\\AA ","&#8491;"),s.ring=s.circ=s.circle=B(V,"\\circ ","&#8728;"),s.bull=s.bullet=B(V,"\\bullet ","&bull;"),s.setminus=s.smallsetminus=B(V,"\\setminus ","&#8726;"),s.not=s["¬"]=s.neg=B(V,"\\neg ","&not;"),s["…"]=s.dots=s.ellip=s.hellip=s.ellipsis=s.hellipsis=B(V,"\\dots ","&hellip;"),s.converges=s.darr=s.dnarr=s.dnarrow=s.downarrow=B(V,"\\downarrow ","&darr;"),s.dArr=s.dnArr=s.dnArrow=s.Downarrow=B(V,"\\Downarrow ","&dArr;"),s.diverges=s.uarr=s.uparrow=B(V,"\\uparrow ","&uarr;"),s.uArr=s.Uparrow=B(V,"\\Uparrow ","&uArr;"),s.to=B(X,"\\to ","&rarr;"),s.rarr=s.rightarrow=B(V,"\\rightarrow ","&rarr;"),s.implies=B(X,"\\Rightarrow ","&rArr;"),s.rArr=s.Rightarrow=B(V,"\\Rightarrow ","&rArr;"),s.gets=B(X,"\\gets ","&larr;"),s.larr=s.leftarrow=B(V,"\\leftarrow ","&larr;"),s.impliedby=B(X,"\\Leftarrow ","&lArr;"),s.lArr=s.Leftarrow=B(V,"\\Leftarrow ","&lArr;"),s.harr=s.lrarr=s.leftrightarrow=B(V,"\\leftrightarrow ","&harr;"),s.iff=B(X,"\\Leftrightarrow ","&hArr;"),s.hArr=s.lrArr=s.Leftrightarrow=B(V,"\\Leftrightarrow ","&hArr;"),s.Re=s.Real=s.real=B(V,"\\Re ","&real;"),s.Im=s.imag=s.image=s.imagin=s.imaginary=s.Imaginary=B(V,"\\Im ","&image;"),s.part=s.partial=B(V,"\\partial ","&part;"),s.inf=s.infin=s.infty=s.infinity=B(V,"\\infty ","&infin;"),s.alef=s.alefsym=s.aleph=s.alephsym=B(V,"\\aleph ","&alefsym;"),s.xist=s.xists=s.exist=s.exists=B(V,"\\exists ","&exist;"),s.and=s.land=s.wedge=B(V,"\\wedge ","&and;"),s.or=s.lor=s.vee=B(V,"\\vee ","&or;"),s.o=s.O=s.empty=s.emptyset=s.oslash=s.Oslash=s.nothing=s.varnothing=B(X,"\\varnothing ","&empty;"),s.cup=s.union=B(V,"\\cup ","&cup;"),s.cap=s.intersect=s.intersection=B(V,"\\cap ","&cap;"),s.deg=s.degree=B(V,"^\\circ ","&deg;"),s.ang=s.angle=B(V,"\\angle ","&ang;"),d=$.prototype=new j,d.respace=function(){this.jQ[0].className=this.next instanceof D||this.next instanceof I?"":"non-italicized-function"},s.ln=s.lg=s.log=s.span=s.proj=s.det=s.dim=s.min=s.max=s.mod=s.lcm=s.gcd=s.gcf=s.hcf=s.lim=$,function(){var a=["sin","cos","tan","sec","cosec","csc","cotan","cot"];for(var b in a)s[a[b]]=s[a[b]+"h"]=s["a"+a[b]]=s["arc"+a[b]]=s["a"+a[b]+"h"]=s["arc"+a[b]+"h"]=$}(),d=_.prototype,d.prev=0,d.next=0,d.parent=0,d.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this.next?this.selection&&this.selection.prev===this.prev?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this.next.jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},d.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=b(),this},d.redraw=function(){for(var a=this.parent;a;a=a.parent)a.redraw&&a.redraw()},d.insertAt=function(a,b,c){var d=this.parent;this.parent=a,this.prev=b,this.next=c,d.blur()},d.insertBefore=function(a){return this.insertAt(a.parent,a.prev,a),this.parent.jQ.addClass("hasCursor"),this.jQ.insertBefore(a.jQ.first()),this},d.insertAfter=function(a){return this.insertAt(a.parent,a,a.next),this.parent.jQ.addClass("hasCursor"),this.jQ.insertAfter(a.jQ.last()),this},d.prependTo=function(a){return this.insertAt(a,0,a.firstChild),a.textarea?this.jQ.insertAfter(a.textarea):this.jQ.prependTo(a.jQ),a.focus(),this},d.appendTo=function(a){return this.insertAt(a,a.lastChild,0),this.jQ.appendTo(a.jQ),a.focus(),this},d.hopLeft=function(){return this.jQ.insertBefore(this.prev.jQ.first()),this.next=this.prev,this.prev=this.prev.prev,this},d.hopRight=function(){return this.jQ.insertAfter(this.next.jQ.last()),this.prev=this.next,this.next=this.next.next,this},d.moveLeft=function(){return this.selection?this.insertBefore(this.selection.prev.next||this.parent.firstChild).clearSelection():this.prev?this.prev.lastChild?this.appendTo(this.prev.lastChild):this.hopLeft():this.parent.prev?this.appendTo(this.parent.prev):this.parent!==this.root&&this.insertBefore(this.parent.parent),this.show()},d.moveRight=function(){return this.selection?this.insertAfter(this.selection.next.prev||this.parent.lastChild).clearSelection():this.next?this.next.firstChild?this.prependTo(this.next.firstChild):this.hopRight():this.parent.next?this.prependTo(this.parent.next):this.parent!==this.root&&this.insertAfter(this.parent.parent),this.show()},d.seek=function(a,b,c){var d=this.clearSelection();if(a.hasClass("empty"))return d.prependTo(a.data(e).block),d;var f=a.data(e);if(f){if(f.cmd&&!f.block)return a.outerWidth()>2*(b-a.offset().left)?d.insertBefore(f.cmd):d.insertAfter(f.cmd),d}else a=a.parent(),f=a.data(e),f||(f={block:d.root});f.cmd?d.insertAfter(f.cmd):d.appendTo(f.block);var g=d.jQ.offset().left-b,h;do d.moveLeft(),h=g,g=d.jQ.offset().left-b;while(g>0&&(d.prev||d.parent!==d.root));return-g>h&&d.moveRight(),d},d.resolveNonItalicizedFunctions=function(){var a=this.prev,b=a?a.latex().replace(/ $/,""):null,c=0,d={ln:1,lg:1,log:1,span:1,proj:1,det:1,dim:1,min:1,max:1,mod:1,lcm:1,gcd:1,gcf:1,hcf:1,lim:1,sin:1,sinh:1,asin:1,arcsin:1,asinh:1,arcsinh:1,cos:1,cosh:1,acos:1,arccos:1,acosh:1,arccosh:1,tan:1,tanh:1,atan:1,arctan:1,atanh:1,arctanh:1,sec:1,sech:1,asec:1,arcsec:1,asech:1,arcsech:1,cosec:1,cosech:1,acosec:1,arccosec:1,acosech:1,arccosech:1,csc:1,csch:1,acsc:1,arccsc:1,acsch:1,arccsch:1,cotan:1,cotanh:1,acotan:1,arccotan:1,acotanh:1,arccotanh:1,cot:1,coth:1,acot:1,arccot:1,acoth:1,arccoth:1},e="";while(a&&b){var f=b.match(/^[a-z]$/);if(!(f||e&&b[0]=="\\"&&d[b.substring(1)]&&d[(b+e).substring(1)]))return;c++,e=b.replace(/\\/,"")+e,a=a.prev,b=a?a.latex().replace(/ $/,""):null;if(!f||(!a||!b.match(/^[a-z]$/))&&d[e]){for(var g=0;g<c;g++)this.selectLeft();this.writeLatex("\\"+e);return}}},d.writeLatex=function(a,b){return this.deleteSelection(),a=a&&a.match(/\\text\{([^}]|\\\})*\}|\\:|\\[a-z]*|[^\s]/ig)||0,function d(e){while(a.length){var f=a.shift();if(!f||f==="}"||f==="]")return;var g;if(f.slice(0,6)==="\\text{"){g=new N(f.slice(6,-1)),e.insertNew(g).insertAfter(g);continue}if(f==="\\left"||f==="\\right"){f=a.shift(),f==="\\"&&(f=a.shift()),e.insertCh(f),g=e.prev||e.parent.parent;if(e.prev)return;a.unshift("{")}else if(/^\\[a-z:]+$/i.test(f)){f=f.slice(1);var g=s[f];if(!g){g=new N(f),e.insertNew(g).insertAfter(g);continue}g=new g(c,f),a[0]==="["&&g.optional_arg_command&&(f=g.optional_arg_command,g=new s[f](c,f)),e.insertNew(g)}else f.match(/[a-eg-zA-Z]/)?g=new U(f):(g=s[f])?g=new g:g=new V(f),e.insertNew(g);g.eachChild(function(b){e.appendTo(b);var c=a.shift();if(!c)return!1;c==="{"||c==="["?d(e):e.insertCh(c)}),b||e.insertAfter(g)}}(this),this.hide()},d.write=function(a){var b=this.show().insertCh(a);return this.root.toolbar&&this.resolveNonItalicizedFunctions(),b},d.insertCh=function(a){this.selection&&(this.prev=this.selection.prev,this.next=this.selection.next);var b;return a.match(/^[a-eg-zA-Z]$/)?b=new U(a):(b=r[a]||s[a])?b=new b(this.selection,a):b=new V(a),this.selection&&(b instanceof j&&this.selection.remove(),delete this.selection),this.insertNew(b)},d.insertNew=function(a){return a.insertAt(this),this},d.insertCmd=function(a,b){var c=s[a];return c?(c=new c(b,a),this.insertNew(c),c instanceof j&&b&&b.remove()):(c=new N(a),c.firstChild.focus=function(){return delete this.focus,this},this.insertNew(c).insertAfter(c),b&&b.remove()),this},d.unwrapGramp=function(){var a=this.parent.parent,b=a.parent,c=a.prev,d=this;a.eachChild(function(d){if(d.isEmpty())return;d.eachChild(function(c){c.parent=b,c.jQ.insertBefore(a.jQ.first())}),d.firstChild.prev=c,c?c.next=d.firstChild:b.firstChild=d.firstChild,c=d.lastChild}),c.next=a.next,a.next?a.next.prev=c:b.lastChild=c;if(!this.next)if(this.prev)this.next=this.prev.next;else while(!this.next){this.parent=this.parent.next;if(!this.parent){this.next=a.next,this.parent=b;break}this.next=this.parent.firstChild}this.next?this.insertBefore(this.next):this.appendTo(b),a.jQ.remove(),a.prev&&a.prev.respace(),a.next&&a.next.respace()},d.backspace=function(){if(!this.deleteSelection())if(this.prev)this.prev.isEmpty()?this.prev=this.prev.remove().prev:this.selectLeft();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertAfter(this.parent.parent).backspace();this.unwrapGramp()}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.redraw(),this},d.deleteForward=function(){if(!this.deleteSelection())if(this.next)this.next.isEmpty()?this.next=this.next.remove().next:this.selectRight();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertBefore(this.parent.parent).deleteForward();this.unwrapGramp()}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.redraw(),this},d.selectFrom=function(a){var b=this,c=a;a:for(;;){for(var d=this;d!==b.parent.parent;d=d.parent.parent)if(d.parent===c.parent){f=d,g=c;break a}for(var e=a;e!==c.parent.parent;e=e.parent.parent)if(b.parent===e.parent){f=b,g=e;break a}b.parent.parent&&(b=b.parent.parent),c.parent.parent&&(c=c.parent.parent)}var f,g,h;if(f.next!==g){for(var i=f;i;i=i.next)if(i===g.prev){h=!0;break}h||(h=g,g=f,f=h)}this.hide().selection=new ab(f.parent,f.prev,g.next),this.insertAfter(g.next.prev||g.parent.lastChild),this.root.selectionChanged()},d.selectLeft=function(){if(this.selection)if(this.selection.prev===this.prev)this.prev?(this.hopLeft().next.jQ.prependTo(this.selection.jQ),this.selection.prev=this.prev):this.parent!==this.root&&this.insertBefore(this.parent.parent).selection.levelUp();else{this.prev.jQ.insertAfter(this.selection.jQ),this.hopLeft().selection.next=this.next;if(this.selection.prev===this.prev){this.deleteSelection();return}}else{if(this.prev)this.hopLeft();else{if(this.parent===this.root)return;this.insertBefore(this.parent.parent)}this.hide().selection=new ab(this.parent,this.prev,this.next.next)}this.root.selectionChanged()},d.selectRight=function(){if(this.selection)if(this.selection.next===this.next)this.next?(this.hopRight().prev.jQ.appendTo(this.selection.jQ),this.selection.next=this.next):this.parent!==this.root&&this.insertAfter(this.parent.parent).selection.levelUp();else{this.next.jQ.insertBefore(this.selection.jQ),this.hopRight().selection.prev=this.prev;if(this.selection.next===this.next){this.deleteSelection();return}}else{if(this.next)this.hopRight();else{if(this.parent===this.root)return;this.insertAfter(this.parent.parent)}this.hide().selection=new ab(this.parent,this.prev.prev,this.next)}this.root.selectionChanged()},d.clearSelection=function(){return this.show().selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this},d.deleteSelection=function(){return this.show().selection?(this.prev=this.selection.prev,this.next=this.selection.next,this.selection.remove(),delete this.selection,this.root.selectionChanged(),!0):!1},d=ab.prototype=new l,d.jQinit=function(a){this.jQ=a.wrapAll('<span class="selection"></span>').parent()},d.levelUp=function(){return this.clear().jQinit(this.parent.parent.jQ),this.prev=this.parent.parent.prev,this.next=this.parent.parent.next,this.parent=this.parent.parent.parent,this},d.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this},d.blockify=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),l.prototype.blockify.call(this)},d.detach=function(){var a=l.prototype.blockify.call(this);return this.blockify=function(){return this.jQ.replaceWith(a.jQ=this.jQ=this.jQ.children()),a},this},b.fn.mathquill=function(a,c){switch(a){case"redraw":return this.find(":not(:has(:first))").each(function(){var a=b(this).data(e);a&&(a.cmd||a.block)&&_.prototype.redraw.call(a.cmd||a.block)}),this;case"revert":return this.each(function(){var a=b(this).data(e);a&&a.revert&&a.revert()});case"latex":if(arguments.length>1)return this.each(function(){var a=b(this).data(e);a&&a.block&&a.block.renderLatex&&a.block.renderLatex(c)});var d=this.data(e);return d&&d.block&&d.block.latex();case"text":var d=this.data(e);return d&&d.block&&d.block.text();case"html":return this.html().replace(/ ?hasCursor|hasCursor /,"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":if(arguments.length>1)return this.each(function(){var a=b(this).data(e),d=a&&a.block,f=d&&d.cursor;f&&f.writeLatex(c).parent.blur()});case"cmd":if(arguments.length>1)return this.each(function(){var a=b(this).data(e),d=a&&a.block,f=d&&d.cursor;f&&(f.show(),/^\\[a-z]+$/i.test(c)?(f.selection&&(f.prev=f.selection.prev,f.next=f.selection.next),f.insertCmd(c.slice(1),f.selection),delete f.selection):f.insertCh(c),f.hide().parent.blur())});default:var f=a==="textbox",g=a==="editor",h=g||f||a==="editable",i=f?q:o;return this.each(function(){m(b(this),new i,f,h,g)})}},b(function(){b(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable"),b(".mathquill-editor").mathquill("editor"),b(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox"),b(".mathquill-embedded-latex").mathquill()})})