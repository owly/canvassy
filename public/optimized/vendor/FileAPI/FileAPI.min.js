(function(a){var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c;if(c=a.Blob)try{c=Boolean(new Blob)}catch(d){c=!1}var e=c;if(c=e)if(c=a.Uint8Array)try{c=100===(new Blob([new Uint8Array(100)])).size}catch(f){c=!1}var g=c,h=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,i=(e||h)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,c,d,f;b=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c);for(f=0;f<b.length;f+=1)d[f]=b.charCodeAt(f);return a=a.split(",")[0].split(":")[1].split(";")[0],e?new Blob([g?d:c],{type:a}):(d=new h,d.append(c),d.getBlob(a))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,b){a(this.mozGetAsFile("blob",b))}:b.toDataURL&&i&&(b.toBlob=function(a,b){a(i(this.toDataURL(b)))})),"function"==typeof define&&define.amd?define([],function(){return i}):a.dataURLtoBlob=i})(this),function(a,b){function c(a,b,c){if(a)if(k(a))for(var d=0,e=a.length;d<e;d++)d in a&&b.call(c,a[d],d,a);else for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}function d(a,b,d){if(a){var e=O.uid(a);K[e]||(K[e]={}),c(b.split(/\s+/),function(b){v?v.event.add(a,b,d):(K[e][b]||(K[e][b]=[]),K[e][b].push(d),a.addEventListener?a.addEventListener(b,d,!1):a.attachEvent?a.attachEvent("on"+b,d):a["on"+b]=d)})}}function e(a,b,d){if(a){var e=O.uid(a),f=K[e]||{};c(b.split(/\s+/),function(b){if(v)v.event.remove(a,b,d);else{for(var c=f[b]||[],e=c.length;e--;)if(c[e]===d){c.splice(e,1);break}a.addEventListener?a.removeEventListener(b,d,!1):a.detachEvent?a.detachEvent("on"+b,d):a["on"+b]=null}})}}function f(a,b,c){d(a,b,function f(d){e(a,b,f),c(d)})}function g(a,b,c,d,e){a={type:c.type||c,target:a,result:d},O.extend(a,e),b(a)}function h(a,c,f,h){if(O.isFile(a)&&s&&s.prototype["readAs"+f]){var i=new s;d(i,M,function k(b){var d=b.type;"progress"==d?g(a,c,b,b.target.result,{loaded:b.loaded,total:b.total}):"loadend"==d?(e(i,M,k),i=null):g(a,c,b,b.target.result)});try{h?i["readAs"+f](h,a):i["readAs"+f](a)}catch(j){g(a,c,"error",b,{error:j.toString()})}}else g(a,c,"error",b,{error:"filreader_not_support_"+f})}function i(a){var b;return a.getAsEntry?b=a.getAsEntry():a.webkitGetAsEntry&&(b=a.webkitGetAsEntry()),b}function j(a,b){if(a)if(a.isFile)a.file(function(a){b(!1,[a])},function(){b("entry_file")});else if(a.isDirectory){var c=[];a.createReader().readEntries(function(a){O.afor(a,function(a,d){j(d,function(d,e){d||(c=c.concat(e)),a?a():b(!1,c)})})},function(){b("directory_reader")})}else j(i(a),b);else b("empty_entry")}function k(a){return"object"==typeof a&&a&&"length"in a}function l(b){return b.target||(b.target=a.event&&a.event.srcElement||x),3===b.target.nodeType&&(b.target=event.target.parentNode),b}var m=1,n=function(){},o=navigator.userAgent,p=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL&&webkitURL,q=a.Blob,r=a.File,s=a.FileReader,t=a.FormData,u=a.XMLHttpRequest,v=a.jQuery,w=!(!r||!s||!a.Uint8Array&&!t&&!u.prototype.sendAsBinary)&&!(/safari\//i.test(o)&&!/chrome\//i.test(o)&&/windows/i.test(o)),o=w&&"withCredentials"in new u,q=w&&!!q&&!(!q.prototype.webkitSlice&&!q.prototype.mozSlice&&!q.prototype.slice),x=a.document,y=a.dataURLtoBlob,z=/img/i,A=/canvas/i,B=/img|canvas/,C=/input/i,D=/^data:[^,]+,/,E=Math.pow,F=Math.round,G=Number,t=function(a){return F(a*this)},H=new G(1024),I=new G(E(H,2)),J=new G(E(H,3)),E=new G(E(H,4)),K={},L=[],M="abort progress error load loadend",N="status statusText readyState response responseXML responseText responseBody".split(" "),O={version:"1.2.5",cors:!1,html5:!0,debug:!1,pingUrl:!1,withCredentials:!0,staticPath:"./",flashUrl:0,flashImageUrl:0,accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:(H.from=t,H),MB:(I.from=t,I),GB:(J.from=t,J),TB:(E.from=t,E),expando:"fileapi"+(new Date).getTime(),uid:function(a){return a?a[O.expando]=a[O.expando]||O.uid():(++m,O.expando+m)},log:function(){O.debug&&a.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},getXHR:function(){var b;if(u)b=new u;else if(a.ActiveXObject)try{b=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(c){b=new ActiveXObject("Microsoft.XMLHTTP")}return b},isArray:k,support:{dnd:o&&"ondrop"in x.createElement("div"),cors:o,html5:w,chunked:q,dataURI:!0},event:{on:d,off:e,one:f,fix:l},throttle:function(b,c){var d,e;return function(){e=arguments,d||(b.apply(a,e),d=setTimeout(function(){d=0,b.apply(a,e)},c))}},F:function(){},parseJSON:function(b){return a.JSON&&JSON.parse?JSON.parse(b):(new Function("return ("+b.replace(/([\r\n])/g,"\\$1")+");"))()},trim:function(a){return a=String(a),a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},defer:function(){var a=[],c,d,e={resolve:function(b,f){e.resolve=n,d=b||!1;for(c=f;f=a.shift();)f(d,c)},then:function(e){d!==b?e(d,c):a.push(e)}};return e},queue:function(a){var b=0,c=0,d=!1,e=!1,f={inc:function(){c++},next:function(){b++,setTimeout(f.check,0)},check:function(){b>=c&&!d&&f.end()},isFail:function(){return d},fail:function(){!d&&a(d=!0)},end:function(){e||(e=!0,a())}};return f},each:c,afor:function(a,b){var c=0,d=a.length;k(a)&&d--?function e(){b(d!=c&&e,a[c],c++)}():b(!1)},extend:function(a){return c(arguments,function(b){c(b,function(b,c){a[c]=b})}),a},isFile:function(a){return w&&a&&a instanceof r},isCanvas:function(a){return a&&A.test(a.nodeName)},getFilesFilter:function(a){return(a="string"==typeof a?a:a.getAttribute&&a.getAttribute("accept")||"")?RegExp("("+a.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(a,b){O.isCanvas(a)?g(a,b,"load",O.toDataURL(a)):h(a,b,"DataURL")},readAsBinaryString:function(a,b){s&&s.prototype.readAsBinaryString?h(a,b,"BinaryString"):h(a,function(a){if("load"==a.type)try{a.result=O.toBinaryString(a.result)}catch(c){a.type="error",a.message=c.toString()}b(a)},"DataURL")},readAsArrayBuffer:function(a,b){h(a,b,"ArrayBuffer")},readAsText:function(a,b,c){c||(c=b,b="utf-8"),h(a,c,"Text",b)},toDataURL:function(a){if("string"==typeof a)return a;if(a.toDataURL)return a.toDataURL("image/png")},toBinaryString:function(b){return a.atob(O.toDataURL(b).replace(D,""))},readAsImage:function(a,c,d){if(O.isFile(a))if(p){var h=p.createObjectURL(a);h===b?g(a,c,"error"):O.readAsImage(h,c,d)}else O.readAsDataURL(a,function(b){"load"==b.type?O.readAsImage(b.result,c,d):(d||"error"==b.type)&&g(a,c,b,null,{loaded:b.loaded,total:b.total})});else O.isCanvas(a)?g(a,c,"load",a):z.test(a.nodeName)?a.complete?g(a,c,"load",a):f(a,"error abort load",function i(b){"load"==b.type&&p&&p.revokeObjectURL(a.src),e(a,"error abort load",i),g(a,c,b,a)}):a.iframe?g(a,c,{type:"error"}):(h=new Image,h.src=a.dataURL||a,O.readAsImage(h,c,d))},checkFileObj:function(a){var b={},d=O.accept;return"object"==typeof a?b=a:b.name=(a+"").split(/\\|\//g).pop(),null==b.type&&(b.type=b.name.split(".").pop()),c(d,function(a,c){a=RegExp(a.replace(/\s/g,"|"),"i"),a.test(b.type)&&(b.type=c.split("/")[0]+"/"+b.type)}),b},getDropFiles:function(a,b){var d=[],e=(a.originalEvent||a||"").dataTransfer||{},g=k(e.items)&&e.items[0]&&i(e.items[0]),h=O.queue(function(){b(d)});c((g?e.items:e.files)||[],function(a){h.inc();if(g)j(a,function(a,b){!a&&d.push.apply(d,b),h.next()});else{var b=function(b){b&&d.push(a),h.next()};if(!a.type&&0==a.size%4096&&102400>=a.size)if(s)try{var c=new s;f(c,M,function(a){a="error"!=a.type,b(a),a&&c.abort()}),c.readAsDataURL(a)}catch(e){b(!1)}else b(null);else b(!0)}}),h.check()},getFiles:function(a,b,c){var d=[];return c?(O.filterFiles(O.getFiles(a),b,c),null):(a.jquery&&(a.each(function(){d=d.concat(O.getFiles(this))}),a=d,d=[]),"string"==typeof b&&(b=O.getFilesFilter(b)),a.originalEvent?a=l(a.originalEvent):a.srcElement&&(a=l(a)),a.dataTransfer?a=a.dataTransfer:a.target&&(a=a.target),a.files?d=a.files:!w&&C.test(a&&a.tagName)?O.trim(a.value)&&(d=[O.checkFileObj(a.value)],d[0].blob=a,d[0].iframe=!0):k(a)&&(d=a),O.filter(d,function(a){return!b||b.test(a.name)}))},getInfo:function(a,b){var c={},d=L.concat();O.isFile(a)?function e(){var f=d.shift();f?f.test(a.type)?f(a,function(a,d){a?b(a):(O.extend(c,d),e())}):e():b(!1,c)}():b("not_support",c)},addInfoReader:function(a,b){b.test=function(b){return a.test(b)},L.push(b)},filter:function(a,b){for(var c=[],d=0,e=a.length,f;d<e;d++)d in a&&(f=a[d],b.call(f,f,d,a)&&c.push(f));return c},filterFiles:function(a,b,c){if(a.length){var d=a.concat(),e,f=[],g=[];(function h(){d.length?(e=d.shift(),O.getInfo(e,function(a,c){(b(e,a?!1:c)?f:g).push(e),h()})):c(f,g)})()}else c([],a)},upload:function(a){a=O.extend({prepare:O.F,beforeupload:O.F,upload:O.F,fileupload:O.F,fileprogress:O.F,filecomplete:O.F,progress:O.F,complete:O.F,pause:O.F,chunkSize:O.chunkSize,chunkUpoloadRetry:O.chunkUploadRetry},a),a.imageAutoOrientation&&!a.imageTransform&&(a.imageTransform={rotate:"auto"});var b=new O.XHR(a),d=this._getFilesDataArray(a.files),e=0,f=0,g=this,h,i=!1;return c(d,function(a){e+=a.size}),b.files=[],c(d,function(a){b.files.push(a.file)}),b.total=e,b.loaded=0,a.beforeupload(b,a),(h=function j(){var h=d.shift(),k=h&&h.file,l=!1,m={};c(a,function(a,b){a&&"object"==typeof a&&(a=O.extend({},a)),m[b]=a}),k&&k.name===O.expando&&(k=null,O.log("[warn] FileAPI.upload() â€” called without files")),("abort"!=b.statusText||b.current)&&h?(i=!1,(b.currentFile=k)&&a.prepare(k,m),this._getFormData(m,h,function(d){f||a.upload(b,a);var i=new O.XHR(O.extend({},m,{upload:k?function(){a.fileupload(k,i,m)}:n,progress:k?function(c){l||(a.fileprogress({type:"progress",total:h.total=c.total,loaded:h.loaded=c.loaded},k,i,m),a.progress({type:"progress",total:e,loaded:b.loaded=f+h.size*(c.loaded/c.total)|0},k,i,m))}:n,complete:function(d){l=!0,c(N,function(a){b[a]=i[a]}),k&&(h.loaded=h.total,this.progress(h),f+=h.size,b.loaded=f,a.filecomplete(d,i,k,m)),j.call(g)}}));b.abort=function(a){this.current=a,i.abort()},i.send(d)})):(a.complete(200==b.status||201==b.status?!1:b.statusText||"error",b,a),i=!0)}).call(this),b.append=function(a,f){a=O._getFilesDataArray([].concat(a)),c(a,function(a){e+=a.size,b.files.push(a.file),f?d.unshift(a):d.push(a)}),i&&h.call(g)},b.remove=function(a){var b=-1;c(d,function(c){b++;if(c.file==a)return d.splice(b,1)})},b},_getFilesDataArray:function(a){var b=[],d={};if(C.test(a&&a.tagName)){var e=O.getFiles(a);d[a.name||"file"]=null!==a.getAttribute("multiple")?e:e[0]}else k(a)&&C.test(a[0]&&a[0].tagName)?c(a,function(a){d[a.name||"file"]=O.getFiles(a)}):d=a;return c(d,function f(a,d){k(a)?c(a,function(a){f(a,d)}):a&&a.name&&b.push({name:d,file:a,size:a.size,total:a.size,loaded:0})}),b.length||b.push({file:{name:O.expando}}),b},_getFormData:function(a,b,d){var e=b.file,f=b.name,g=e.name,h=e.type;b=O.support.transform&&a.imageTransform;var i=new O.Form,j=O.queue(function(){d(i)}),k=b&&(0<parseInt(b.maxWidth||b.minWidth||b.width,10)||b.rotate);O.Image&&b&&(/image/.test(e.type)||B.test(e.nodeType))?(j.inc(),k&&(b=[b]),O.Image.transform(e,b,a.imageAutoOrientation,function(b,d){k&&!b?(!y&&!O.flashEngine&&(d[0]=O.toBinaryString(d[0]),i.multipart=!0),i.append(f,d[0],g,h)):(b||(c(d,function(a,b){!y&&!O.flashEngine&&(a=O.toBinaryString(a),i.multipart=!0),i.append(f+"["+b+"]",a,g,h)}),f+="[original]"),(b||a.imageOriginal)&&i.append(f,e,g,h)),j.next()})):g!==O.expando&&i.append(f,e,g),c(a.data,function l(a,b){"object"==typeof a?c(a,function(a,c){l(a,b+"["+c+"]")}):i.append(b,a)}),j.check()},reset:function(a){var b,f;return v?(f=v(a).clone(!0).insertBefore(a).val("")[0],v(a).remove()):(b=a.parentNode,f=b.insertBefore(a.cloneNode(!0),a),f.value="",b.removeChild(a),c(K[O.uid(a)],function(b,g){c(b,function(b){e(a,g,b),d(f,g,b)})})),f},load:function(a,b){var c=O.getXHR();return c?(c.open("GET",a,!0),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined"),d(c,"progress",function(a){a.lengthComputable&&b({type:a.type,loaded:a.loaded,total:a.total},c)}),c.onreadystatechange=function(){if(4==c.readyState)if(c.onreadystatechange=null,200==c.status){a=a.split("/");var d={name:a[a.length-1],size:c.getResponseHeader("Content-Length"),type:c.getResponseHeader("Content-Type")};d.dataURL="data:"+d.type+";base64,"+O.encode64(c.responseBody||c.responseText),b({type:"load",result:d})}else b({type:"error"})},c.send(null)):b({type:"error"}),c},encode64:function(a){var b="",c=0;for("string"!=typeof a&&(a=String(a));c<a.length;){var d=a.charCodeAt(c++)&255,e=a.charCodeAt(c++)&255,f=a.charCodeAt(c++)&255,g=d>>2,d=(d&3)<<4|e>>4;isNaN(e)?e=f=64:(e=(e&15)<<2|f>>6,f=isNaN(f)?64:f&63),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)}return b}};O.addInfoReader(/^image/,function(a,b){if(!a.__dimensions){var c=a.__dimensions=O.defer();O.readAsImage(a,function(a){var b=a.target;c.resolve("load"==a.type?!1:"error",{width:b.width,height:b.height})})}a.__dimensions.then(b)}),O.event.dnd=function(a,b,c){var e,f;c||(c=b,b=O.F),s?(d(a,"dragenter dragleave dragover",function(a){for(var c=((a.originalEvent||a||"").dataTransfer||{}).types,d=c&&c.length;d--;)~c[d].indexOf("File")&&(a.preventDefault(),f!==a.type&&(f=a.type,"dragleave"!=f&&b.call(a.currentTarget,!0,a),clearTimeout(e),e=setTimeout(function(){b.call(a.currentTarget,"dragleave"!=f,a)},50)))}),d(a,"drop",function(a){a.preventDefault(),f=0,b.call(a.currentTarget,!1,a),O.getDropFiles(a,function(b){c.call(a.currentTarget,b,a)})})):O.log("Drag'n'Drop -- not supported")},v&&!v.fn.dnd&&(v.fn.dnd=function(a,b){return this.each(function(){O.event.dnd(this,a,b)})}),a.FileAPI=O.extend(O,a.FileAPI),O.flashUrl||(O.flashUrl=O.staticPath+"FileAPI.flash.swf"),O.flashImageUrl||(O.flashImageUrl=O.staticPath+"FileAPI.flash.image.swf")}(window),function(a,b,c){function d(a,b){if(!(this instanceof d))return new d(a);this.file=a,this.better=!b,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0}}var e=Math.min,f=Math.round,g=!1,h={8:270,3:180,6:90};try{g=-1<b.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")}catch(i){}d.prototype={constructor:d,set:function(b){return a.extend(this.matrix,b),this},crop:function(a,b,d,e){return d===c&&(d=a,e=b,a=b=0),this.set({sx:a,sy:b,sw:d,sh:e||d})},resize:function(a,b,c){return"string"==typeof b&&(c=b,b=a),this.set({dw:a,dh:b,resize:c})},preview:function(a,b){return this.set({dw:a,dh:b||a,resize:"preview"})},rotate:function(a){return this.set({deg:a})},_load:function(b,c){var d=this;a.readAsImage(b,function(a){c.call(d,"load"!=a.type,a.result)})},_apply:function(a,c){var d=b.createElement("canvas"),e=this.getMatrix(a),f=d.getContext("2d"),g=e.deg,h=e.dw,i=e.dh,j=a.width,l=a.height,m,n=a;if(this.better)for(;2<Math.min(j/h,l/i);)j=~~(j/2+.5),l=~~(l/2+.5),m=b.createElement("canvas"),m.width=j,m.height=l,n!==a?(m.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,j,l),n=m):(n=m,n.getContext("2d").drawImage(a,e.sx,e.sy,e.sw,e.sh,0,0,j,l),e.sx=e.sy=e.sw=e.sh=0);d.width=g%180?i:h,d.height=g%180?h:i,f.rotate(g*Math.PI/180),f.drawImage(n,e.sx,e.sy,e.sw||n.width,e.sh||n.height,180==g||270==g?-h:0,90==g||180==g?-i:0,h,i),c.call(this,!1,d)},getMatrix:function(b){var c=a.extend({},this.matrix),d=c.sw=c.sw||b.width;b=c.sh=c.sh||b.height;var g=c.dw=c.dw||c.sw,h=c.dh=c.dh||c.sh,i=d/b,j=g/h,k=c.resize;if("preview"==k){if(g!=d||h!=b)if(j>=i?(i=d,k=i/j):(k=b,i=k*j),i!=d||k!=b)c.sx=~~((d-i)/2),c.sy=~~((b-k)/2),d=i,b=k}else k&&("min"==k?(g=f(i<j?e(d,g):h*i),h=f(i<j?g/i:e(b,h))):(g=f(i>=j?e(d,g):h*i),h=f(i>=j?g/i:e(b,h))));return c.sw=d,c.sh=b,c.dw=g,c.dh=h,c},_trans:function(a){this._load(this.file,function(b,c){b?a(b):this._apply(c,a)})},get:function(b){if(a.support.transform){var c=this;"auto"==c.matrix.deg?a.getInfo(this.file,function(a,d){c.matrix.deg=h[d&&d.exif&&d.exif.Orientation]||0,c._trans(b)}):c._trans(b)}else b("not_support")},toData:function(a){this.get(a)}},d.exifOrientation=h,d.transform=function(b,e,f,g){a.getInfo(b,function(h,i){var k={},l=a.queue(function(a){g(a,k)});h?l.fail():a.each(e,function(a,e){if(!l.isFail()){var g=d(i.nodeType?i:b);"function"==typeof a?a(i,g):a.width?g[a.preview?"preview":"resize"](a.width,a.height,a.type):a.maxWidth&&(i.width>a.maxWidth||i.height>a.maxHeight)&&g.resize(a.maxWidth,a.maxHeight,"max"),a.rotate===c&&f&&(a.rotate="auto"),g.rotate(a.rotate),l.inc(),g.toData(function(a,b){a?l.fail():(k[e]=b,l.next())})}})})},a.support.canvas=a.support.transform=g,a.Image=d}(FileAPI,document),function(a,b,c){var d=b.encodeURIComponent,e=b.FormData;b=function(){this.items=[]},b.prototype={append:function(a,b,c,d){this.items.push({name:a,blob:b&&b.blob||(void 0==b?"":b),file:b&&(c||b.name),type:b&&(d||b.type)})},each:function(a){for(var b=0,c=this.items.length;b<c;b++)a.call(this,this.items[b])},toData:function(b,c){c._chunked=a.support.chunked&&0<c.chunkSize&&1==a.filter(this.items,function(a){return a.file}).length,a.support.html5?this.multipart||!e?(a.log("FileAPI.Form.toMultipartData"),this.toMultipartData(b)):c._chunked?(a.log("FileAPI.Form.toPlainData"),this.toPlainData(b)):(a.log("FileAPI.Form.toFormData"),this.toFormData(b)):(a.log("FileAPI.Form.toHtmlData"),this.toHtmlData(b))},_to:function(b,c,d,e){var f=a.queue(function(){c(b)});this.each(function(a){d(a,b,f,e)}),f.check()},toHtmlData:function(b){this._to(c.createDocumentFragment(),b,function(b,d){var e=b.blob,f;b.file?(a.reset(e),e.name=b.name,d.appendChild(e)):(f=c.createElement("input"),f.name=b.name,f.type="hidden",f.value=e,d.appendChild(f))})},toPlainData:function(a){this._to({},a,function(a,b,c){a.file&&(b.type=a.file),a.blob.toBlob?(c.inc(),a.blob.toBlob(function(d){b.name=a.name,b.file=d,b.size=d.length,b.type=a.type,c.next()},"image/png")):a.file?(b.name=a.blob.name,b.file=a.blob,b.size=a.blob.size,b.type=a.type):(b.params||(b.params=[]),b.params.push(encodeURIComponent(a.name)+"="+encodeURIComponent(a.blob))),b.start=-1,b.end=b.file.FileAPIReadPosition||-1,b.retry=0})},toFormData:function(a){this._to(new e,a,function(a,b,c){a.file&&b.append("_"+a.name,a.file),a.blob&&a.blob.toBlob?(c.inc(),a.blob.toBlob(function(d){b.append(a.name,d,a.file),c.next()},"image/png")):a.file?b.append(a.name,a.blob,a.file):b.append(a.name,a.blob)})},toMultipartData:function(b){this._to([],b,function(b,c,e,f){var g=!!b.file,h=b.blob,i=function(a){c.push("--_"+f+('\r\nContent-Disposition: form-data; name="'+b.name+'"'+(g?'; filename="'+d(b.file)+'"':"")+(g?"\r\nContent-Type: "+(b.type||"application/octet-stream"):"")+"\r\n\r\n"+(g?a:d(a))+"\r\n")),e.next()};e.inc(),a.isFile(h)?a.readAsBinaryString(h,function(a){"load"==a.type&&i(a.result)}):i(h)},a.expando)}},a.Form=b}(FileAPI,window,document),function(a,b){var c=function(){},d=function(a){this.uid=b.uid(),this.xhr={abort:c,getResponseHeader:c,getAllResponseHeaders:c},this.options=a};d.prototype={status:0,statusText:"",getResponseHeader:function(a){return this.xhr.getResponseHeader(a)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(d,e){var f=this,h=f.options;f.end=f.abort=c,f.status=d,e&&(f.statusText=e),b.log("xhr.end:",d,e),h.complete(200==d||201==d?!1:f.statusText||"unknown",f),f.xhr&&f.xhr.node&&setTimeout(function(){var b=f.xhr.node;try{b.parentNode.removeChild(b)}catch(c){}try{delete a[f.uid]}catch(d){}a[f.uid]=f.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(a){var b=this,c=this.options;a.toData(function(a){c.upload(c,b),b._send.call(b,c,a)},c)},_send:function(c,d){var e=this,f,g=e.uid,h=c.url;b.log("XHR._send:",d),h+=(~h.indexOf("?")?"&":"?")+b.uid(),d.nodeName?(c.upload(c,e),f=document.createElement("div"),f.innerHTML='<form target="'+g+'" action="'+h+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+g+'" src="javascript:false;"></iframe><input value="'+g+'" name="callback" type="hidden"/></form>',e.xhr.abort=function(){var a=f.getElementsByName("iframe")[0];if(a)try{a.stop?a.stop():a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand("Stop")}catch(b){}f=null},h=f.getElementsByTagName("form")[0],h.appendChild(d),b.log(h.parentNode.innerHTML),document.body.appendChild(f),e.xhr.node=f,a[g]=function(a,b,c){e.readyState=4,e.responseText=c,e.end(a,b),f=null},e.readyState=2,h.submit(),h=null):this.xhr&&this.xhr.aborted?b.log("Error: already aborted"):(f=e.xhr=b.getXHR(),d.params&&(h+=(0>h.indexOf("?")?"?":"&")+d.params.join("&")),f.open("POST",h,!0),b.withCredentials&&(f.withCredentials="true"),(!c.headers||!c.headers["X-Requested-With"])&&f.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.each(c.headers,function(a,b){f.setRequestHeader(b,a)}),c._chunked?(f.upload&&f.upload.addEventListener("progress",function(a){d.retry||c.progress({type:a.type,total:d.size,loaded:d.start+a.loaded,totalSize:d.size},e,c)},!1),f.onreadystatechange=function(){e.status=f.status,e.statusText=f.statusText,e.readyState=f.readyState;if(4==f.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})e["response"+a]=f["response"+a];f.onreadystatechange=null;if(!f.status||0<f.status-201)if(b.log("Error: "+f.status),(!f.status&&!f.aborted||500==f.status||416==f.status)&&++d.retry<=c.chunkUploadRetry){a=f.status?0:b.chunkNetworkDownRetryTimeout,c.pause(d.file,c);var g=parseInt(f.getResponseHeader("X-Last-Known-Byte"),10);b.log("X-Last-Known-Byte: "+g),d.end=g?g:d.start-1,setTimeout(function(){e._send(c,d)},a)}else e.end(f.status);else d.retry=0,d.end==d.size-1?e.end(f.status):(g=parseInt(f.getResponseHeader("X-Last-Known-Byte"),10),b.log("X-Last-Known-Byte: "+g),g&&(d.end=g),d.file.FileAPIReadPosition=d.end,setTimeout(function(){e._send(c,d)},0));f=null}},d.start=d.end+1,d.end=Math.max(Math.min(d.start+c.chunkSize,d.size)-1,d.start),(g="slice")in d.file||(g="mozSlice")in d.file||(g="webkitSlice"),f.setRequestHeader("Content-Range","bytes "+d.start+"-"+d.end+"/"+d.size),f.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(d.name)),f.setRequestHeader("Content-Type",d.type||"application/octet-stream"),g=d.file[g](d.start,d.end+1),f.send(g),g=null):(f.upload&&f.upload.addEventListener("progress",b.throttle(function(a){c.progress(a,e,c)},100),!1),f.onreadystatechange=function(){e.status=f.status,e.statusText=f.statusText,e.readyState=f.readyState;if(4==f.readyState){for(var a in{"":1,XML:1,Text:1,Body:1})e["response"+a]=f["response"+a];f.onreadystatechange=null,e.end(f.status),f=null}},b.isArray(d)?(f.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+b.expando),d=d.join("")+"--_"+b.expando+"--",f.sendAsBinary?f.sendAsBinary(d):(g=Array.prototype.map.call(d,function(a){return a.charCodeAt(0)&255}),f.send((new Uint8Array(g)).buffer))):f.send(d)))}},b.XHR=d}(window,FileAPI),function(a,b,c){var d=a.support,e=b.navigator,f=e.mimeTypes,g=!1;if(e.plugins&&"object"==typeof e.plugins["Shockwave Flash"])g=e.plugins["Shockwave Flash"].description&&!(f&&f["application/x-shockwave-flash"]&&!f["application/x-shockwave-flash"].enabledPlugin);else try{g=!!b.ActiveXObject&&!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(h){a.log("ShockwaveFlash.ShockwaveFlash -- does not supported.")}d.flash=g;if(a.support.flash&&(!a.html5||!a.support.html5||a.cors&&!a.support.cors)){var i=function(a){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(a.width||"100%")+'" height="'+(a.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(a.width||"100%")+'" height="'+(a.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/ig,function(b,c){return a[c]})},j=function(a,b){if(a&&a.style){var c,d;for(c in b){d=b[c],"number"==typeof d&&(d+="px");try{a.style[c]=d}catch(e){}}}},k=function(b,c){a.each(c,function(a,c){var d=b[c];b[c]=function(){return this.parent=d,a.apply(this,arguments)}})},l=function(b){var c=b.wid=a.uid();return s._fn[c]=b,"FileAPI.Flash._fn."+c},m=function(a){try{s._fn[a.wid]=null,delete s._fn[a.wid]}catch(b){}},n=function(a,b){if(!r.test(a)){if(/^\.\//.test(a)||"/"!=a.charAt(0)){var c=location.pathname,c=c.substr(0,c.lastIndexOf("/"));a=(c+"/"+a).replace("/./","/")}"//"!=a.substr(0,2)&&(a="//"+location.host+a),r.test(a)||(a=location.protocol+a)}return b&&(a+=(/\?/.test(a)?"&":"?")+b),a},o=a.uid(),p=0,q={},r=/^https?:/i,s={_fn:{},init:function(){var b=c.body&&c.body.firstChild;if(b)do if(1==b.nodeType){a.log("FlashAPI.Flash.init...");var d=c.createElement("div");j(d,{top:1,right:1,width:5,height:5,position:"absolute"}),b.parentNode.insertBefore(d,b),s.publish(d,o);return}while(b=b.nextSibling);10>p&&setTimeout(s.init,50*++p)},publish:function(b,c){b.innerHTML=i({id:c,src:n(a.flashUrl,"r="+a.version),wmode:"transparent",flashvars:"callback=FileAPI.Flash.event&flashId="+c+"&storeKey="+navigator.userAgent.match(/\d/ig).join("")+"_"+a.version+(s.isReady||(a.pingUrl?"&ping="+a.pingUrl:""))})},ready:function(){s.ready=a.F,s.isReady=!0,s.patch(),a.event.on(c,"mouseover",s.mouseover),a.event.on(c,"click",function(a){s.mouseover(a)&&(a.preventDefault?a.preventDefault():a.returnValue=!0)})},getWrapper:function(a){do if(/js-fileapi-wrapper/.test(a.className))return a;while((a=a.parentNode)&&a!==c.body)},mouseover:function(b){b=a.event.fix(b).target;if(/input/i.test(b.nodeName)&&"file"==b.type){var d=b.getAttribute(o);if("i"==d||"r"==d)return!1;if("p"!=d){b.setAttribute(o,"i");var d=c.createElement("div"),e=s.getWrapper(b);if(!e){a.log("flash.mouseover.error: js-fileapi-wrapper not found");return}j(d,{top:0,left:0,width:b.offsetWidth+100,height:b.offsetHeight+100,zIndex:"1000000",position:"absolute"}),e.appendChild(d),s.publish(d,a.uid()),b.setAttribute(o,"p")}return!0}},event:function(b){var c=b.type;if("ready"==c){try{s.getInput(b.flashId).setAttribute(o,"r")}catch(d){}return s.ready(),setTimeout(function(){s.mouseenter(b)},50),!0}"ping"===c?a.log("(flash -> js).ping:",[b.status,b.savedStatus],b.error):"log"===c?a.log("(flash -> js).log:",b.target):c in s&&setTimeout(function(){a.log("Flash.event."+b.type+":",b),s[c](b)},1)},mouseenter:function(b){var c=s.getInput(b.flashId);if(c){s.cmd(b,"multiple",null!=c.getAttribute("multiple"));var d=[],e={};a.each((c.getAttribute("accept")||"").split(/,\s*/),function(b){a.accept[b]&&a.each(a.accept[b].split(" "),function(a){e[a]=1})}),a.each(e,function(a,b){d.push(b)}),s.cmd(b,"accept",d.length?d.join(",")+","+d.join(",").toUpperCase():"*")}},get:function(a){return c[a]||b[a]||c.embeds[a]},getInput:function(b){try{var c=s.getWrapper(s.get(b));if(c)return c.getElementsByTagName("input")[0]}catch(d){a.log('Can not find "input" by flashId:',b,d)}},select:function(b){var d=s.getInput(b.flashId),e=a.uid(d);b=b.target.files,a.each(b,function(b){a.checkFileObj(b)}),q[e]=b,c.createEvent?(e=c.createEvent("Event"),e.initEvent("change",!0,!1),d.dispatchEvent(e)):c.createEventObject&&(e=c.createEventObject(),d.fireEvent("onchange",e))},cmd:function(b,c,d,e){try{return a.log("(js -> flash)."+c+":",d),s.get(b.flashId||b).cmd(c,d)}catch(f){a.log("(js -> flash).onError:",f),e||setTimeout(function(){s.cmd(b,c,d,!0)},50)}},patch:function(){a.flashEngine=a.support.transform=!0,k(a,{getFiles:function(b,c,d){if(d)return a.filterFiles(a.getFiles(b),c,d),null;var e=a.isArray(b)?b:q[a.uid(b.target||b.srcElement||b)];return e?(c&&(c=a.getFilesFilter(c),e=a.filter(e,function(a){return c.test(a.name)})),e):this.parent.apply(this,arguments)},getInfo:function(b,c){if(b&&!b.flashId)this.parent.apply(this,arguments);else{if(!b.__info){var d=b.__info=a.defer();s.cmd(b,"getFileInfo",{id:b.id,callback:l(function e(a,c){m(e),d.resolve(a,b.info=c)})})}b.__info.then(c)}}}),a.support.transform=!0,a.Image&&k(a.Image.prototype,{get:function(a,b){this.set({scaleMode:b||"noScale"}),this.parent(a)},_load:function(b,c){a.log("FileAPI.Image._load:",b);if(b&&!b.flashId)this.parent.apply(this,arguments);else{var d=this;a.getInfo(b,function(a){c.call(d,a,b)})}},_apply:function(b,d){a.log("FileAPI.Image._apply:",b);if(b&&!b.flashId)this.parent.apply(this,arguments);else{var e=this.getMatrix(b.info);s.cmd(b,"imageTransform",{id:b.id,matrix:e,callback:l(function f(g,h){a.log("FileAPI.Image._apply.callback:",g),m(f);if(g)d(g);else if(!a.support.dataURI||3e4<h.length){var k={width:e.deg%180?e.dh:e.dw,height:e.deg%180?e.dw:e.dh,scale:e.scaleMode},o=d,p=function(){try{s.get(r).setImage(h)}catch(b){a.log('flash.setImage -- can not set "base64":',b)}},q,r=a.uid(),t=c.createElement("div");for(q in k)t.setAttribute("data-img-"+q,k[q]);j(t,k),t.innerHTML=i(a.extend({id:r,src:n(a.flashImageUrl,"r="+a.uid()),wmode:"opaque",flashvars:"scale="+k.scale+"&callback="+l(function w(){return m(w),setTimeout(p,99),!0})},k)),o(!1,t),t=null}else{var v=new Image;a.event.one(v,"error abort load",function(a){d("load"!=a.type&&a.type,v),v=null}),v.src="data:"+b.type+";base64,"+h}})})}},toData:function(b){var c=this.file,d=c.info,e=this.getMatrix(d);c&&!c.flashId?this.parent.apply(this,arguments):("auto"==e.deg&&(e.deg=a.Image.exifOrientation[d&&d.exif&&d.exif.Orientation]||0),b.call(this,!c.info,{id:c.id,flashId:c.flashId,name:c.name,type:c.type,matrix:e}))}}),k(a.Form.prototype,{toData:function(b){for(var c=this.items,d=c.length;d--;)if(c[d].file&&c[d].blob&&!c[d].blob.flashId)return this.parent.apply(this,arguments);a.log("flash.Form.toData"),b(c)}}),k(a.XHR.prototype,{_send:function(b,c){if(c.nodeName||c.append&&a.support.html5||a.isArray(c)&&"string"==typeof c[0])return this.parent.apply(this,arguments);var d={},e={},f=this,g,h;a.each(c,function(a){a.file?(e[a.name]=a={id:a.blob.id,name:a.blob.name,matrix:a.blob.matrix,flashId:a.blob.flashId},h=a.id,g=a.flashId):d[a.name]=a.blob});if(!h&&!g)return this.parent.apply(this,arguments);a.log("flash.XHR._send:",g,h,e),f.xhr={headers:{},abort:function(){s.cmd(g,"abort",{id:h})},getResponseHeader:function(a){return this.headers[a]},getAllResponseHeaders:function(){return this.headers}};var i=a.queue(function(){s.cmd(g,"upload",{url:n(b.url),data:d,files:e,headers:b.headers,callback:l(function c(d){var e=d.type,g=d.result;a.log("flash.upload."+e+":",d);if("progress"==e)d.loaded=Math.min(d.loaded,d.total),d.lengthComputable=!0,b.progress(d);else if("complete"==e)m(c),"string"==typeof g&&(f.responseText=g.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),f.end(d.status||200);else if("abort"==e||"error"==e)f.end(d.status||0,d.message),m(c)})})});a.each(e,function(b){i.inc(),a.getInfo(b,i.next)}),i.check()}})}};a.Flash=s;var t=new Image;a.event.one(t,"error load",function(){a.support.dataURI=1==t.width&&1==t.height,t=null,s.init()}),t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}}(FileAPI,window,document),"undefined"!=typeof ajs&&ajs.loaded&&ajs.loaded("{fileapi}FileAPI.min"),"function"==typeof define&&define.amd&&define("FileAPI",[],function(){return window.FileAPI||{}})